# レガシーコード移行ルール

## 1. 既存コードの分析

### 1.1. 動作理解

- 移行前に、既存コードの動作を完全に理解すること
- 特に以下の点に注目：
  - データフロー
  - エラーハンドリング
  - パフォーマンス特性
  - 外部サービスとの連携方法

### 1.2. 依存関係の把握

- 既存コードが依存している外部サービスやライブラリを特定
- 各依存関係の使用方法と目的を理解

## 2. 移行プロセス

### 2.1. 段階的移行

- 一度に全てを移行せず、機能単位で段階的に移行
- 各段階で既存の動作と新しい実装の動作を比較

### 2.2. インターフェース設計

- 既存の実装を参考に、必要最小限のインターフェースを設計
- 抽象化は慎重に行い、過剰な抽象化を避ける
- 新しいメソッドの追加は、既存のユースケースを完全に理解した上で行う

### 2.3. 実装の検証

- 新しい実装が既存の実装と同じ動作をすることを確認
- パフォーマンスの比較検証
- エラーケースの網羅的なテスト

## 3. コードレビュー

### 3.1. 変更の正当性

- 新しい実装の追加が本当に必要かどうかの確認
- 既存の実装で対応できない理由の説明
- 代替案の検討

### 3.2. パフォーマンス影響

- 新しい実装によるパフォーマンスへの影響評価
- 不要なAPIコールやデータベースアクセスの有無
- リソース使用量の増加の有無

## 4. ドキュメント

### 4.1. 移行記録

- 移行の理由と方法の記録
- 既存実装と新実装の違いの説明
- パフォーマンスや動作の違いの記録

### 4.2. 設計判断の記録

- インターフェース設計の判断理由
- 実装方法の選択理由
- 代替案の検討結果
