# åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹è¨ˆè£… è©³ç´°è¨­è¨ˆæ›¸

- [åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹è¨ˆè£… è©³ç´°è¨­è¨ˆæ›¸](#åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹è¨ˆè£…-è©³ç´°è¨­è¨ˆæ›¸)
  - [1. æ¦‚è¦](#1-æ¦‚è¦)
    - [1.1. èƒŒæ™¯ã¨ç›®çš„](#11-èƒŒæ™¯ã¨ç›®çš„)
    - [1.2. å¯¾è±¡ç¯„å›²](#12-å¯¾è±¡ç¯„å›²)
    - [1.3. è¨­è¨ˆæ–¹é‡](#13-è¨­è¨ˆæ–¹é‡)
  - [2. ç¾çŠ¶åˆ†æ](#2-ç¾çŠ¶åˆ†æ)
    - [2.1. æ—¢å­˜å®Ÿè£…çŠ¶æ³](#21-æ—¢å­˜å®Ÿè£…çŠ¶æ³)
    - [2.2. èª²é¡Œãƒ»æ”¹å–„ç‚¹](#22-èª²é¡Œæ”¹å–„ç‚¹)
  - [3. ãƒˆãƒ¬ãƒ¼ã‚¹è¨­è¨ˆ](#3-ãƒˆãƒ¬ãƒ¼ã‚¹è¨­è¨ˆ)
    - [3.1. ãƒˆãƒ¬ãƒ¼ã‚¹å¯¾è±¡APIä¸€è¦§](#31-ãƒˆãƒ¬ãƒ¼ã‚¹å¯¾è±¡apiä¸€è¦§)
    - [3.2. ã‚¹ãƒ‘ãƒ³æ§‹é€ è¨­è¨ˆ](#32-ã‚¹ãƒ‘ãƒ³æ§‹é€ è¨­è¨ˆ)
      - [3.2.1. åŸºæœ¬çš„ãªã‚¹ãƒ‘ãƒ³éšå±¤æ§‹é€ ](#321-åŸºæœ¬çš„ãªã‚¹ãƒ‘ãƒ³éšå±¤æ§‹é€ )
      - [3.2.2. å…·ä½“ä¾‹: å•†å“ä¸€è¦§å–å¾—ã®ã‚¹ãƒ‘ãƒ³æ§‹é€ ](#322-å…·ä½“ä¾‹-å•†å“ä¸€è¦§å–å¾—ã®ã‚¹ãƒ‘ãƒ³æ§‹é€ )
      - [3.2.3. å…·ä½“ä¾‹: ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ã‚¹ãƒ‘ãƒ³æ§‹é€ ](#323-å…·ä½“ä¾‹-ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ã‚¹ãƒ‘ãƒ³æ§‹é€ )
    - [3.3. ã‚¹ãƒ‘ãƒ³å±æ€§è¨­è¨ˆ](#33-ã‚¹ãƒ‘ãƒ³å±æ€§è¨­è¨ˆ)
      - [3.3.1. HTTPã‚¹ãƒ‘ãƒ³å±æ€§ï¼ˆOpenTelemetry Semantic Conventionsæº–æ‹ ï¼‰](#331-httpã‚¹ãƒ‘ãƒ³å±æ€§opentelemetry-semantic-conventionsæº–æ‹ )
      - [3.3.2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ãƒ‘ãƒ³å±æ€§](#332-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ãƒ‘ãƒ³å±æ€§)
      - [3.3.3. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚¹ãƒ‘ãƒ³å±æ€§](#333-ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚¹ãƒ‘ãƒ³å±æ€§)
      - [3.3.4. å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¹ãƒ‘ãƒ³å±æ€§](#334-å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¹ãƒ‘ãƒ³å±æ€§)
    - [3.4. ã‚¨ãƒ©ãƒ¼æƒ…å ±è¨­è¨ˆ](#34-ã‚¨ãƒ©ãƒ¼æƒ…å ±è¨­è¨ˆ)
      - [3.4.1. ã‚¨ãƒ©ãƒ¼ã‚¹ãƒ‘ãƒ³å±æ€§](#341-ã‚¨ãƒ©ãƒ¼ã‚¹ãƒ‘ãƒ³å±æ€§)
      - [3.4.2. ã‚¨ãƒ©ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆè¨­è¨ˆ](#342-ã‚¨ãƒ©ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆè¨­è¨ˆ)
  - [4. å®Ÿè£…è¨­è¨ˆ](#4-å®Ÿè£…è¨­è¨ˆ)
    - [4.1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³](#41-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³)
    - [4.2. OTelManagerã®æ‹¡å¼µ](#42-otelmanagerã®æ‹¡å¼µ)
      - [4.2.1. è¨­å®šæ§‹é€ ä½“ã®æ‹¡å¼µ](#421-è¨­å®šæ§‹é€ ä½“ã®æ‹¡å¼µ)
      - [4.2.2. OTelManagerã®æ‹¡å¼µ](#422-otelmanagerã®æ‹¡å¼µ)
    - [4.3. HTTPãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢](#43-httpãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢)
      - [4.3.1. ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å®Ÿè£…](#431-ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å®Ÿè£…)
      - [4.3.2. ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è¿½åŠ ï¼ˆrouter.goã®ä¿®æ­£ï¼‰](#432-ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è¿½åŠ routergoã®ä¿®æ­£)
    - [4.4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°](#44-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°)
      - [4.4.1. SQLBoilerãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°å®Ÿè£…](#441-sqlboilerãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°å®Ÿè£…)
      - [4.4.2. DBManagerä¿®æ­£](#442-dbmanagerä¿®æ­£)
    - [4.5. å„å±¤ã§ã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°å®Ÿè£…](#45-å„å±¤ã§ã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°å®Ÿè£…)
      - [4.5.1. UseCaseå±¤ã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°](#451-usecaseå±¤ã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°)
      - [4.5.2. Repositoryå±¤ã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°](#452-repositoryå±¤ã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°)
      - [4.5.3. å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°](#453-å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°)
  - [5. ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æˆ¦ç•¥](#5-ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æˆ¦ç•¥)
    - [5.1. ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æ–¹å¼](#51-ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æ–¹å¼)
      - [5.1.1. å‹•çš„ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ï¼ˆå°†æ¥æ‹¡å¼µï¼‰](#511-å‹•çš„ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å°†æ¥æ‹¡å¼µ)
    - [5.2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …](#52-ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …)
  - [6. è¨­å®šãƒ»ç®¡ç†](#6-è¨­å®šç®¡ç†)
    - [6.1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µ](#61-è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µ)
      - [6.1.1. config.yaml ã®æ‹¡å¼µ](#611-configyaml-ã®æ‹¡å¼µ)
      - [6.1.2. ç’°å¢ƒåˆ¥è¨­å®šä¾‹](#612-ç’°å¢ƒåˆ¥è¨­å®šä¾‹)
    - [6.2. ç’°å¢ƒå¤‰æ•°](#62-ç’°å¢ƒå¤‰æ•°)
  - [7. æ¤œè¨¼ãƒ»ãƒ†ã‚¹ãƒˆè¨ˆç”»](#7-æ¤œè¨¼ãƒ†ã‚¹ãƒˆè¨ˆç”»)
    - [7.1. å˜ä½“ãƒ†ã‚¹ãƒˆ](#71-å˜ä½“ãƒ†ã‚¹ãƒˆ)
      - [7.1.1. ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ ãƒ†ã‚¹ãƒˆ](#711-ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢-ãƒ†ã‚¹ãƒˆ)
      - [7.1.2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚° ãƒ†ã‚¹ãƒˆ](#712-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°-ãƒ†ã‚¹ãƒˆ)
    - [7.2. çµ±åˆãƒ†ã‚¹ãƒˆ](#72-çµ±åˆãƒ†ã‚¹ãƒˆ)
      - [7.2.1. ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ ãƒˆãƒ¬ãƒ¼ã‚¹æ¤œè¨¼](#721-ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰-ãƒˆãƒ¬ãƒ¼ã‚¹æ¤œè¨¼)
    - [7.3. ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ](#73-ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ)
      - [7.3.1. Tempoé€£æºãƒ†ã‚¹ãƒˆ](#731-tempoé€£æºãƒ†ã‚¹ãƒˆ)
      - [7.3.2. æ€§èƒ½ãƒ†ã‚¹ãƒˆ](#732-æ€§èƒ½ãƒ†ã‚¹ãƒˆ)
  - [8. å®Ÿè£…æ‰‹é †](#8-å®Ÿè£…æ‰‹é †)
    - [8.1. ãƒ•ã‚§ãƒ¼ã‚º1: åŸºç›¤å®Ÿè£…](#81-ãƒ•ã‚§ãƒ¼ã‚º1-åŸºç›¤å®Ÿè£…)
    - [8.2. ãƒ•ã‚§ãƒ¼ã‚º2: HTTPãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°](#82-ãƒ•ã‚§ãƒ¼ã‚º2-httpãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°)
    - [8.3. ãƒ•ã‚§ãƒ¼ã‚º3: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°](#83-ãƒ•ã‚§ãƒ¼ã‚º3-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°)
    - [8.4. ãƒ•ã‚§ãƒ¼ã‚º4: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°](#84-ãƒ•ã‚§ãƒ¼ã‚º4-ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°)

## 1. æ¦‚è¦

### 1.1. èƒŒæ™¯ã¨ç›®çš„

**èƒŒæ™¯**

- Eã‚³ãƒãƒ¼ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®Goãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆEcho + SQLBoilerï¼‰ã§åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ãŒæœªå®Ÿè£…
- æ—¢å­˜ã®OpenTelemetryãƒ­ã‚°ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹åŸºç›¤ã‚’æ´»ç”¨ã—ã¦ãƒˆãƒ¬ãƒ¼ã‚¹æ©Ÿèƒ½ã‚’è¿½åŠ 
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ãƒ•ãƒ­ãƒ¼ã®å¯è¦–åŒ–ã¨ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ç‰¹å®šãŒå¿…è¦

**ç›®çš„**

- HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã®å…¨ãƒ•ãƒ­ãƒ¼ã‚’ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ã—ã¦è¨˜éŒ²
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®å®Ÿè¡ŒçŠ¶æ³ã‚’å¯è¦–åŒ–
- ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®åŸå› èª¿æŸ»åŠ¹ç‡åŒ–
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ã®ãŸã‚ã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ç‰¹å®š

### 1.2. å¯¾è±¡ç¯„å›²

**å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ **

- `backend-api` ï¼ˆGoã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- MySQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- OTel Collector â†’ Tempo

**ãƒˆãƒ¬ãƒ¼ã‚¹å¯¾è±¡**

- HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªï¼ˆSQLBoilerï¼‰
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè¡Œï¼ˆUseCaseå±¤ï¼‰
- å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºï¼ˆS3ï¼‰

**é™¤å¤–ç¯„å›²**

- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆNext.jsï¼‰ã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°
- Lambdaé–¢æ•°ã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°
- ãƒ­ã‚°ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®æ—¢å­˜å®Ÿè£…å¤‰æ›´

### 1.3. è¨­è¨ˆæ–¹é‡

1. **æ—¢å­˜ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã®æ•´åˆæ€§**: DDD+ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å±¤æ§‹é€ ã‚’å°Šé‡
2. **æœ€å°ä¾µå…¥**: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®å½±éŸ¿ã‚’æœ€å°åŒ–
3. **OpenTelemetryæ¨™æº–æº–æ‹ **: ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯è¦ç´„ã«å¾“ã£ãŸå±æ€§è¨­å®š
4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é‡è¦–**: æœ¬ç•ªç’°å¢ƒã§ã®æ€§èƒ½å½±éŸ¿ã‚’æœ€å°åŒ–
5. **æ®µéšçš„å®Ÿè£…**: æ®µéšçš„ã«ãƒˆãƒ¬ãƒ¼ã‚¹ç¯„å›²ã‚’æ‹¡å¼µ

## 2. ç¾çŠ¶åˆ†æ

### 2.1. æ—¢å­˜å®Ÿè£…çŠ¶æ³

**âœ… å®Ÿè£…æ¸ˆã¿**

- OpenTelemetryã®åŸºç›¤è¨­å®šï¼ˆ`observability_config.go`ï¼‰
- OTelManagerã«ã‚ˆã‚‹ãƒ­ã‚°ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹åˆæœŸåŒ–ï¼ˆ`otel.go`ï¼‰
- OTel Collectorã®è¨­å®šï¼ˆãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å«ã‚€ï¼‰
- HTTPãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
- æ§‹é€ åŒ–ãƒ­ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

**âŒ æœªå®Ÿè£…**

- ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®åˆæœŸåŒ–
- HTTPãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒ¬ãƒ™ãƒ«ã®ã‚¹ãƒ‘ãƒ³

### 2.2. èª²é¡Œãƒ»æ”¹å–„ç‚¹

| é …ç›®                   | ç¾çŠ¶           | èª²é¡Œ                       | æ”¹å–„æ–¹é‡                                 |
| ---------------------- | -------------- | -------------------------- | ---------------------------------------- |
| **ãƒˆãƒ¬ãƒ¼ã‚¹åŸºç›¤**       | æœªå®Ÿè£…         | ãƒˆãƒ¬ãƒ¼ã‚¹åé›†ãƒ»é€ä¿¡æ©Ÿèƒ½ãªã— | OTelManagerã‚’æ‹¡å¼µã—ã¦TraceProviderã‚’è¿½åŠ  |
| **HTTPãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°**   | ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ã¿ | ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ãƒ­ãƒ¼ãŒä¸å¯è¦–   | Echoç”¨ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å®Ÿè£…       |
| **DBãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°**     | ãƒ­ã‚°ã®ã¿       | ã‚¯ã‚¨ãƒªå®Ÿè¡ŒçŠ¶æ³ãŒä¸å¯è¦–     | SQLBoilerç”¨ãƒˆãƒ¬ãƒ¼ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼å®Ÿè£…  |
| **ã‚¨ãƒ©ãƒ¼ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°** | ãƒ­ã‚°ã®ã¿       | ã‚¨ãƒ©ãƒ¼æ–‡è„ˆã®è¿½è·¡å›°é›£       | ã‚¹ãƒ‘ãƒ³ã‚¨ãƒ©ãƒ¼å±æ€§ã¨ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²           |

## 3. ãƒˆãƒ¬ãƒ¼ã‚¹è¨­è¨ˆ

### 3.1. ãƒˆãƒ¬ãƒ¼ã‚¹å¯¾è±¡APIä¸€è¦§

| API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ          | HTTP ãƒ¡ã‚½ãƒƒãƒ‰ | æ“ä½œç¨®åˆ¥ | å„ªå…ˆåº¦ | ãƒˆãƒ¬ãƒ¼ã‚¹ç‰¹å¾´                       |
| --------------------------- | ------------- | -------- | ------ | ---------------------------------- |
| `/health`                   | GET           | Read     | é«˜     | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆDBæ¥ç¶šç¢ºèªå«ã‚€ï¼‰   |
| `/products`                 | GET           | Read     | é«˜     | å•†å“ä¸€è¦§ï¼ˆè¤‡æ•°ãƒ†ãƒ¼ãƒ–ãƒ«çµåˆã‚¯ã‚¨ãƒªï¼‰ |
| `/products/{id}`            | GET           | Read     | é«˜     | å•†å“è©³ç´°ï¼ˆè¤‡æ•°ãƒ†ãƒ¼ãƒ–ãƒ«çµåˆï¼‰       |
| `/products/{id}/image`      | POST          | Write    | ä¸­     | ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆS3é€£æºï¼‰         |
| `/products/{id}/image`      | GET           | Read     | ä¸­     | ç”»åƒå–å¾—ï¼ˆS3é€£æºï¼‰                 |
| `/categories`               | GET           | Read     | ä¸­     | ã‚«ãƒ†ã‚´ãƒªãƒ¼ä¸€è¦§                     |
| `/categories/{id}/products` | GET           | Read     | ä¸­     | ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥å•†å“ï¼ˆçµåˆã‚¯ã‚¨ãƒªï¼‰     |

### 3.2. ã‚¹ãƒ‘ãƒ³æ§‹é€ è¨­è¨ˆ

#### 3.2.1. åŸºæœ¬çš„ãªã‚¹ãƒ‘ãƒ³éšå±¤æ§‹é€ 

```
ğŸ“Š HTTP Request Span (Root)                      [http.server]
â”œâ”€â”€ ğŸ”‘ Authentication Span                       [custom.auth]
â”œâ”€â”€ ğŸ“ Validation Span                           [custom.validation]
â”œâ”€â”€ ğŸ¢ Business Logic Span (UseCase)             [custom.usecase]
â”‚   â”œâ”€â”€ ğŸ“– Repository Read Span                  [custom.repository]
â”‚   â”‚   â””â”€â”€ ğŸ—„ï¸ Database Query Span               [db.query]
â”‚   â”œâ”€â”€ ğŸ”§ Domain Service Span                   [custom.domain_service]
â”‚   â””â”€â”€ ğŸŒ External Service Span (S3)            [http.client]
â””â”€â”€ ğŸ“¤ Response Mapping Span                     [custom.mapping]
```

#### 3.2.2. å…·ä½“ä¾‹: å•†å“ä¸€è¦§å–å¾—ã®ã‚¹ãƒ‘ãƒ³æ§‹é€ 

```
ğŸŒ GET /products                                 (Root Span)
â”œâ”€â”€ ğŸ“ Parameter Validation
â”œâ”€â”€ ğŸ¢ List Products UseCase
â”‚   â”œâ”€â”€ ğŸ“– Product Catalog Reader
â”‚   â”‚   â””â”€â”€ ğŸ—„ï¸ SELECT products p JOIN categories c...
â”‚   â””â”€â”€ ğŸ“„ Product List Mapper
â””â”€â”€ ğŸ“¤ JSON Response Serialization
```

#### 3.2.3. å…·ä½“ä¾‹: ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ã‚¹ãƒ‘ãƒ³æ§‹é€ 

```
ğŸŒ POST /products/{id}/image                     (Root Span)
â”œâ”€â”€ ğŸ“ File Upload Validation
â”œâ”€â”€ ğŸ¢ Upload Product Image UseCase
â”‚   â”œâ”€â”€ ğŸ“– Product Repository (Existence Check)
â”‚   â”‚   â””â”€â”€ ğŸ—„ï¸ SELECT * FROM products WHERE id = ?
â”‚   â”œâ”€â”€ ğŸŒ S3 Upload Service
â”‚   â”‚   â””â”€â”€ ğŸŒ PUT Object to S3
â”‚   â””â”€â”€ ğŸ“– Update Product Repository
â”‚       â””â”€â”€ ğŸ—„ï¸ UPDATE products SET image_url = ? WHERE id = ?
â””â”€â”€ ğŸ“¤ Upload Response Mapping
```

### 3.3. ã‚¹ãƒ‘ãƒ³å±æ€§è¨­è¨ˆ

#### 3.3.1. HTTPã‚¹ãƒ‘ãƒ³å±æ€§ï¼ˆOpenTelemetry Semantic Conventionsæº–æ‹ ï¼‰

| å±æ€§å                         | å‹     | å¿…é ˆ | ä¾‹                                       | èª¬æ˜                 |
| ------------------------------ | ------ | ---- | ---------------------------------------- | -------------------- |
| `http.method`                  | string | âœ…    | `GET`                                    | HTTPãƒ¡ã‚½ãƒƒãƒ‰         |
| `http.route`                   | string | âœ…    | `/products/{id}`                         | ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³       |
| `http.url`                     | string | âœ…    | `http://localhost:8080/api/products/123` | ãƒªã‚¯ã‚¨ã‚¹ãƒˆURL        |
| `http.status_code`             | int    | âœ…    | `200`                                    | HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ |
| `http.request_content_length`  | int    | â­•    | `1024`                                   | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚µã‚¤ã‚º     |
| `http.response_content_length` | int    | â­•    | `2048`                                   | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚µã‚¤ã‚º     |
| `http.user_agent`              | string | â­•    | `Mozilla/5.0...`                         | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ |
| `user.id`                      | string | â­•    | `user_123`                               | èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ID       |

#### 3.3.2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ãƒ‘ãƒ³å±æ€§

| å±æ€§å                 | å‹     | å¿…é ˆ | ä¾‹                                    | èª¬æ˜               |
| ---------------------- | ------ | ---- | ------------------------------------- | ------------------ |
| `db.system`            | string | âœ…    | `mysql`                               | DBã‚·ã‚¹ãƒ†ãƒ          |
| `db.connection_string` | string | â­•    | `mysql://localhost:3306/ecommerce`    | æ¥ç¶šæ–‡å­—åˆ—ï¼ˆç§˜åŒ¿ï¼‰ |
| `db.user`              | string | â­•    | `ecommerce_user`                      | DBãƒ¦ãƒ¼ã‚¶ãƒ¼         |
| `db.name`              | string | âœ…    | `ecommerce`                           | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å     |
| `db.statement`         | string | âœ…    | `SELECT * FROM products WHERE id = ?` | SQLã‚¯ã‚¨ãƒª          |
| `db.operation`         | string | âœ…    | `SELECT`                              | SQLæ“ä½œç¨®åˆ¥        |
| `db.sql.table`         | string | â­•    | `products`                            | æ“ä½œå¯¾è±¡ãƒ†ãƒ¼ãƒ–ãƒ«   |
| `db.rows_affected`     | int    | â­•    | `5`                                   | å½±éŸ¿è¡Œæ•°           |

#### 3.3.3. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚¹ãƒ‘ãƒ³å±æ€§

| å±æ€§å                 | å‹     | å¿…é ˆ | ä¾‹                     | èª¬æ˜             |
| ---------------------- | ------ | ---- | ---------------------- | ---------------- |
| `app.operation_name`   | string | âœ…    | `upload_product_image` | æ“ä½œå           |
| `app.layer`            | string | âœ…    | `usecase`              | ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å±¤ |
| `app.domain`           | string | âœ…    | `product`              | ãƒ‰ãƒ¡ã‚¤ãƒ³å       |
| `app.entity_id`        | string | â­•    | `product_123`          | ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ID   |
| `app.business_context` | string | â­•    | `catalog_management`   | ãƒ“ã‚¸ãƒã‚¹æ–‡è„ˆ     |

#### 3.3.4. å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¹ãƒ‘ãƒ³å±æ€§

| å±æ€§å          | å‹     | å¿…é ˆ | ä¾‹                                    | èª¬æ˜               |
| --------------- | ------ | ---- | ------------------------------------- | ------------------ |
| `http.method`   | string | âœ…    | `PUT`                                 | HTTPãƒ¡ã‚½ãƒƒãƒ‰       |
| `http.url`      | string | âœ…    | `https://s3.amazonaws.com/bucket/key` | å¤–éƒ¨URL            |
| `rpc.service`   | string | âœ…    | `aws.s3`                              | ã‚µãƒ¼ãƒ“ã‚¹å         |
| `aws.s3.bucket` | string | â­•    | `ecommerce-images`                    | S3ãƒã‚±ãƒƒãƒˆå       |
| `aws.s3.key`    | string | â­•    | `products/123/image.jpg`              | S3ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚­ãƒ¼ |

### 3.4. ã‚¨ãƒ©ãƒ¼æƒ…å ±è¨­è¨ˆ

#### 3.4.1. ã‚¨ãƒ©ãƒ¼ã‚¹ãƒ‘ãƒ³å±æ€§

| å±æ€§å          | å‹     | èª¬æ˜                                       |
| --------------- | ------ | ------------------------------------------ |
| `error`         | bool   | ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿãƒ•ãƒ©ã‚°                           |
| `error.type`    | string | ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ï¼ˆvalidation_error, db_errorç­‰ï¼‰ |
| `error.message` | string | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸                           |
| `error.stack`   | string | ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ï¼ˆé–‹ç™ºç’°å¢ƒã®ã¿ï¼‰           |

#### 3.4.2. ã‚¨ãƒ©ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆè¨­è¨ˆ

```go
// ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’ã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦è¨˜éŒ²
span.AddEvent("error", trace.WithAttributes(
    attribute.String("exception.type", "ValidationError"),
    attribute.String("exception.message", "Invalid product ID"),
    attribute.String("exception.stacktrace", stackTrace),
))
```

## 4. å®Ÿè£…è¨­è¨ˆ

### 4.1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```mermaid
graph TB
    subgraph "Echo HTTP Server"
        A[Request] --> B[Tracing Middleware]
        B --> C[Metrics Middleware]
        C --> D[Logging Middleware]
        D --> E[Handler]
    end

    subgraph "Application Layer"
        E --> F[UseCase]
        F --> G[Repository]
    end

    subgraph "Infrastructure Layer"
        G --> H[Database]
        F --> I[S3 Service]
    end

    subgraph "OpenTelemetry"
        B --> J[Trace Provider]
        J --> K[OTel Collector]
    end

    subgraph "Observability Backend"
        K --> L[Tempo]
    end

    subgraph "DB Tracing"
        H --> M[SQL Interceptor]
        M --> J
    end
```

### 4.2. OTelManagerã®æ‹¡å¼µ

#### 4.2.1. è¨­å®šæ§‹é€ ä½“ã®æ‹¡å¼µ

```go
// observability_config.go ã«è¿½åŠ 
type OTelTracingConfig struct {
    Enabled         bool          `mapstructure:"enabled"`
    SamplingRatio   float64       `mapstructure:"sampling_ratio"`
    BatchTimeout    time.Duration `mapstructure:"batch_timeout"`
    MaxQueueSize    int           `mapstructure:"max_queue_size"`
    MaxExportBatchSize int        `mapstructure:"max_export_batch_size"`
    ExportTimeout   time.Duration `mapstructure:"export_timeout"`
}

type OTelConfig struct {
    // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰...
    Tracing OTelTracingConfig `mapstructure:"tracing"`
}
```

#### 4.2.2. OTelManagerã®æ‹¡å¼µ

```go
// otel.go ã®ä¿®æ­£
type OTelManager struct {
    loggerProvider *sdklog.LoggerProvider
    meterProvider  *sdkmetric.MeterProvider
    tracerProvider *sdktrace.TracerProvider  // è¿½åŠ 
    resource       *resource.Resource
    meter          metric.Meter
    tracer         trace.Tracer              // è¿½åŠ 
}

func NewOTelManager(otelConfig config.OTelConfig) (*OTelManager, error) {
    // æ—¢å­˜ã®ãƒ­ã‚°ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹åˆæœŸåŒ–...

    // ãƒˆãƒ¬ãƒ¼ã‚¹åˆæœŸåŒ–
    var tracerProvider *sdktrace.TracerProvider
    var tracer trace.Tracer

    if otelConfig.Tracing.Enabled {
        tracerProvider, err = initTracing(ctx, otelConfig, res)
        if err != nil {
            return nil, fmt.Errorf("failed to initialize tracing: %w", err)
        }
        otel.SetTracerProvider(tracerProvider)
        tracer = tracerProvider.Tracer(otelConfig.ServiceName)
    }

    return &OTelManager{
        // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰...
        tracerProvider: tracerProvider,
        tracer:         tracer,
    }, nil
}

// ãƒˆãƒ¬ãƒ¼ã‚¹åˆæœŸåŒ–é–¢æ•°
func initTracing(ctx context.Context, cfg config.OTelConfig, res *resource.Resource) (*sdktrace.TracerProvider, error) {
    // OTLP Trace Exporter
    traceExporter, err := otlptracehttp.New(ctx,
        otlptracehttp.WithEndpoint(cfg.Collector.Endpoint),
        otlptracehttp.WithTimeout(cfg.Tracing.ExportTimeout),
        otlptracehttp.WithCompression(otlptracehttp.GzipCompression),
        otlptracehttp.WithInsecure(), // é–‹ç™ºç’°å¢ƒç”¨
    )
    if err != nil {
        return nil, fmt.Errorf("failed to create tracer exporter: %w", err)
    }

    // ã‚µãƒ³ãƒ—ãƒ©ãƒ¼ã®è¨­å®š
    sampler := sdktrace.TraceIDRatioBased(cfg.Tracing.SamplingRatio)

    // Trace Provider
    tp := sdktrace.NewTracerProvider(
        sdktrace.WithBatcher(traceExporter,
            sdktrace.WithBatchTimeout(cfg.Tracing.BatchTimeout),
            sdktrace.WithMaxQueueSize(cfg.Tracing.MaxQueueSize),
            sdktrace.WithMaxExportBatchSize(cfg.Tracing.MaxExportBatchSize),
        ),
        sdktrace.WithResource(res),
        sdktrace.WithSampler(sampler),
    )

    return tp, nil
}
```

### 4.3. HTTPãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

#### 4.3.1. ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å®Ÿè£…

```go
// internal/shared/presentation/rest/middleware/tracing.go
package middleware

import (
    "fmt"
    "github.com/labstack/echo/v4"
    "go.opentelemetry.io/otel"
    "go.opentelemetry.io/otel/attribute"
    "go.opentelemetry.io/otel/codes"
    "go.opentelemetry.io/otel/propagation"
    "go.opentelemetry.io/otel/semconv/v1.24.0/httpconv"
    "go.opentelemetry.io/otel/trace"
)

// TracingMiddleware ã¯HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
func TracingMiddleware() echo.MiddlewareFunc {
    return func(next echo.HandlerFunc) echo.HandlerFunc {
        return func(c echo.Context) error {
            // TracerProviderãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
            if otel.GetTracerProvider() == nil {
                return next(c)
            }

            tracer := otel.Tracer("aws-observability-ecommerce")

            // ãƒˆãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æŠ½å‡º
            ctx := otel.GetTextMapPropagator().Extract(
                c.Request().Context(),
                propagation.HeaderCarrier(c.Request().Header),
            )

            // ã‚¹ãƒ‘ãƒ³é–‹å§‹
            spanName := fmt.Sprintf("%s %s", c.Request().Method, getRoutePattern(c))
            ctx, span := tracer.Start(ctx, spanName, trace.WithSpanKind(trace.SpanKindServer))
            defer span.End()

            // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¨­å®š
            c.SetRequest(c.Request().WithContext(ctx))

            // HTTPå±æ€§ã‚’è¨­å®š
            span.SetAttributes(
                httpconv.HTTPMethod(c.Request().Method),
                httpconv.HTTPRoute(getRoutePattern(c)),
                httpconv.HTTPURL(c.Request().URL.String()),
                httpconv.HTTPScheme(c.Scheme()),
                httpconv.HTTPHost(c.Request().Host),
                httpconv.HTTPUserAgent(c.Request().UserAgent()),
                attribute.String("http.remote_addr", c.RealIP()),
            )

            // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚µã‚¤ã‚º
            if c.Request().ContentLength > 0 {
                span.SetAttributes(httpconv.HTTPRequestContentLength(int(c.Request().ContentLength)))
            }

            // æ¬¡ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’å®Ÿè¡Œ
            err := next(c)

            // ãƒ¬ã‚¹ãƒãƒ³ã‚¹å±æ€§ã‚’è¨­å®š
            span.SetAttributes(httpconv.HTTPStatusCode(c.Response().Status))

            // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            if err != nil {
                span.RecordError(err)
                span.SetStatus(codes.Error, err.Error())
                span.SetAttributes(attribute.Bool("error", true))
            } else if c.Response().Status >= 400 {
                span.SetStatus(codes.Error, fmt.Sprintf("HTTP %d", c.Response().Status))
                span.SetAttributes(attribute.Bool("error", true))
            }

            return err
        }
    }
}

func getRoutePattern(c echo.Context) string {
    if route := c.Path(); route != "" {
        return route
    }
    return c.Request().URL.Path
}
```

#### 4.3.2. ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è¿½åŠ ï¼ˆrouter.goã®ä¿®æ­£ï¼‰

```go
// router.go ã® setupMiddleware() ã‚’ä¿®æ­£
func (r *Router) setupMiddleware() {
    // åŸºæœ¬çš„ãªãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
    r.echo.Use(middleware.Recover())
    r.echo.Use(middleware.CORS())

    // ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆæ—©æœŸã«é…ç½®ï¼‰
    r.echo.Use(customMiddleware.TracingMiddleware())

    // æ—¢å­˜ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
    r.echo.Use(customMiddleware.HTTPMetricsMiddleware())
    r.echo.Use(customMiddleware.RequestIDMiddleware())
    r.echo.Use(customMiddleware.LoggingMiddleware())
    r.echo.Use(customMiddleware.ErrorHandlingMiddleware())
}
```

### 4.4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°

#### 4.4.1. SQLBoilerãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°å®Ÿè£…

```go
// internal/shared/infrastructure/database/tracing.go
package database

import (
    "context"
    "database/sql"
    "database/sql/driver"
    "fmt"
    "time"

    "go.opentelemetry.io/otel"
    "go.opentelemetry.io/otel/attribute"
    "go.opentelemetry.io/otel/codes"
    "go.opentelemetry.io/otel/semconv/v1.24.0/dbconv"
    "go.opentelemetry.io/otel/trace"
)

// TracingWrapper ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒ©ãƒƒãƒ‘ãƒ¼
type TracingWrapper struct {
    *sql.DB
    dbName string
}

// NewTracingWrapper ã¯ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°å¯¾å¿œã®DBæ¥ç¶šã‚’ä½œæˆ
func NewTracingWrapper(db *sql.DB, dbName string) *TracingWrapper {
    return &TracingWrapper{
        DB:     db,
        dbName: dbName,
    }
}

// QueryContext ã¯ã‚¯ã‚¨ãƒªå®Ÿè¡Œã‚’ãƒˆãƒ¬ãƒ¼ã‚¹
func (tw *TracingWrapper) QueryContext(ctx context.Context, query string, args ...interface{}) (*sql.Rows, error) {
    return tw.traceQuery(ctx, query, args, func() (*sql.Rows, error) {
        return tw.DB.QueryContext(ctx, query, args...)
    })
}

// ExecContext ã¯å®Ÿè¡Œã‚’ãƒˆãƒ¬ãƒ¼ã‚¹
func (tw *TracingWrapper) ExecContext(ctx context.Context, query string, args ...interface{}) (sql.Result, error) {
    return tw.traceExec(ctx, query, args, func() (sql.Result, error) {
        return tw.DB.ExecContext(ctx, query, args...)
    })
}

func (tw *TracingWrapper) traceQuery(ctx context.Context, query string, args []interface{}, fn func() (*sql.Rows, error)) (*sql.Rows, error) {
    tracer := otel.Tracer("aws-observability-ecommerce")

    ctx, span := tracer.Start(ctx, "db.query", trace.WithSpanKind(trace.SpanKindClient))
    defer span.End()

    // DBå±æ€§ã‚’è¨­å®š
    span.SetAttributes(
        dbconv.DBSystemMySQL,
        dbconv.DBName(tw.dbName),
        dbconv.DBStatement(query),
        dbconv.DBOperation(extractOperation(query)),
        attribute.String("db.sql.table", extractTable(query)),
    )

    start := time.Now()
    rows, err := fn()
    duration := time.Since(start)

    span.SetAttributes(attribute.Int64("db.duration_ms", duration.Milliseconds()))

    if err != nil {
        span.RecordError(err)
        span.SetStatus(codes.Error, err.Error())
    }

    return rows, err
}

func (tw *TracingWrapper) traceExec(ctx context.Context, query string, args []interface{}, fn func() (sql.Result, error)) (sql.Result, error) {
    tracer := otel.Tracer("aws-observability-ecommerce")

    ctx, span := tracer.Start(ctx, "db.exec", trace.WithSpanKind(trace.SpanKindClient))
    defer span.End()

    // DBå±æ€§ã‚’è¨­å®š
    span.SetAttributes(
        dbconv.DBSystemMySQL,
        dbconv.DBName(tw.dbName),
        dbconv.DBStatement(query),
        dbconv.DBOperation(extractOperation(query)),
        attribute.String("db.sql.table", extractTable(query)),
    )

    start := time.Now()
    result, err := fn()
    duration := time.Since(start)

    span.SetAttributes(attribute.Int64("db.duration_ms", duration.Milliseconds()))

    if err != nil {
        span.RecordError(err)
        span.SetStatus(codes.Error, err.Error())
    } else if result != nil {
        if rowsAffected, err := result.RowsAffected(); err == nil {
            span.SetAttributes(attribute.Int64("db.rows_affected", rowsAffected))
        }
    }

    return result, err
}

// extractOperation ã¯SQLã‚¯ã‚¨ãƒªã‹ã‚‰æ“ä½œç¨®åˆ¥ã‚’æŠ½å‡º
func extractOperation(query string) string {
    if len(query) < 6 {
        return "unknown"
    }
    return strings.ToUpper(strings.Split(strings.TrimSpace(query), " ")[0])
}

// extractTable ã¯SQLã‚¯ã‚¨ãƒªã‹ã‚‰ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’æŠ½å‡ºï¼ˆç°¡æ˜“ç‰ˆï¼‰
func extractTable(query string) string {
    // ç°¡æ˜“çš„ãªå®Ÿè£…ï¼ˆæœ¬æ ¼çš„ã«ã¯SQLãƒ‘ãƒ¼ã‚µãƒ¼ãŒå¿…è¦ï¼‰
    query = strings.ToLower(strings.TrimSpace(query))

    if strings.HasPrefix(query, "select") {
        if idx := strings.Index(query, "from "); idx != -1 {
            parts := strings.Fields(query[idx+5:])
            if len(parts) > 0 {
                return strings.Trim(parts[0], "`")
            }
        }
    } else if strings.HasPrefix(query, "insert into ") {
        parts := strings.Fields(query[12:])
        if len(parts) > 0 {
            return strings.Trim(parts[0], "`")
        }
    } else if strings.HasPrefix(query, "update ") {
        parts := strings.Fields(query[7:])
        if len(parts) > 0 {
            return strings.Trim(parts[0], "`")
        }
    } else if strings.HasPrefix(query, "delete from ") {
        parts := strings.Fields(query[12:])
        if len(parts) > 0 {
            return strings.Trim(parts[0], "`")
        }
    }

    return "unknown"
}
```

#### 4.4.2. DBManagerä¿®æ­£

```go
// connection.go ã®ä¿®æ­£
func NewDBManager(dbConfig config.DatabaseConfig) (*DBManager, error) {
    // æ—¢å­˜ã®DBæ¥ç¶šå‡¦ç†...

    // ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’é©ç”¨
    tracingDB := NewTracingWrapper(db, dbConfig.Name)

    return &DBManager{db: tracingDB.DB}, nil
}
```

### 4.5. å„å±¤ã§ã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°å®Ÿè£…

#### 4.5.1. UseCaseå±¤ã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°

```go
// product/application/usecase/upload_product_image.go ã®ä¿®æ­£ä¾‹
func (uc *UploadProductImageUseCase) Execute(ctx context.Context, req *dto.UploadImageRequest) (*dto.UploadImageResponse, error) {
    tracer := otel.Tracer("aws-observability-ecommerce")

    ctx, span := tracer.Start(ctx, "usecase.upload_product_image", trace.WithAttributes(
        attribute.String("app.layer", "usecase"),
        attribute.String("app.domain", "product"),
        attribute.String("app.operation_name", "upload_product_image"),
        attribute.Int64("app.entity_id", req.ProductID),
        attribute.String("app.filename", req.Filename),
        attribute.Int("app.file_size_bytes", len(req.ImageData)),
    ))
    defer span.End()

    // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè¡Œ...

    if err != nil {
        span.RecordError(err)
        span.SetStatus(codes.Error, err.Error())
        span.SetAttributes(attribute.String("error.type", "business_logic_error"))
    }

    return response, err
}
```

#### 4.5.2. Repositoryå±¤ã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°

```go
// product/infrastructure/persistence/repository ã®ä¿®æ­£ä¾‹
func (r *ProductRepositoryImpl) Save(ctx context.Context, product *entity.Product) error {
    tracer := otel.Tracer("aws-observability-ecommerce")

    ctx, span := tracer.Start(ctx, "repository.save_product", trace.WithAttributes(
        attribute.String("app.layer", "repository"),
        attribute.String("app.operation", "save"),
        attribute.String("app.entity_type", "product"),
        attribute.String("app.entity_id", product.ID().String()),
    ))
    defer span.End()

    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œï¼ˆè‡ªå‹•çš„ã«DBãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãŒé©ç”¨ã•ã‚Œã‚‹ï¼‰

    return err
}
```

#### 4.5.3. å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°

```go
// product/infrastructure/external/storage/s3_image_storage_impl.go ã®ä¿®æ­£ä¾‹
func (s *S3ImageStorageImpl) Upload(ctx context.Context, key string, data []byte) (string, error) {
    tracer := otel.Tracer("aws-observability-ecommerce")

    ctx, span := tracer.Start(ctx, "s3.upload", trace.WithAttributes(
        attribute.String("rpc.service", "aws.s3"),
        attribute.String("aws.s3.bucket", s.bucketName),
        attribute.String("aws.s3.key", key),
        attribute.Int("aws.s3.object_size", len(data)),
    ))
    defer span.End()

    // S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†...

    if err != nil {
        span.RecordError(err)
        span.SetStatus(codes.Error, err.Error())
    }

    return url, err
}
```

## 5. ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æˆ¦ç•¥

### 5.1. ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æ–¹å¼

| ç’°å¢ƒ                 | ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æˆ¦ç•¥ | è¨­å®šå€¤       | ç†ç”±                   |
| -------------------- | ---------------- | ------------ | ---------------------- |
| **é–‹ç™ºç’°å¢ƒ**         | å…¨ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°   | `1.0` (100%) | é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨       |
| **ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ** | Ratio Based      | `0.1` (10%)  | è² è·ãƒ†ã‚¹ãƒˆæ™‚ã®æ€§èƒ½ç¢ºèª |
| **æœ¬ç•ªç’°å¢ƒ**         | Ratio Based      | `0.01` (1%)  | æœ¬ç•ªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¶­æŒ |

#### 5.1.1. å‹•çš„ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ï¼ˆå°†æ¥æ‹¡å¼µï¼‰

```go
// å°†æ¥çš„ãªå®Ÿè£…: ã‚¨ãƒ©ãƒ¼æ™‚ã¯é«˜ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°
type AdaptiveSampler struct {
    baseSampler trace.Sampler
    errorSampler trace.Sampler
}

func (s *AdaptiveSampler) ShouldSample(parameters trace.SamplingParameters) trace.SamplingResult {
    // ã‚¨ãƒ©ãƒ¼æ¤œå‡ºæ™‚ã¯é«˜ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°
    if isErrorContext(parameters.Attributes) {
        return s.errorSampler.ShouldSample(parameters)
    }
    return s.baseSampler.ShouldSample(parameters)
}
```

### 5.2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …

| é …ç›®               | å¯¾ç­–                               | æœŸå¾…åŠ¹æœ   |
| ------------------ | ---------------------------------- | ---------- |
| **CPUä½¿ç”¨ç‡**      | ãƒãƒƒãƒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€è»½é‡å±æ€§       | +2-5% ä»¥å†… |
| **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**   | ã‚­ãƒ¥ãƒ¼ã‚µã‚¤ã‚ºåˆ¶é™ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š | +10MBä»¥å†…  |
| **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**   | åœ§ç¸®ã€ãƒãƒƒãƒé€ä¿¡                   | æœ€å°åŒ–     |
| **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“** | éåŒæœŸã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ                 | å½±éŸ¿ãªã—   |

## 6. è¨­å®šãƒ»ç®¡ç†

### 6.1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µ

#### 6.1.1. config.yaml ã®æ‹¡å¼µ

```yaml
observability:
  otel:
    service_name: "aws-observability-ecommerce"
    service_version: "1.0.0"
    service_namespace: "ecommerce"
    deployment_environment: "development"

    collector:
      endpoint: "otel-collector:4318"
      timeout: "10s"
      retry_enabled: true
      compression: "gzip"

    # æ–°è¦è¿½åŠ : ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°è¨­å®š
    tracing:
      enabled: true
      sampling_ratio: 1.0            # é–‹ç™ºç’°å¢ƒ: 100%
      batch_timeout: "1s"
      max_queue_size: 2048
      max_export_batch_size: 512
      export_timeout: "30s"
```

#### 6.1.2. ç’°å¢ƒåˆ¥è¨­å®šä¾‹

**é–‹ç™ºç’°å¢ƒï¼ˆconfig.dev.yamlï¼‰**

```yaml
observability:
  otel:
    tracing:
      enabled: true
      sampling_ratio: 1.0            # å…¨ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°
```

**æœ¬ç•ªç’°å¢ƒï¼ˆconfig.prod.yamlï¼‰**

```yaml
observability:
  otel:
    tracing:
      enabled: true
      sampling_ratio: 0.01           # 1%ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°
```

### 6.2. ç’°å¢ƒå¤‰æ•°

| ç’°å¢ƒå¤‰æ•°å                   | èª¬æ˜                     | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ä¾‹     |
| ---------------------------- | ------------------------ | ---------- | ------ |
| `OTEL_TRACES_ENABLED`        | ãƒˆãƒ¬ãƒ¼ã‚¹æœ‰åŠ¹åŒ–           | `true`     | `true` |
| `OTEL_TRACES_SAMPLING_RATIO` | ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æ¯”ç‡         | `1.0`      | `0.01` |
| `OTEL_TRACES_BATCH_TIMEOUT`  | ãƒãƒƒãƒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ       | `1s`       | `5s`   |
| `OTEL_TRACES_MAX_QUEUE_SIZE` | ã‚­ãƒ¥ãƒ¼ã‚µã‚¤ã‚º             | `2048`     | `1024` |
| `OTEL_TRACES_EXPORT_TIMEOUT` | ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | `30s`      | `60s`  |

## 7. æ¤œè¨¼ãƒ»ãƒ†ã‚¹ãƒˆè¨ˆç”»

### 7.1. å˜ä½“ãƒ†ã‚¹ãƒˆ

#### 7.1.1. ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ ãƒ†ã‚¹ãƒˆ

```go
func TestTracingMiddleware(t *testing.T) {
    tests := []struct {
        name         string
        method       string
        path         string
        expectedSpan bool
    }{
        {"GET request", "GET", "/products", true},
        {"POST request", "POST", "/products/1/image", true},
        {"Error request", "GET", "/non-existent", true},
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            // ãƒ†ã‚¹ãƒˆå®Ÿè£…...
        })
    }
}
```

#### 7.1.2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚° ãƒ†ã‚¹ãƒˆ

```go
func TestDatabaseTracing(t *testing.T) {
    // ã‚¹ãƒ‘ãƒ³åé›†ç”¨ã®ãƒ†ã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼
    exporter := tracetest.NewInMemoryExporter()

    // ãƒ†ã‚¹ãƒˆç”¨TracerProvider
    tp := sdktrace.NewTracerProvider(
        sdktrace.WithSyncer(exporter),
    )
    otel.SetTracerProvider(tp)

    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œå®Ÿè¡Œ
    ctx := context.Background()
    rows, err := tracingDB.QueryContext(ctx, "SELECT * FROM products WHERE id = ?", 1)

    // ã‚¹ãƒ‘ãƒ³ã®æ¤œè¨¼
    spans := exporter.GetSpans()
    assert.Len(t, spans, 1)
    assert.Equal(t, "db.query", spans[0].Name)
    assert.Contains(t, spans[0].Attributes, attribute.String("db.system", "mysql"))
}
```

### 7.2. çµ±åˆãƒ†ã‚¹ãƒˆ

#### 7.2.1. ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ ãƒˆãƒ¬ãƒ¼ã‚¹æ¤œè¨¼

```go
func TestEndToEndTracing(t *testing.T) {
    // APIãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè¡Œ
    resp := httptest.NewRequest("GET", "/api/products/1", nil)

    // ãƒˆãƒ¬ãƒ¼ã‚¹æ¤œè¨¼
    // 1. HTTPã‚¹ãƒ‘ãƒ³ã®å­˜åœ¨ç¢ºèª
    // 2. UseCaseã‚¹ãƒ‘ãƒ³ã®å­˜åœ¨ç¢ºèª
    // 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ãƒ‘ãƒ³ã®å­˜åœ¨ç¢ºèª
    // 4. ã‚¹ãƒ‘ãƒ³éšå±¤æ§‹é€ ã®ç¢ºèª
    // 5. å±æ€§ã®æ­£ç¢ºæ€§ç¢ºèª
}
```

### 7.3. ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ

#### 7.3.1. Tempoé€£æºãƒ†ã‚¹ãƒˆ

1. **Tempoç¢ºèª**: Grafana UIã§ãƒˆãƒ¬ãƒ¼ã‚¹è¡¨ç¤ºç¢ºèª
2. **ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒƒãƒ—**: ã‚µãƒ¼ãƒ“ã‚¹é–“ã®é–¢ä¿‚ç¢ºèª
3. **ã‚¯ã‚¨ãƒªæ¤œç´¢**: ãƒˆãƒ¬ãƒ¼ã‚¹IDã§ã®æ¤œç´¢ç¢ºèª
4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã¸ã®å½±éŸ¿ç¢ºèª

#### 7.3.2. æ€§èƒ½ãƒ†ã‚¹ãƒˆ

```bash
# è² è·ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆä¾‹
for i in {1..1000}; do
  curl -X GET "http://localhost:8080/api/products" &
done
wait

# CPUãƒ»ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ç¢ºèª
docker stats backend-api
```

## 8. å®Ÿè£…æ‰‹é †

### 8.1. ãƒ•ã‚§ãƒ¼ã‚º1: åŸºç›¤å®Ÿè£…

**ç›®æ¨™**: ãƒˆãƒ¬ãƒ¼ã‚¹åŸºç›¤ã®æ§‹ç¯‰ã¨åˆæœŸå‹•ä½œç¢ºèª

**ä½œæ¥­é …ç›®**:

1. âœ… **è¨­å®šæ‹¡å¼µ**
   - `observability_config.go` ã«ãƒˆãƒ¬ãƒ¼ã‚¹è¨­å®šè¿½åŠ 
   - ç’°å¢ƒå¤‰æ•°ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°è¿½åŠ 
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®š

2. âœ… **OTelManageræ‹¡å¼µ**
   - TraceProvideråˆæœŸåŒ–æ©Ÿèƒ½è¿½åŠ 
   - OTLP Trace Exporterè¨­å®š
   - ã‚µãƒ³ãƒ—ãƒ©ãƒ¼è¨­å®š

3. âœ… **åŸºæœ¬ãƒ†ã‚¹ãƒˆ**
   - ãƒˆãƒ¬ãƒ¼ã‚¹åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
   - è¨­å®šèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
   - Collectoræ¥ç¶šãƒ†ã‚¹ãƒˆ

**æˆåŠŸåŸºæº–**:

- [ ] ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã‚‹
- [ ] OTel Collectorã¨ã®æ¥ç¶šãŒç¢ºç«‹ã•ã‚Œã‚‹
- [ ] Tempoã§ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ãŒå—ä¿¡ã•ã‚Œã‚‹

### 8.2. ãƒ•ã‚§ãƒ¼ã‚º2: HTTPãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°

**ç›®æ¨™**: HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°å®Ÿè£…

**ä½œæ¥­é …ç›®**:

1. âœ… **ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å®Ÿè£…**
   - HTTPã‚¹ãƒ‘ãƒ³ç”Ÿæˆ
   - OpenTelemetry Semantic Conventionsæº–æ‹ 
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

2. âœ… **ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢çµ±åˆ**
   - router.goã§ã®æœ‰åŠ¹åŒ–
   - æ—¢å­˜ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ã®é †åºèª¿æ•´

3. âœ… **å‹•ä½œç¢ºèª**
   - å„APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã®ãƒˆãƒ¬ãƒ¼ã‚¹ç¢ºèª
   - ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒˆãƒ¬ãƒ¼ã‚¹ç¢ºèª

**æˆåŠŸåŸºæº–**:

- [ ] å…¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§HTTPã‚¹ãƒ‘ãƒ³ãŒç”Ÿæˆã•ã‚Œã‚‹
- [ ] é©åˆ‡ãªå±æ€§ãŒè¨­å®šã•ã‚Œã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼æ™‚ã«é©åˆ‡ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒè¨­å®šã•ã‚Œã‚‹
- [ ] Grafanaã§ãƒˆãƒ¬ãƒ¼ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹

### 8.3. ãƒ•ã‚§ãƒ¼ã‚º3: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°

**ç›®æ¨™**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°å®Ÿè£…

**ä½œæ¥­é …ç›®**:

1. âœ… **DBãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°å®Ÿè£…**
   - TracingWrapperä½œæˆ
   - SQLã‚¯ã‚¨ãƒªã®ã‚¹ãƒ‘ãƒ³ç”Ÿæˆ
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æƒ…å ±è¨˜éŒ²

2. âœ… **DBManagerçµ±åˆ**
   - connection.goã§ã®ãƒ©ãƒƒãƒ‘ãƒ¼é©ç”¨
   - SQLBoilerã¨ã®é€£æºç¢ºèª

3. âœ… **å‹•ä½œç¢ºèª**
   - CRUDæ“ä½œã§ã®ãƒˆãƒ¬ãƒ¼ã‚¹ç¢ºèª
   - ã‚¯ã‚¨ãƒªå®Ÿè¡Œæ™‚é–“è¨˜éŒ²ç¢ºèª

**æˆåŠŸåŸºæº–**:

- [ ] å…¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã§ã‚¹ãƒ‘ãƒ³ãŒç”Ÿæˆã•ã‚Œã‚‹
- [ ] ã‚¯ã‚¨ãƒªæ–‡ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æƒ…å ±ãŒè¨˜éŒ²ã•ã‚Œã‚‹
- [ ] HTTPã‚¹ãƒ‘ãƒ³ã¨DBã‚¹ãƒ‘ãƒ³ã®è¦ªå­é–¢ä¿‚ãŒæ­£ã—ã„

### 8.4. ãƒ•ã‚§ãƒ¼ã‚º4: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°

**ç›®æ¨™**: UseCaseãƒ»Repositoryãƒ»å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°å®Ÿè£…

**ä½œæ¥­é …ç›®**:

1. âœ… **UseCaseå±¤ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°**
   - ä¸»è¦UseCaseã¸ã®ã‚¹ãƒ‘ãƒ³è¿½åŠ 
   - ãƒ“ã‚¸ãƒã‚¹å±æ€§ã®è¨­å®š

2. âœ… **Repositoryå±¤ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°**
   - Repositoryæ“ä½œã®ã‚¹ãƒ‘ãƒ³è¿½åŠ 
   - ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£æƒ…å ±ã®è¨˜éŒ²

3. âœ… **å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°**
   - S3æ“ä½œã®ã‚¹ãƒ‘ãƒ³è¿½åŠ 
   - AWS APIå‘¼ã³å‡ºã—ã®è¨˜éŒ²

4. âœ… **ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ**
   - å®Œå…¨ãªãƒˆãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ­ãƒ¼ã®ç¢ºèª
   - ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒƒãƒ—ã®ç¢ºèª

**æˆåŠŸåŸºæº–**:

- [ ] ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒ¬ãƒ™ãƒ«ã§ã®è©³ç´°ãªãƒˆãƒ¬ãƒ¼ã‚¹ãŒå–å¾—ã§ãã‚‹
- [ ] ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒƒãƒ—ã§å‡¦ç†ãƒ•ãƒ­ãƒ¼ãŒå¯è¦–åŒ–ã•ã‚Œã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®åŸå› ç‰¹å®šãŒåŠ¹ç‡åŒ–ã•ã‚Œã‚‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ãŒç‰¹å®šå¯èƒ½ã«ãªã‚‹

---

**æœ€çµ‚æˆæœç‰©**:

- âœ… å®Œå…¨ã«å‹•ä½œã™ã‚‹åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ 
- âœ… Grafana Tempoã§ã®ãƒˆãƒ¬ãƒ¼ã‚¹å¯è¦–åŒ–
- âœ… é‹ç”¨ã«å¿…è¦ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»æ‰‹é †æ›¸
- âœ… æ€§èƒ½å½±éŸ¿ã®æ¤œè¨¼çµæœ

ã“ã®è¨­è¨ˆæ›¸ã«åŸºã¥ã„ã¦æ®µéšçš„ã«å®Ÿè£…ã‚’é€²ã‚ã‚‹ã“ã¨ã§ã€æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¸ã®å½±éŸ¿ã‚’æœ€å°åŒ–ã—ãªãŒã‚‰ã€åŠ¹æœçš„ãªåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°æ©Ÿèƒ½ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚
