# 1. AWS料金見積もり（Go Echo+sqlboiler+ALB+両オブザーバビリティパターン）

このAWS料金見積もりでは、指定された技術スタック（Go Echo、sqlboiler、slog、Next.js）と直接ALBを使用する構成（API Gateway不要）に基づいて、MVPと全機能実装のそれぞれのシナリオにおける料金を算出しています。また、オブザーバビリティの両パターン（AWS SDK v2とOpenTelemetry）の違いも考慮しています。

- [1. AWS料金見積もり（Go Echo+sqlboiler+ALB+両オブザーバビリティパターン）](#1-aws料金見積もりgo-echosqlboileralb両オブザーバビリティパターン)
  - [1.1. MVP実装の料金（API Gateway不要）](#11-mvp実装の料金api-gateway不要)
    - [1.1.1. コンピューティング](#111-コンピューティング)
    - [1.1.2. データストア](#112-データストア)
    - [1.1.3. ストレージ \& 配信](#113-ストレージ--配信)
    - [1.1.4. オブザーバビリティ - パターン1: AWS SDK v2](#114-オブザーバビリティ---パターン1-aws-sdk-v2)
    - [1.1.5. オブザーバビリティ - パターン2: OpenTelemetry](#115-オブザーバビリティ---パターン2-opentelemetry)
    - [1.1.6. ネットワーク](#116-ネットワーク)
    - [1.1.7. 合計（フリーティア適用前）](#117-合計フリーティア適用前)
  - [1.2. オブザーバビリティパターン別のコスト比較](#12-オブザーバビリティパターン別のコスト比較)
  - [1.3. 全機能実装の料金](#13-全機能実装の料金)
    - [1.3.1. コンピューティング](#131-コンピューティング)
    - [1.3.2. データストア](#132-データストア)
    - [1.3.3. ストレージ \& 配信](#133-ストレージ--配信)
    - [1.3.4. オブザーバビリティ（拡張）- パターン選択](#134-オブザーバビリティ拡張--パターン選択)
    - [1.3.5. メッセージング \& 通知](#135-メッセージング--通知)
    - [1.3.6. ネットワーク](#136-ネットワーク)
    - [1.3.7. 合計](#137-合計)
  - [1.4. Go言語 + Echo + sqlboilerによる最適化オプション](#14-go言語--echo--sqlboilerによる最適化オプション)
    - [1.4.1. コンテナ最適化](#141-コンテナ最適化)
    - [1.4.2. sqlboiler最適化](#142-sqlboiler最適化)
    - [1.4.3. OpenTelemetry vs AWS SDK v2 のコスト最適化](#143-opentelemetry-vs-aws-sdk-v2-のコスト最適化)
  - [1.5. 学習環境でのワークロード時間制限](#15-学習環境でのワークロード時間制限)
  - [1.6. オブザーバビリティ学習に特化したコスト計画](#16-オブザーバビリティ学習に特化したコスト計画)
    - [1.6.1. ステージ1: 基本AWS SDK v2実装（週20時間稼働）](#161-ステージ1-基本aws-sdk-v2実装週20時間稼働)
    - [1.6.2. ステージ2: OpenTelemetry追加実装（週10時間稼働）](#162-ステージ2-opentelemetry追加実装週10時間稼働)
    - [1.6.3. ステージ3: 完全なMVP構成（週20時間稼働）](#163-ステージ3-完全なmvp構成週20時間稼働)
  - [1.7. MySQL (RDS) 特有の最適化](#17-mysql-rds-特有の最適化)
  - [1.8. 学習目的に最適な段階的デプロイ戦略](#18-学習目的に最適な段階的デプロイ戦略)

## 1.1. MVP実装の料金（API Gateway不要）

### 1.1.1. コンピューティング

| サービス                      | 使用量                                 | 時間当たりコスト | 月額コスト |
| ----------------------------- | -------------------------------------- | ---------------- | ---------- |
| **Fargate (Go Echo)**         | 1 vCPU、2GB RAM、1タスク（24時間稼働） | $0.04625/時間    | $33.76     |
| **Application Load Balancer** | 1 ALB（API Gatewayの代わり）           | $0.0225/時間     | $16.43     |

### 1.1.2. データストア

| サービス        | 使用量            | 時間当たりコスト                                             | 月額コスト |
| --------------- | ----------------- | ------------------------------------------------------------ | ---------- |
| **RDS (MySQL)** | db.t3.micro、20GB | $0.026/時間（インスタンス）<br>+ $0.00273/時間（ストレージ） | $21.13     |

### 1.1.3. ストレージ & 配信

| サービス                     | 使用量                              | 時間当たりコスト    | 月額コスト |
| ---------------------------- | ----------------------------------- | ------------------- | ---------- |
| **S3 (Next.js静的アセット)** | 1GBストレージ、月間50,000リクエスト | N/A（使用量ベース） | $0.30      |
| **CloudFront**               | 50GBデータ転送、100,000リクエスト   | N/A（使用量ベース） | $4.50      |

### 1.1.4. オブザーバビリティ - パターン1: AWS SDK v2

| サービス                  | 使用量                                                   | 時間当たりコスト                | 月額コスト |
| ------------------------- | -------------------------------------------------------- | ------------------------------- | ---------- |
| **CloudWatch Logs**       | 10GB                                                     | N/A（使用量ベース）             | $5.00      |
| **CloudWatch Metrics**    | 15カスタムメトリクス                                     | $0.00625/時間（メトリクス）     | $4.50      |
| **CloudWatch Alarms**     | 8アラーム                                                | $0.0011/時間（アラーム）        | $0.80      |
| **CloudWatch Dashboards** | 2ダッシュボード                                          | $0.00834/時間（ダッシュボード） | $6.00      |
| **X-Ray**                 | 200,000トレース/月<br>1,000,000 X-Ray Traces Analyzed/月 | N/A（使用量ベース）             | $3.00      |

### 1.1.5. オブザーバビリティ - パターン2: OpenTelemetry

| サービス                     | 使用量                     | 時間当たりコスト                | 月額コスト |
| ---------------------------- | -------------------------- | ------------------------------- | ---------- |
| **CloudWatch Logs**          | 10GB                       | N/A（使用量ベース）             | $5.00      |
| **CloudWatch Metrics**       | 15カスタムメトリクス       | $0.00625/時間（メトリクス）     | $4.50      |
| **CloudWatch Alarms**        | 8アラーム                  | $0.0011/時間（アラーム）        | $0.80      |
| **CloudWatch Dashboards**    | 2ダッシュボード            | $0.00834/時間（ダッシュボード） | $6.00      |
| **ADOT Collector (Fargate)** | 0.5 vCPU、1GB RAM、1タスク | $0.02313/時間                   | $16.88     |
| **X-Ray**                    | 200,000トレース/月         | N/A（使用量ベース）             | $3.00      |

### 1.1.6. ネットワーク

| サービス | 使用量                    | 時間当たりコスト           | 月額コスト |
| -------- | ------------------------- | -------------------------- | ---------- |
| **VPC**  | NAT Gateway（必要な場合） | $0.045/時間（NAT Gateway） | $32.85     |

### 1.1.7. 合計（フリーティア適用前）

| オブザーバビリティパターン                 | 時間当たりコスト | 月額コスト   |
| ------------------------------------------ | ---------------- | ------------ |
| **パターン1: AWS SDK v2（24時間稼働）**    | 約$0.16/時間     | 約$119.00/月 |
| **パターン2: OpenTelemetry（24時間稼働）** | 約$0.18/時間     | 約$135.00/月 |

> **注意**: API Gatewayを使用しない代わりにALBを使用するため、ALBのコスト（$16.43/月）が加わりますが、API Gatewayのコスト（リクエスト単位で課金）がなくなります。30万リクエスト/月の場合、API Gatewayのコストは約$1.05/月なので、ALBの方がコスト高になります。ただし、ALBは固定費用でリクエスト数に関係なく一定なので、トラフィックが増えるとコスト効率が良くなります。

## 1.2. オブザーバビリティパターン別のコスト比較

| 比較項目                   | AWS SDK v2パターン            | OpenTelemetryパターン          |
| -------------------------- | ----------------------------- | ------------------------------ |
| **初期投資**               | 低め（既存のAWSサービスのみ） | 高め（ADOT Collector追加運用） |
| **運用コスト**             | 低め（$19.30/月）             | 高め（$36.18/月）              |
| **スケーラビリティコスト** | トレース量による従量課金      | 固定+トレース量による従量課金  |
| **ベンダーロックイン**     | 高い（AWS固有のサービス）     | 低い（標準規格でポータブル）   |

---

## 1.3. 全機能実装の料金

### 1.3.1. コンピューティング

| サービス                      | 使用量                                 | 時間当たりコスト    | 月額コスト    |
| ----------------------------- | -------------------------------------- | ------------------- | ------------- |
| **Fargate (Go Echo)**         | 1 vCPU、2GB RAM、3タスク（24時間稼働） | $0.04625/時間 × 3   | $101.28       |
| **Application Load Balancer** | 1 ALB                                  | $0.0225/時間        | $16.43        |
| **Lambda (イベント処理)**     | 1日あたり20,000リクエスト、複数関数    | N/A（使用量ベース） | $2.00 - $5.00 |

### 1.3.2. データストア

| サービス        | 使用量                              | 時間当たりコスト                                             | 月額コスト    |
| --------------- | ----------------------------------- | ------------------------------------------------------------ | ------------- |
| **RDS (MySQL)** | db.t3.small、50GB                   | $0.052/時間（インスタンス）<br>+ $0.00685/時間（ストレージ） | $43.13        |
| **DynamoDB**    | 5GBストレージ、基本的な読み書き容量 | N/A（使用量ベース）                                          | $1.50 - $3.00 |

### 1.3.3. ストレージ & 配信

| サービス                     | 使用量                               | 時間当たりコスト    | 月額コスト      |
| ---------------------------- | ------------------------------------ | ------------------- | --------------- |
| **S3 (Next.js静的アセット)** | 5GBストレージ、月間200,000リクエスト | N/A（使用量ベース） | $1.00 - $2.00   |
| **CloudFront**               | 100GBデータ転送、500,000リクエスト   | N/A（使用量ベース） | $10.00 - $15.00 |

### 1.3.4. オブザーバビリティ（拡張）- パターン選択

| サービス                         | 使用量                     | 時間当たりコスト               | 月額コスト |
| -------------------------------- | -------------------------- | ------------------------------ | ---------- |
| **CloudWatch Logs**              | 30GB                       | N/A（使用量ベース）            | $15.00     |
| **CloudWatch Metrics**           | 50カスタムメトリクス       | $0.02083/時間（メトリクス）    | $15.00     |
| **CloudWatch Alarms**            | 20アラーム                 | $0.00278/時間（アラーム）      | $2.00      |
| **CloudWatch Dashboards**        | 3ダッシュボード            | $0.0125/時間（ダッシュボード） | $9.00      |
| **X-Ray**                        | 200万トレース              | N/A（使用量ベース）            | $10.00     |
| **CloudWatch Synthetics**        | 5カナリア（1時間ごと）     | $0.00625/時間（カナリア）      | $4.50      |
| **CloudWatch RUM**               | 10万セッション             | N/A（使用量ベース）            | $10.00     |
| **ADOT Collector (Fargate)**     | 0.5 vCPU、1GB RAM、1タスク | $0.02313/時間                  | $16.88     |
| **Amazon Managed Grafana (AMG)** | 1ワークスペース、3ユーザー | $0.0375/時間（ワークスペース） | $27.00     |

### 1.3.5. メッセージング & 通知

| サービス        | 使用量          | 時間当たりコスト    | 月額コスト |
| --------------- | --------------- | ------------------- | ---------- |
| **SQS**         | 100万リクエスト | N/A（使用量ベース） | $0.40      |
| **SNS**         | 100万通知       | N/A（使用量ベース） | $0.50      |
| **EventBridge** | 100万イベント   | N/A（使用量ベース） | $1.00      |
| **SES**         | 1万メール       | N/A（使用量ベース） | $1.00      |

### 1.3.6. ネットワーク

| サービス | 使用量                   | 時間当たりコスト           | 月額コスト |
| -------- | ------------------------ | -------------------------- | ---------- |
| **VPC**  | NAT Gateway（24時間/日） | $0.045/時間（NAT Gateway） | $32.85     |

### 1.3.7. 合計

| オブザーバビリティパターン          | 時間当たりコスト  | 月額コスト             |
| ----------------------------------- | ----------------- | ---------------------- |
| **AWS SDK v2ベース（フル機能）**    | 約$0.35-0.40/時間 | 約$255.00 - $300.00/月 |
| **OpenTelemetryベース（フル機能）** | 約$0.38-0.43/時間 | 約$275.00 - $320.00/月 |

---

## 1.4. Go言語 + Echo + sqlboilerによる最適化オプション

### 1.4.1. コンテナ最適化

1. **Go言語の軽量コンテナ**
   - distrolessベースイメージの使用
   - マルチステージビルドによる最小化

   ```text
   Go静的バイナリのコンテナサイズ：~15-20MB（Node.jsの1/10以下）
   コンテナ起動時間：数百ミリ秒（重いアプリケーションの1/5-1/10）
   ```

2. **効率的なリソース使用**
   - Goの低メモリフットプリントを活かしたFargateタスク設定
   - 1 vCPU、2GB → 0.5 vCPU、1GB に縮小可能

   ```text
   最適化時Fargateコスト：$0.02313/時間 vs $0.04625/時間（約50%削減）
   月額削減額：約$16.88/タスク
   ```

### 1.4.2. sqlboiler最適化

1. **効率的なデータベースアクセス**
   - N+1クエリ問題を回避する設計
   - コネクションプールの最適化

   ```text
   RDS接続使用効率：約20-30%向上
   ```

2. **データベースアクセスの削減**
   - キャッシングの導入（Redis不要のインメモリキャッシュ）

   ```text
   データベースリクエスト削減：約30-40%
   ```

### 1.4.3. OpenTelemetry vs AWS SDK v2 のコスト最適化

1. **ハイブリッドアプローチ**
   - 学習目的で両方を実装しつつ、運用ではコスト効率の良い方を選択
   - AWS SDK v2: 簡単な設定で低コスト運用
   - OpenTelemetry: Collectorを必要に応じて起動/停止（常時稼働不要）

   ```text
   OpenTelemetry Collector コスト削減：$16.88/月 → $4.22/月（週1日8時間のみ稼働）
   ```

2. **サンプリング最適化**
   - 学習・検証後は必要十分なサンプリングレートに調整

   ```text
   X-Rayトレースコスト：$3.00 → $0.30/月（サンプリングレート10%）
   ```

## 1.5. 学習環境でのワークロード時間制限

| 設定                       | 稼働時間   | 費用削減率 | コスト（MVP、AWS SDK v2） | コスト（MVP、OpenTelemetry） |
| -------------------------- | ---------- | ---------- | ------------------------- | ---------------------------- |
| 24時間稼働                 | 730時間/月 | 0%         | $119.00/月                | $135.00/月                   |
| 平日のみ（月〜金）         | 522時間/月 | 約30%      | $83.30/月                 | $94.50/月                    |
| 業務時間のみ（平日8時間）  | 174時間/月 | 約75%      | $29.75/月（約$0.16/時間） | $33.75/月（約$0.18/時間）    |
| オンデマンド（必要時のみ） | 40時間/月  | 約95%      | $6.40/月（約$0.16/時間）  | $7.20/月（約$0.18/時間）     |

## 1.6. オブザーバビリティ学習に特化したコスト計画

学習目的でオブザーバビリティの2つのパターンを効率的に学ぶための段階的コスト計画：

### 1.6.1. ステージ1: 基本AWS SDK v2実装（週20時間稼働）

| サービス                   | 月間コスト    |
| -------------------------- | ------------- |
| Fargate (Go)               | $3.70         |
| RDS (MySQL)                | $5.28         |
| ALB                        | $4.11         |
| CloudWatch Logs (3GB)      | $1.50         |
| X-Ray (2万トレース)        | $0.30         |
| CloudWatch Metrics (基本)  | $1.13         |
| CloudWatch Dashboard (1個) | $1.50         |
| **合計**                   | **$17.52/月** |

### 1.6.2. ステージ2: OpenTelemetry追加実装（週10時間稼働）

| サービス             | 月間コスト    |
| -------------------- | ------------- |
| 基本インフラ（上記） | $15.72        |
| ADOT Collector       | $0.93         |
| 追加X-Ray料金        | $0.15         |
| **合計**             | **$18.60/月** |

### 1.6.3. ステージ3: 完全なMVP構成（週20時間稼働）

| サービス                 | 月間コスト    |
| ------------------------ | ------------- |
| 全サービス（両パターン） | $30.00        |
| **月間学習予算**         | **$30.00/月** |

## 1.7. MySQL (RDS) 特有の最適化

1. **RDSのスケジュールオン/オフ**
   - Go言語でAWS SDKを使用したスケジュールスクリプト

   ```go
   // RDS起動/停止のサンプルコード
   func StartRDSInstance(ctx context.Context, instanceID string) error {
       cfg, err := config.LoadDefaultConfig(ctx)
       if err != nil {
           return err
       }

       client := rds.NewFromConfig(cfg)
       _, err = client.StartDBInstance(ctx, &rds.StartDBInstanceInput{
           DBInstanceIdentifier: aws.String(instanceID),
       })
       return err
   }
   ```

2. **ストレージの最適化**
   - 学習環境では小規模ストレージから開始
   - 自動スケーリングは無効に

   ```text
   20GB → 10GBに削減: 月間$1.37削減
   ```

## 1.8. 学習目的に最適な段階的デプロイ戦略

1. **ローカル開発環境（コスト$0）**
   - Docker Composeで全スタック構築
   - LocalStackでAWSサービスエミュレーション
   - 機能実装とオブザーバビリティ基盤の検証

2. **最小限AWSデプロイ（週10時間、月$10-15）**
   - 必要最小限のリソースのみデプロイ
   - 自動スケジュールでリソース管理
   - 基本的なオブザーバビリティ実装

3. **フル機能検証（月$20-30、必要時のみ）**
   - 全機能とオブザーバビリティの検証
   - テスト後は自動停止
   - 検証結果の記録とコスト分析

このアプローチにより、両方のオブザーバビリティパターンを学びながら、コストを最小限に抑えることができます。
