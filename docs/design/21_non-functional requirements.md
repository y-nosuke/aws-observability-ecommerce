# 1. 非機能要件定義

## 1.1. 目次

- [1. 非機能要件定義](#1-非機能要件定義)
  - [1.1. 目次](#11-目次)
  - [1.2. はじめに](#12-はじめに)
    - [1.2.1. 目的](#121-目的)
    - [1.2.2. ゴール](#122-ゴール)
    - [1.2.3. 対象範囲](#123-対象範囲)
  - [1.3. 非機能要件一覧](#13-非機能要件一覧)
  - [1.4. まとめ](#14-まとめ)

## 1.2. はじめに

### 1.2.1. 目的

この文書は、「AWSオブザーバビリティ学習用eコマースアプリ」プロジェクトにおける非機能要件を定義するものです。本プロジェクトの主目的は、AWS環境におけるオブザーバビリティ（可観測性）の概念、ツール、プラクティスを実践的に学ぶことです。

したがって、ここで定義する非機能要件は、単にシステムの品質を担保するためだけでなく、**効果的な学習体験を提供するための基盤**として位置づけられます。各要件は、「何を観察・学習したいか」という観点から設定されています。

### 1.2.2. ゴール

- モダンなAWSオブザーバビリティスタック（ログ、メトリクス、トレース等）を体験する環境を提供する。
- パフォーマンス問題、エラー、障害発生時の調査・分析プロセスをシミュレーションできる環境を提供する。
- システムの挙動（スケーリング、フェイルオーバー等）とオブザーバビリティデータの関連性を理解できる環境を提供する。
- オブザーバビリティツールのコストや設定のトレードオフを考察できる機会を提供する。

### 1.2.3. 対象範囲

この文書で定義する非機能要件は、eコマースアプリケーション本体、それを支えるAWSインフラストラクチャ、およびオブザーバビリティ関連ツール・設定に適用されます。

## 1.3. 非機能要件一覧

| カテゴリ               | 要件ID                     | 要件概要                                                                        | 学習目標・観察ポイント                                                                                                                                                          | 目標レベル (MVP) | 目標レベル (推奨) |
| :--------------------- | :------------------------- | :------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :--------------: | :---------------: |
| **オブザーバビリティ** | **NFR-SYS-OBS-LOG-01**     | 主要コンポーネントのログを収集し、構造化形式で出力する                          | CloudWatch Logs Insights等でのログ検索、フィルタリング、基本的な分析（エラー特定、リクエスト追跡）                                                                              |        ✅         |                   |
|                        | **NFR-SYS-OBS-MET-01**     | 主要コンポーネントの基本的なシステムメトリクス・アプリメトリクスを収集する      | CloudWatch Metricsでのメトリクス可視化、リソース使用状況の把握、パフォーマンス指標（レイテンシ、エラー率）の確認                                                                |        ✅         |                   |
|                        | **NFR-DEV-OBS-MET-01**     | 主要なビジネスイベントに関するカスタムメトリクスを収集する                      | EMF等を利用したカスタムメトリクス実装、ビジネスKPIとシステム挙動の関連付け (実装はDEV)                                                                                          |        ✅         |                   |
|                        | **NFR-SYS-OBS-TRC-01**     | 主要なリクエストパスにおける分散トレーシングを実装する                          | X-Ray等でのサービスマップ表示、リクエストのEnd-to-End追跡、コンポーネント間のレイテンシ分析、ボトルネックの特定                                                                 |        ✅         |                   |
|                        | **NFR-SRE-OBS-DASH-01**    | システム全体の健全性を把握するための基本的なダッシュボードを作成する            | CloudWatch Dashboard等での主要メトリクス・ログウィジェットの統合、SLIの視覚化練習、監視すべき指標の検討 (作成・利用はSRE)                                                       |                  |         ✅         |
|                        | **NFR-SRE-OBS-ALT-01**     | 主要なメトリクスやログパターンに基づいてアラートを設定し、通知する              | CloudWatch Alarm等でのアラート設定、閾値設定の練習、アラート通知の受信体験、誤検知/見逃しの考察 (設定・対応はSRE)                                                               |                  |         ✅         |
|                        | **NFR-SRE-OBS-RUM-01**     | フロントエンドのパフォーマンス（Web Vitals等）とエラーを収集する                | CloudWatch RUM等でのリアルユーザー体験データの分析、フロントエンド起因の問題特定、地域/ブラウザ別分析 (設定・分析はSRE)                                                         |                  |         ✅         |
|                        | **NFR-DEV-OBS-OTL-01**     | OpenTelemetry (OTel) SDK/Collectorを利用した計装・データ収集を行う              | OTelの概念理解、標準化された計装方法の学習、ADOT等のエコシステムの活用、AWSネイティブ計装との比較 (実装はDEV)                                                                   |                  |     (Option)      |
| **パフォーマンス**     | **NFR-SRE-PERF-01**        | 主要APIのレスポンスタイムが現実的な範囲内であること（例: p90 < 1秒）            | 性能測定ツールの利用、ベースライン性能の把握、性能劣化時のオブザーバビリティデータ変化の観察 (監視はSRE)                                                                        |        ✅         |                   |
|                        | **NFR-SRE-PERF-02**        | 意図的にパフォーマンスを劣化させるシナリオを実行可能にする                      | 性能問題発生時のログ・メトリクス・トレースを用いた原因調査プロセスの練習 (調査練習はSRE/DEV)                                                                                    |                  |         ✅         |
| **スケーラビリティ**   | **NFR-SRE-SCAL-01**        | 主要なコンポーネント（Lambda, Fargate）で基本的な自動スケーリングを設定する     | 負荷変動時のリソース増減、関連メトリクス（使用率、キュー長等）の観察、スケーリングイベントのログ/トレース確認、設定チューニングによる挙動変化の学習 (設定・監視はSRE)           |        ✅         |                   |
|                        | **NFR-SRE-SCAL-02**        | 負荷テストツール等でトラフィックを生成し、スケール挙動を観察可能にする          | スケールアウト/インのトリガー条件と応答時間の確認、限界性能の把握、スケーリングに伴うパフォーマンス変化の観察 (実施・観察はSRE)                                                 |                  |         ✅         |
| **可用性**             | **NFR-SRE-AVAIL-01**       | 主要コンポーネントを複数のAZに配置するなど、基本的な冗長構成をとる              | Multi-AZ構成の理解、障害発生時のサービス継続性の確認（限定的でも可） (設計・確認はSRE)                                                                                          |        ✅         |                   |
|                        | **NFR-SRE-AVAIL-CHAOS-01** | AWS FIS等を用いて意図的に障害（インスタンス停止、レイテンシ注入等）を発生させる | カオスエンジニアリングの体験、障害発生時のシステム応答（エラー、レイテンシ）の観察、フェイルオーバー/回復プロセスの確認、オブザーバビリティツールの有効性評価 (実施・評価はSRE) |                  |         ✅         |
| **セキュリティ**       | **NFR-SEC-AUTH-01**        | ユーザー認証・認可が適切に実装されていること                                    | 認証関連ログの確認、不正アクセス試行のログ分析練習 (確認はSEC)                                                                                                                  |        ✅         |                   |
|                        | **NFR-SEC-LOG-01**         | セキュリティ関連ログ（CloudTrail, GuardDuty等）を収集・確認可能にする           | CloudTrailでのAPI操作追跡、GuardDuty Findingsの確認、Security Hubでのセキュリティ状況把握、インシデント調査における関連ログ活用の練習 (収集設定・確認はSEC/SRE)                 |                  |         ✅         |
| **保守性**             | **NFR-SRE-MAINT-IAC-01**   | 主要なインフラ構成をIaC（Terraform, CDK等）で管理する                           | IaCによる環境構築・変更の体験、構成ドリフトの検出、インフラ定義と実際の状態の比較 (管理はSRE)                                                                                   |        ✅         |                   |
|                        | **NFR-DEV-MAINT-CODE-01**  | アプリケーションコードが一定の可読性を持ち、修正が容易であること                | コード変更時のデプロイプロセス確認、変更に伴うオブザーバビリティデータへの影響観察 (実装はDEV)                                                                                  |        ✅         |                   |
| **運用性**             | **NFR-DEV-OP-CICD-01**     | 基本的なCI/CDパイプラインを通じてアプリケーションをデプロイする                 | デプロイプロセスの自動化体験、デプロイ頻度と安定性の関係考察、デプロイ失敗時のロールバック/原因調査練習 (構築はDEV/SRE)                                                         |        ✅         |                   |
|                        | **NFR-SRE-OP-MON-01**      | ダッシュボードを用いてシステムの稼働状況を日常的に監視するプロセスを模倣する    | ダッシュボードの有効性評価、監視ルーティンの確立練習 (実施はSRE)                                                                                                                |                  |         ✅         |
|                        | **NFR-SRE-OP-ALERT-01**    | アラート通知を受け、インシデント対応プロセス（調査、記録、報告）を模倣する      | アラート疲れの体験、効果的なアラート設定の考察、インシデント調査ツールの活用練習 (実施はSRE)                                                                                    |                  |         ✅         |
| **コスト効率**         | **NFR-SRE-COST-VIS-01**    | AWS利用コスト（特にオブザーバビリティ関連）を可視化・把握できる                 | Cost Explorer等でのコスト分析、サービス別/タグ別コストの内訳確認、オブザーバビリティツールのコスト構造理解 (確認はSRE)                                                          |                  |         ✅         |
|                        | **NFR-SRE-COST-OPT-01**    | 不要なログや過剰なメトリクス収集など、コスト削減の可能性を検討する              | ログ/メトリクスの保持期間設定、サンプリングレート調整、リソースサイジング見直しなど、コスト最適化手法の学習 (検討・実施はSRE)                                                   |                  |         ✅         |

**ID割り当ての考え方:**

- **ペルソナ略称:**
  - `SYS`: システム全体に関わる基本的な仕組み（ログ収集基盤など）
  - `DEV`: 主に開発者が実装や学習に関わるもの（カスタムメトリクス実装、コード保守性、OTel実装など）
  - `SRE`: 主にSREが設定、監視、運用、学習に関わるもの（ダッシュボード、アラート、パフォーマンス監視、スケーリング、可用性、IaC、コストなど）
  - `SEC`: 主にセキュリティ担当が関わるもの（認証、セキュリティログ）
- **機能エリア略称:**
  - オブザーバビリティ関連は `OBS-` の後に詳細（LOG, MET, TRC, DASH, ALT, RUM, OTL）を追加。
  - その他のカテゴリはカテゴリ名を略称として使用（PERF, SCAL, AVAIL, AUTH, LOG(SEC用), MAINT, OP, COST）。
  - 可用性のカオスエンジニアリングは `AVAIL-CHAOS` とした。
  - 保守性のIaCは `MAINT-IAC`、コードは `MAINT-CODE` とした。
  - 運用性のCI/CDは `OP-CICD`、監視は `OP-MON`、アラート対応は `OP-ALERT` とした。
  - コスト効率の可視化は `COST-VIS`、最適化は `COST-OPT` とした。

**注記:**

- **目標レベル (MVP):** オブザーバビリティ学習を開始するための最低限必要な要件。
- **目標レベル (推奨):** より実践的で深い学習体験を得るために推奨される要件。
- **(Option):** 学習者の興味や時間に応じて選択的に導入を検討する要件 (例: OpenTelemetry)。
- 具体的な目標値（例: レスポンスタイムの秒数、稼働率%）は厳密に定義せず、「学習に必要なレベル」であることを重視します。

## 1.4. まとめ

上記の非機能要件は、AWS環境におけるオブザーバビリティの実践的な学習を支援するために設計されています。これらの要件を満たす環境を構築・利用することで、ログ、メトリクス、トレースといった基本的な要素から、ダッシュボード、アラート、さらにはパフォーマンスチューニング、障害対応、コスト最適化といった応用的なプラクティスまで、幅広く体験し、理解を深めることができるでしょう。
