# AWSオブザーバビリティ学習用eコマースアプリ - 詳細タスク計画

## フェーズ0: 環境準備（1-2日）

### Day 1: AWS環境セットアップ

1. **AWS アカウント準備**
   - [x] AWS IAMユーザー作成（管理者権限）
   - [x] アクセスキー/シークレットキーの安全な管理設定
   - [x] MFAの有効化

2. **インフラコード準備**
   - [x] 基本的なTerraformファイル作成（または AWS CDK/CloudFormation）
     - [x] `main.tf`: プロバイダー設定
     - [x] `network.tf`: VPC、サブネット、セキュリティグループ
     - [x] `backend.tf`: 状態ファイル管理用S3バケット
   - [x] GitHubリポジトリの作成

3. **基本リソースのプロビジョニング**
   - [x] VPCとサブネット（パブリック/プライベート）
   - [x] セキュリティグループのセットアップ
   - [x] 初期IAMロールの作成

### Day 2: CI/CDと基本インフラ

1. **CI/CDパイプラインのセットアップ**
   - [ ] GitHub Actionsワークフローファイル作成
     - [ ] インフラデプロイワークフロー
     - [ ] フロントエンドのビルド・デプロイワークフロー
   - [ ] デプロイ用S3バケット作成

2. **基本サービスリソースのプロビジョニング**
   - [ ] API Gatewayの作成
   - [ ] 商品カタログ用DynamoDBテーブル作成
   - [ ] LambdaまたはFargateのための基本リソース作成
   - [ ] CloudFront配信の設定

3. **開発環境の準備**
   - [ ] ローカル開発環境のセットアップ
   - [ ] AWS CLIの設定
   - [ ] 必要なSDKのインストール

## フェーズ1: MVPリリース（3-5日）

### Day 3: バックエンドの基本実装

1. **DynamoDBデータモデル実装**
   - [ ] 商品テーブルのスキーマ定義
   - [ ] カテゴリーテーブルのスキーマ定義
   - [ ] 初期データの作成スクリプト

2. **商品カタログAPIの実装**
   - [ ] バックエンドプロジェクト構造の作成
   - [ ] 商品一覧取得API実装（`GET /products`）
   - [ ] 商品詳細取得API実装（`GET /products/{id}`）
   - [ ] カテゴリー一覧取得API実装（`GET /categories`）
   - [ ] カテゴリー別商品取得API実装（`GET /categories/{id}/products`）

3. **基本的なオブザーバビリティ設定**
   - [ ] APIゲートウェイのログ設定
   - [ ] Lambda/ECSの基本ログ設定
   - [ ] DynamoDBのオペレーション監視設定

### Day 4: オブザーバビリティの基盤実装

1. **構造化ログの実装**
   - [ ] JSON形式のログフォーマット定義
   - [ ] ログレベル（INFO, ERROR）の設定
   - [ ] リクエストIDのログへの付与
   - [ ] コンテキスト情報の追加

2. **CloudWatch Metricsの設定**
   - [ ] カスタムメトリクスの定義（リクエスト数, エラー数, レスポンスタイム）
   - [ ] メトリクスのCloudWatchへの送信設定
   - [ ] 基本的なCloudWatchアラームの設定

3. **ヘルスチェックエンドポイントの実装**
   - [ ] `/health` エンドポイントの実装
   - [ ] DynamoDB接続状態の確認ロジック
   - [ ] システム基本情報の応答

### Day 5: フロントエンドMVP実装

1. **フロントエンドプロジェクト準備**
   - [ ] Next.jsプロジェクトのセットアップ
   - [ ] 基本レイアウトコンポーネントの作成
   - [ ] APIクライアントの実装

2. **商品表示UIの実装**
   - [ ] 商品一覧ページの実装
   - [ ] 商品詳細ページの実装
   - [ ] カテゴリーナビゲーションの実装
   - [ ] レスポンシブデザインの適用

3. **フロントエンドデプロイ**
   - [ ] S3バケットへのビルド成果物のデプロイ
   - [ ] CloudFrontキャッシュ設定の最適化
   - [ ] 基本的なエラーページの設定

4. **基本ダッシュボードの作成**
   - [ ] CloudWatch Dashboardの作成
   - [ ] APIリクエスト/レスポンスのグラフ追加
   - [ ] エラー率のグラフ追加
   - [ ] DynamoDBオペレーションのグラフ追加

## フェーズ2: 分散トレース導入（2-3日）

### Day 6: AWS X-Ray実装

1. **X-Ray SDKの統合**
   - [ ] バックエンドプロジェクトへのX-Ray SDKの追加
   - [ ] サンプリングルールの設定
   - [ ] トレースIDのログへの統合

2. **バックエンドトレースの実装**
   - [ ] アノテーションとメタデータの追加
   - [ ] DynamoDBクエリのサブセグメント作成
   - [ ] エラー情報のトレースへの追加
   - [ ] カスタムサブセグメントによる処理時間の追跡

3. **APIゲートウェイとX-Rayの統合**
   - [ ] APIゲートウェイでのX-Ray有効化
   - [ ] トレースヘッダーの転送設定
   - [ ] サービスマップの確認

### Day 7: 商品検索機能とカート実装

1. **商品検索機能の実装**
   - [ ] バックエンドに検索API実装（`GET /products/search`）
   - [ ] 単純なキーワード検索ロジックの実装
   - [ ] 検索結果の整形とペジネーション対応

2. **フロントエンド検索UIの実装**
   - [ ] 検索バーコンポーネントの実装
   - [ ] 検索結果ページの実装
   - [ ] 検索キーワードハイライト機能
   - [ ] "検索結果なし"の適切な処理

3. **クライアントサイドカート機能**
   - [ ] ローカルストレージを使用したカート状態管理
   - [ ] カートに商品追加機能の実装
   - [ ] カート内商品表示UIの実装
   - [ ] 数量変更・削除機能の実装

4. **トレースデータの可視化と分析**
   - [ ] X-Rayコンソールでのトレース分析
   - [ ] トレースデータに基づくボトルネック特定
   - [ ] サービスマップの分析

## フェーズ3: イベント駆動アーキテクチャと高度なモニタリング（2-3日）

### Day 8: イベント駆動アーキテクチャの実装

1. **EventBridgeの設定**
   - [ ] イベントバスのセットアップ
   - [ ] イベントルールの定義
   - [ ] イベントパターンの設定

2. **商品閲覧イベントの実装**
   - [ ] 商品詳細ページでのイベント発火
   - [ ] Lambda関数による閲覧イベント処理
   - [ ] ProductViewsテーブルへのデータ保存
   - [ ] 人気商品ランキングの集計ロジック

3. **在庫変動シミュレーターの実装**
   - [ ] 在庫データモデルの実装（DynamoDB）
   - [ ] 定期的に在庫を変動させるLambda関数
   - [ ] EventBridgeスケジュールルールの設定
   - [ ] 在庫状態の確認API実装

### Day 9: 高度なモニタリング導入

1. **CloudWatch Syntheticsの設定**
   - [ ] カナリアテスト用スクリプトの作成
     - [ ] 商品一覧ページチェック用カナリア
     - [ ] 商品詳細ページチェック用カナリア
     - [ ] 検索機能チェック用カナリア
   - [ ] カナリアスケジュールの設定
   - [ ] 成功/失敗通知の設定

2. **オブザーバビリティダッシュボードの拡張**
   - [ ] システム概要ダッシュボードの作成
   - [ ] イベント処理に関するメトリクスの追加
   - [ ] Syntheticsカナリアの結果表示
   - [ ] 在庫状態のメトリクス追加

3. **高度なアラート設定**
   - [ ] API失敗率アラートの設定
   - [ ] レスポンスタイム悪化アラートの設定
   - [ ] DynamoDB処理エラーアラートの設定
   - [ ] カナリアテスト失敗アラートの設定
   - [ ] SNS通知トピックのセットアップ

## フェーズ4: リアルユーザーモニタリングと異常検出（2-3日）

### Day 10: リアルユーザーモニタリング実装

1. **CloudWatch RUMのセットアップ**
   - [ ] RUMアプリケーションモニターの作成
   - [ ] フロントエンドへのRUMクライアントの統合
   - [ ] ページグループとユーザージャーニーの定義
   - [ ] カスタムイベントの設定

2. **フロントエンドパフォーマンス計測**
   - [ ] Webパフォーマンスメトリクスの収集設定（FCP, LCP等）
   - [ ] ユーザーインタラクション計測の実装
   - [ ] ページ遷移時間の計測
   - [ ] リソース読み込み時間の計測

3. **フロントエンドエラー収集**
   - [ ] グローバルエラーハンドラーの実装
   - [ ] Reactエラーバウンダリーの設定
   - [ ] JSエラーのRUMへの送信設定
   - [ ] エラーコンテキスト情報の付加

### Day 11: 異常検出と商品分析

1. **CloudWatch異常検出の設定**
   - [ ] APIリクエスト数の異常検出
   - [ ] エラー率の異常検出
   - [ ] レスポンスタイムの異常検出
   - [ ] 異常検出に基づくアラームの設定

2. **商品パフォーマンス分析の実装**
   - [ ] 商品閲覧データの集計Lambda実装
   - [ ] 商品別閲覧回数レポートの生成
   - [ ] カテゴリ別アクセスパターン分析
   - [ ] 人気商品リストAPIの実装

3. **商品パフォーマンスダッシュボード**
   - [ ] 商品別閲覧数のグラフ追加
   - [ ] カテゴリ別のトレンド分析グラフ追加
   - [ ] トップ閲覧商品ランキングの表示
   - [ ] 時間帯別のアクセスパターン可視化

### Day 12: 統合とQAテスト

1. **全体機能統合テスト**
   - [ ] エンドツーエンドの機能確認
   - [ ] オブザーバビリティスタックの動作確認
   - [ ] アラートのテスト発報確認
   - [ ] パフォーマンス指標の確認

2. **人為的障害テストと回復確認**
   - [ ] APIエラー発生時のトレース確認
   - [ ] 高負荷時のパフォーマンス測定
   - [ ] タイムアウト時のエラーハンドリング検証
   - [ ] システム回復プロセスの確認

3. **ドキュメント化**
   - [ ] システムアーキテクチャ図の作成
   - [ ] オブザーバビリティモニタリングの概要ドキュメント
   - [ ] アラート対応手順の文書化
   - [ ] 構築したダッシュボードの説明資料

## オプショナルな拡張（余裕がある場合）

### ユーザーサービスの追加

1. **ユーザー認証基盤の実装**
   - [ ] Cognito User Poolの設定
   - [ ] 認証APIエンドポイントの実装
   - [ ] JWTトークン処理の実装

2. **ユーザー登録・ログインUI**
   - [ ] 登録フォームの実装
   - [ ] ログインフォームの実装
   - [ ] プロフィール管理画面の実装

### 注文処理とメール通知の実装

1. **注文処理サービスの実装**
   - [ ] 注文データモデルの作成
   - [ ] 注文作成・管理APIの実装
   - [ ] カートから注文への変換ロジック

2. **非同期メール通知の実装**
   - [ ] SQSキューのセットアップ
   - [ ] メール送信Lambda実装
   - [ ] SESによるメール送信設定
   - [ ] テンプレートメール作成

### 高度な監視と分析

1. **Amazon Managed Grafanaの導入**
   - [ ] Grafanaワークスペースの作成
   - [ ] データソース連携（CloudWatch, X-Ray）
   - [ ] 高度なダッシュボード作成

2. **AWS Fault Injection Serviceの導入**
   - [ ] 基本的な障害注入実験の設計
   - [ ] 実験テンプレートの作成
   - [ ] 障害回復メカニズムの検証
