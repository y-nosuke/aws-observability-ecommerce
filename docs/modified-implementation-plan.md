# 修正版：AWSオブザーバビリティ学習用eコマースアプリ - 実装計画

## 基本方針

* 各フェーズを1週間以内に完了できる規模に縮小
* 早期に動作確認できる最小限の実装（MVP）を優先
* 段階的な機能追加で継続的な成功体験を得られるよう設計

## フェーズ0: 環境準備（1-2日）

1. **インフラ基盤の準備**
   * 簡略化したTerraformコードの作成（または AWS CDK/CloudFormation）
   * 最小限のAWSリソースプロビジョニング（VPC、基本セキュリティグループ）
   * デプロイパイプラインの簡易版セットアップ（GitHub Actions/AWS CodePipeline）

## フェーズ1: MVPリリース（3-5日）

1. **シンプルなeコマースアプリのコア機能**
   * **商品カタログサービス（単一サービス）**
     * 最小限の商品情報（名前、価格、画像URL、説明）
     * 商品一覧・詳細表示のみ実装
     * DynamoDBによるシンプルなデータストア
     * Lambda or Fargate + API Gatewayによるシンプルなバックエンド

   * **最小限のフロントエンド**
     * Next.jsによる商品一覧・詳細ページのみ実装
     * S3/CloudFrontによるホスティング
     * 最小限のUI（商品グリッド表示と詳細ページ）

2. **基本的なオブザーバビリティの実装**
   * **CloudWatch Logsの設定**
     * JSON形式のシンプルな構造化ログ
     * 基本的なログレベル設定（INFO, ERROR）
     * リクエストIDの付与

   * **CloudWatch Metricsの活用**
     * 最小限のメトリクス収集
       * リクエスト数
       * エラーカウント
       * レスポンスタイム
     * Lambda/Fargateの基本メトリクス監視

   * **シンプルなヘルスチェック**
     * `/health` エンドポイントの実装
     * 依存サービス（DynamoDB）の接続確認

   * **基本的なダッシュボード**
     * CloudWatch Dashboardsによるシンプルな可視化
     * APIリクエスト数・エラー数・レスポンスタイムのグラフ

## フェーズ2: 分散トレース導入（2-3日）

1. **X-Rayによる分散トレース**
   * AWS X-Ray SDKの統合
   * リクエスト追跡の実装
   * DynamoDBクエリのトレース
   * サービスマップの確認

2. **機能拡張**
   * **商品検索機能**
     * 単純なキーワード検索の実装
     * フロントエンドへの検索UI追加

   * **カート機能の最小実装**
     * クライアントサイドでの一時的なカート管理
     * カートに商品追加・削除機能

## フェーズ3: イベント駆動アーキテクチャと高度なモニタリング（2-3日）

1. **イベント駆動機能の導入**
   * **商品閲覧イベント**
     * EventBridgeを使用した商品閲覧イベントの記録
     * 人気商品ランキングのリアルタイム集計

   * **在庫変動シミュレーター**
     * 定期的な在庫数変更をシミュレート（Lambda + EventBridge）
     * 在庫不足アラートの設定

2. **高度なモニタリング**
   * **CloudWatch Syntheticsの導入**
     * シンプルなカナリアテスト実装
     * 定期的な商品一覧・詳細ページのチェック

   * **カスタムアラート設定**
     * APIエラー率アラート
     * レスポンスタイム悪化時のアラート
     * SNSによる通知設定

## フェーズ4: リアルユーザーモニタリングと異常検出（2-3日）

1. **クライアントサイドモニタリング**
   * **CloudWatch RUMの導入**
     * フロントエンドでのRUMスクリプト設定
     * ユーザー体験メトリクスの収集
     * ページロード時間の計測

   * **フロントエンドエラーの収集**
     * JavaScriptエラー捕捉
     * UI応答時間の計測

2. **異常検出の導入**
   * **CloudWatch異常検出の設定**
     * トラフィックパターンの学習
     * 異常なAPIコール回数の検出
     * 応答時間の異常検出

## マイルストーンとデモ可能ポイント

| タイミング | 成果物 | デモ可能な内容 |
|-----------|--------|--------------|
| 1-2日目 | 基本インフラ | AWSリソースのプロビジョニング状態 |
| 5日目 | MVP機能 | 商品一覧・詳細表示、基本ログの確認 |
| 7-8日目 | 分散トレース | X-Rayサービスマップ、トレース可視化 |
| 10-11日目 | イベント駆動機能 | リアルタイムイベント処理、カナリアテスト結果 |
| 13-14日目 | 完全なオブザーバビリティスタック | リアルユーザーモニタリング、異常検出 |

## オプショナルなさらなる拡張（余裕がある場合）

1. **ユーザーサービスの追加**
   * 最小限のユーザー登録・ログイン機能
   * JWT認証の実装

2. **注文処理サービスの実装**
   * 簡易注文フローの追加
   * 非同期処理によるメール通知（SQS + Lambda + SES）

3. **Grafanaダッシュボード**
   * Amazon Managed Grafanaの導入
   * 高度なダッシュボード作成

4. **耐障害性テスト**
   * 簡易的なカオスエンジニアリング実験
   * AWS Fault Injection Serviceを利用した障害シミュレーション
