# 1. AWS オブザーバビリティ学習用 eコマースアプリ - 機能開発・オブザーバビリティ統合学習計画

## 1.1. 目次

- [1. AWS オブザーバビリティ学習用 eコマースアプリ - 機能開発・オブザーバビリティ統合学習計画](#1-aws-オブザーバビリティ学習用-eコマースアプリ---機能開発オブザーバビリティ統合学習計画)
  - [1.1. 目次](#11-目次)
  - [1.2. プロジェクト概要](#12-プロジェクト概要)
    - [1.2.1. 概要](#121-概要)
    - [1.2.2. 学習目標の優先順位](#122-学習目標の優先順位)
    - [1.2.3. 技術スタック](#123-技術スタック)
  - [1.3. 学習フェーズ概要](#13-学習フェーズ概要)
    - [1.3.1. フェーズ1: 基盤構築と商品閲覧機能 (5週間)](#131-フェーズ1-基盤構築と商品閲覧機能-5週間)
    - [1.3.2. フェーズ2: 統合オブザーバビリティとサーバーレス (5週間)](#132-フェーズ2-統合オブザーバビリティとサーバーレス-5週間)
    - [1.3.3. フェーズ3: OpenTelemetryと高度なモニタリング (4週間)](#133-フェーズ3-opentelemetryと高度なモニタリング-4週間)
    - [1.3.4. フェーズ4: 注文機能とオブザーバビリティ拡張 (4週間)](#134-フェーズ4-注文機能とオブザーバビリティ拡張-4週間)
    - [1.3.5. フェーズ5: 管理機能と包括的モニタリング (3週間)](#135-フェーズ5-管理機能と包括的モニタリング-3週間)
    - [1.3.6. フェーズ6: 本番環境と耐障害性 (2週間)](#136-フェーズ6-本番環境と耐障害性-2週間)
  - [1.4. 詳細実装計画](#14-詳細実装計画)
    - [1.4.1. フェーズ1: 基盤構築と商品閲覧機能](#141-フェーズ1-基盤構築と商品閲覧機能)
      - [1.4.1.1. 週1: プロジェクト基盤構築](#1411-週1-プロジェクト基盤構築)
      - [1.4.1.2. 週2: データモデルと基本API](#1412-週2-データモデルと基本api)
      - [1.4.1.3. 週3: 商品カタログバックエンドの完成](#1413-週3-商品カタログバックエンドの完成)
      - [1.4.1.4. 週4: 顧客向け商品閲覧UI](#1414-週4-顧客向け商品閲覧ui)
      - [1.4.1.5. 週5: 管理画面の基本実装](#1415-週5-管理画面の基本実装)
    - [1.4.2. フェーズ2: 統合オブザーバビリティとサーバーレス](#142-フェーズ2-統合オブザーバビリティとサーバーレス)
      - [1.4.2.1. 週6: 統合ログ基盤の構築](#1421-週6-統合ログ基盤の構築)
      - [1.4.2.2. 週7: メトリクス収集システムの実装](#1422-週7-メトリクス収集システムの実装)
      - [1.4.2.3. 週8: 分散トレースの実装](#1423-週8-分散トレースの実装)
      - [1.4.2.4. 週9: 基本サーバーレス機能の実装](#1424-週9-基本サーバーレス機能の実装)
      - [1.4.2.5. 週10: サーバーレスオブザーバビリティ](#1425-週10-サーバーレスオブザーバビリティ)
    - [1.4.3. フェーズ3: OpenTelemetryと高度なモニタリング](#143-フェーズ3-opentelemetryと高度なモニタリング)
      - [1.4.3.1. 週11: OpenTelemetry基盤の構築](#1431-週11-opentelemetry基盤の構築)
      - [1.4.3.2. 週12: バックエンドのOpenTelemetry移行](#1432-週12-バックエンドのopentelemetry移行)
      - [1.4.3.3. 週13: RUMと合成モニタリングの実装](#1433-週13-rumと合成モニタリングの実装)
      - [1.4.3.4. 週14: アラートと異常検出](#1434-週14-アラートと異常検出)
    - [1.4.4. フェーズ4: 注文機能とオブザーバビリティ拡張](#144-フェーズ4-注文機能とオブザーバビリティ拡張)
      - [1.4.4.1. 週15: カート機能の実装](#1441-週15-カート機能の実装)
      - [1.4.4.2. 週16: 注文処理の実装](#1442-週16-注文処理の実装)
      - [1.4.4.3. 週17: 注文関連イベント処理の実装](#1443-週17-注文関連イベント処理の実装)
      - [1.4.4.4. 週18: 注文機能のオブザーバビリティ強化](#1444-週18-注文機能のオブザーバビリティ強化)
    - [1.4.5. フェーズ5: 管理機能と包括的モニタリング](#145-フェーズ5-管理機能と包括的モニタリング)
      - [1.4.5.1. 週19: 商品管理機能の拡張](#1451-週19-商品管理機能の拡張)
      - [1.4.5.2. 週20: 在庫管理システムの構築](#1452-週20-在庫管理システムの構築)
      - [1.4.5.3. 週21: 管理機能の包括的オブザーバビリティ](#1453-週21-管理機能の包括的オブザーバビリティ)
    - [1.4.6. フェーズ6: 本番環境と耐障害性](#146-フェーズ6-本番環境と耐障害性)
      - [1.4.6.1. 週22: AWS環境への本番デプロイ準備](#1461-週22-aws環境への本番デプロイ準備)
      - [1.4.6.2. 週23: 耐障害性とカオスエンジニアリング](#1462-週23-耐障害性とカオスエンジニアリング)
  - [1.5. AWS SDK v2とOpenTelemetryの比較学習](#15-aws-sdk-v2とopentelemetryの比較学習)
    - [1.5.1. 段階的移行アプローチ](#151-段階的移行アプローチ)
    - [1.5.2. 比較ポイント](#152-比較ポイント)
    - [1.5.3. 移行戦略](#153-移行戦略)
  - [1.6. オブザーバビリティの3本柱の統合学習](#16-オブザーバビリティの3本柱の統合学習)
    - [1.6.1. 統合アプローチの利点](#161-統合アプローチの利点)
    - [1.6.2. 実践的な統合ポイント](#162-実践的な統合ポイント)
    - [1.6.3. 相関分析の実装](#163-相関分析の実装)
  - [1.7. サーバーレスのオブザーバビリティ](#17-サーバーレスのオブザーバビリティ)
    - [1.7.1. サーバーレス固有の課題](#171-サーバーレス固有の課題)
    - [1.7.2. モニタリング戦略](#172-モニタリング戦略)
    - [1.7.3. 実装手法](#173-実装手法)
  - [1.8. 学習環境でのコスト管理](#18-学習環境でのコスト管理)
    - [1.8.1. フェーズ別コスト概算](#181-フェーズ別コスト概算)
    - [1.8.2. コスト最適化戦略](#182-コスト最適化戦略)
    - [1.8.3. 週あたりの学習時間を考慮した配分](#183-週あたりの学習時間を考慮した配分)
  - [1.9. 各段階での学習成果](#19-各段階での学習成果)
    - [1.9.1. フェーズ1の成果物](#191-フェーズ1の成果物)
    - [1.9.2. フェーズ2の成果物](#192-フェーズ2の成果物)
    - [1.9.3. フェーズ3の成果物](#193-フェーズ3の成果物)
    - [1.9.4. フェーズ4の成果物](#194-フェーズ4の成果物)
    - [1.9.5. フェーズ5の成果物](#195-フェーズ5の成果物)
    - [1.9.6. フェーズ6の成果物](#196-フェーズ6の成果物)

## 1.2. プロジェクト概要

### 1.2.1. 概要

このプロジェクトは、AWSのオブザーバビリティ機能を学習するためのeコマースアプリケーション開発計画です。オブザーバビリティの3本柱（ログ、メトリクス、トレース）をセットで学びながら、機能開発とオブザーバビリティ実装を並行して進めます。特にOpenTelemetryに重点を置き、AWS SDK v2との比較も行います。

### 1.2.2. 学習目標の優先順位

1. **OpenTelemetryの習得**：AWS SDKからOpenTelemetryへの移行と、その利点の理解
2. **オブザーバビリティの3本柱を統合的に学習**：ログ、メトリクス、トレースをセットで実装し理解する
3. **サーバーレスオブザーバビリティの早期学習**：Lambdaを用いたサーバーレス機能と観測手法を早期に学ぶ
4. **高度なモニタリング手法の習得**：RUM、合成モニタリング、異常検出等の高度なテクニックを学ぶ
5. **機能開発とオブザーバビリティの統合**：各機能の実装と同時にオブザーバビリティも実装する
6. **本番環境デプロイと耐障害性の理解**：実際のAWS環境でのデプロイと障害テストを通じた学習

### 1.2.3. 技術スタック

**フロントエンド:**

- Next.js (Reactベースのフレームワーク)
- TypeScript
- TailwindCSS
- AWS S3 + CloudFront (静的アセットホスティング)

**バックエンド:**

- Go言語 (Echo Webフレームワーク)
- sqlboiler (MySQLに特化したORM)
- OpenAPI (ogen でのコード生成)
- slog (構造化ログ)
- AWS Fargate (ECS)
- AWS Lambda (サーバーレス機能)
- MySQL (RDS)
- AWS ALB (Application Load Balancer)

**オブザーバビリティ:**

1. AWS SDK v2アプローチ
   - X-Ray SDK for Go v2
   - CloudWatch SDK v2
   - slog + CloudWatch Logs

2. OpenTelemetryアプローチ (優先的に学習)
   - OpenTelemetry Go SDK
   - AWS Distro for OpenTelemetry (ADOT)
   - X-Ray Exporter

## 1.3. 学習フェーズ概要

### 1.3.1. フェーズ1: 基盤構築と商品閲覧機能 (5週間)

**目標**: 開発環境の構築と商品閲覧機能（バックエンド、顧客画面、管理画面の基礎）の実装

- 開発環境のセットアップ（Docker、LocalStack、Go/Echo、Next.js）
- データモデルの設計と実装
- 商品カタログ機能のバックエンド実装
- 顧客向け商品閲覧UIの実装
- 管理画面の基本実装

**成果物**:

- 完全な開発環境
- 商品閲覧が可能なMVPアプリケーション
- 管理画面の基礎
- シンプルなログ機能

### 1.3.2. フェーズ2: 統合オブザーバビリティとサーバーレス (5週間)

**目標**: オブザーバビリティの3本柱を統合的に実装し、基本的なサーバーレス機能を導入

- 構造化ログの実装とCloudWatch Logs統合
- メトリクス収集システムの構築
- 分散トレースの実装
- 基本的なサーバーレス機能の実装（画像処理、バッチ処理）
- サーバーレス機能のオブザーバビリティ

**成果物**:

- 完全な統合オブザーバビリティシステム（ログ、メトリクス、トレース）
- 基本的なサーバーレス機能
- ダッシュボードと可視化ツール
- 相関分析の基盤

### 1.3.3. フェーズ3: OpenTelemetryと高度なモニタリング (4週間)

**目標**: AWS SDK v2からOpenTelemetryへの移行と、高度なモニタリング手法の実装

- OpenTelemetry基盤の構築
- バックエンドコードのOpenTelemetry移行
- 実ユーザーモニタリング（RUM）の実装
- 合成モニタリングの設定
- アラートと異常検出の実装

**成果物**:

- OpenTelemetry統合システム
- AWS SDK v2との比較分析
- 高度なモニタリングシステム
- 自動テストと検証フロー

### 1.3.4. フェーズ4: 注文機能とオブザーバビリティ拡張 (4週間)

**目標**: カートと注文機能の実装、およびそのオブザーバビリティの強化

- カート機能の実装
- 注文処理システムの実装
- 注文関連イベント処理の実装
- 注文フローのオブザーバビリティ強化
- マイクロサービス間のトレース連携

**成果物**:

- 完全な注文処理システム
- イベント駆動アーキテクチャ
- エンドツーエンドのオブザーバビリティ
- 高度なダッシュボード

### 1.3.5. フェーズ5: 管理機能と包括的モニタリング (3週間)

**目標**: 商品・在庫管理機能の拡張と、包括的モニタリングの実装

- 商品管理機能の拡張
- 在庫管理システムの構築
- 管理機能の包括的オブザーバビリティ
- ビジネスメトリクスと技術メトリクスの統合

**成果物**:

- 完全な管理システム
- 包括的モニタリングダッシュボード
- ビジネスインテリジェンス統合
- オブザーバビリティのベストプラクティス

### 1.3.6. フェーズ6: 本番環境と耐障害性 (2週間)

**目標**: AWS環境への本番デプロイと耐障害性テスト

- AWS環境へのデプロイ準備
- CI/CDパイプラインの構築
- AWS Fault Injection Serviceによる障害テスト
- カオスエンジニアリング実験
- パフォーマンス最適化

**成果物**:

- 本番環境デプロイ構成
- 自動化されたCI/CDパイプライン
- 障害対応プロセス
- 耐障害性のレポート

## 1.4. 詳細実装計画

### 1.4.1. フェーズ1: 基盤構築と商品閲覧機能

#### 1.4.1.1. 週1: プロジェクト基盤構築

- **開発環境のセットアップ**
  - Docker Compose環境の構築
  - MySQL、Traefik、LocalStackの設定
  - Go/Echo開発環境の準備
  - Next.js/TypeScript/TailwindCSSフロントエンド環境の準備
  - ホットリロード設定（air for Go、Next.js dev server）

- **GitHubリポジトリのセットアップ**
  - リポジトリの作成とブランチ戦略の設定
  - 基本的なCIワークフローの設定
  - コード品質チェックの設定
  - go-taskによるタスクランナーの設定

- **バックエンドの基本構造実装**
  - ディレクトリ構造とパッケージ設計
  - 基本的なミドルウェア設定
  - 設定管理モジュールの実装
  - ヘルスチェックAPIの実装

- **フロントエンドの基本構造実装**
  - Next.jsプロジェクト構成
  - 基本レイアウトの設計
  - API通信用のクライアント基本設定
  - コンポーネント設計の基礎

**学習ユースケース:**

- **DEV-01**: 開発環境の構築
- **OBS-07**: ヘルスチェック機能の実装

#### 1.4.1.2. 週2: データモデルと基本API

- **データベーススキーマの設計と実装**
  - MySQL接続設定
  - 主要テーブル（products, categories, inventory）の設計
  - golang-migrateによるマイグレーション管理
  - テストデータの準備

- **sqlboilerによるORM設定**
  - sqlboiler設定ファイルの作成
  - モデル生成スクリプトの準備
  - 基本的なデータアクセスレイヤーの実装
  - トランザクション管理の設計

- **OpenAPI仕様の初期定義**
  - API定義ファイルの作成
  - 商品関連APIの定義
  - ogenによるコード生成
  - 生成コードの統合

- **基本的なログ出力設定**
  - slogを使用した基本ログ設定
  - ログフォーマットの定義
  - ログレベルの設定
  - リクエスト/レスポンスログの設定

**学習ユースケース:**

- **DEV-02**: データベース設計と実装
- **DEV-03**: ORM設定と基本データアクセス
- **OBS-01**: 基本的なログ設定（発展前）
- **OBS-02**: ログレベル管理（発展前）

#### 1.4.1.3. 週3: 商品カタログバックエンドの完成

- **商品カタログAPIの実装**
  - 商品一覧APIの実装（ページネーション対応）
  - 商品詳細APIの実装
  - カテゴリー別商品一覧APIの実装
  - 商品検索APIの実装

- **バリデーションとエラーハンドリング**
  - 入力バリデーションの実装
  - エラーレスポンスの統一
  - エラー種別の定義
  - グローバルエラーハンドラの実装

- **バックエンドのテスト実装**
  - ユニットテストの実装
  - テーブル駆動テストの活用
  - モックを使用した依存関係の切り離し
  - インテグレーションテストの基礎

- **基本的なメトリクス収集の準備**
  - メトリクス定義の設計
  - Echo middlewareでのメトリクス収集ポイント特定
  - メトリクスタイプの定義
  - カウンタとヒストグラムの基本設計

**学習ユースケース:**

- **CUS-01**: 基本的な商品閲覧API
- **CUS-02**: 商品詳細確認API
- **CUS-03**: カテゴリー別閲覧API
- **DEV-04**: テスト実装の基礎

#### 1.4.1.4. 週4: 顧客向け商品閲覧UI

- **商品一覧ページの実装**
  - API連携の実装
  - 商品カードコンポーネントの作成
  - ページネーションコンポーネントの実装
  - ロード状態とエラー状態の表示

- **商品詳細ページの実装**
  - 商品詳細取得の実装
  - 画像表示の最適化
  - 在庫状況表示の実装
  - 関連商品表示の基礎実装

- **カテゴリーナビゲーションの実装**
  - カテゴリーリストの取得と表示
  - カテゴリーフィルター機能
  - パンくずナビゲーション
  - レスポンシブ対応

- **フロントエンドのテスト実装**
  - Reactコンポーネントのユニットテスト
  - Next.jsページのテスト
  - モックAPIレスポンスの設定
  - スナップショットテスト

**学習ユースケース:**

- **CUS-01**: 顧客向け商品閲覧機能（フロントエンド）
- **CUS-02**: 商品詳細確認（フロントエンド）
- **CUS-03**: カテゴリー別閲覧（フロントエンド）
- **CUS-04**: 在庫確認（基本表示）

#### 1.4.1.5. 週5: 管理画面の基本実装

- **管理画面レイアウトの実装**
  - 管理画面の基本レイアウト設計
  - ナビゲーションメニューの実装
  - 権限チェックの基本設計
  - 管理用共通コンポーネントの作成

- **商品管理の基本画面実装**
  - 商品一覧テーブルの実装
  - 基本フィルタリングと検索
  - 簡易編集機能の実装
  - 商品詳細閲覧

- **カテゴリー管理の基本画面実装**
  - カテゴリー一覧の表示
  - カテゴリー操作UIの実装
  - 階層構造の表示
  - ドラッグ&ドロップの基本設定

- **モック認証システムの実装**
  - モックログイン機能
  - JWT基本設定
  - 認証状態の管理
  - 保護されたルートの設定

**学習ユースケース:**

- **ADM-01**: 管理者認証（モック実装）
- **ADM-02**: 商品情報管理（基本UI）
- **A-PROD-01**: 商品情報管理（基本機能）

### 1.4.2. フェーズ2: 統合オブザーバビリティとサーバーレス

#### 1.4.2.1. 週6: 統合ログ基盤の構築

- **Terraformモジュール作成**
  - LocalStack用の基本設定
  - CloudWatch Logs用のリソース定義
  - IAMロールとポリシーの設定
  - ログ保持期間の設定

- **構造化ログの実装**
  - slogを使用した高度な構造化ログ設計
  - JSONフォーマッターの設定
  - カスタムログハンドラーの実装
  - コンテキスト情報の伝播設計

- **ログレベル管理の実装**
  - 環境別ログレベル設定
  - 動的ログレベル変更の実装
  - 詳細ログとサンプリングの設計
  - エラーログの強化

- **CloudWatch Logsへのログ転送**
  - CloudWatch Logsエージェントの設定
  - バッチ処理の最適化
  - フィルタリングとサンプリングの実装
  - エラー処理と再試行ロジック

**学習ユースケース:**

- **O-LOG-01**: 構造化ログ設定
- **O-LOG-02**: ログレベル管理
- **O-LOG-03**: CloudWatch Logsへのログ転送
- **O-LOG-04**: コンテキスト情報付与

#### 1.4.2.2. 週7: メトリクス収集システムの実装

- **CloudWatch Metrics基盤の構築**
  - CloudWatch Metricsリソースの設定
  - カスタムメトリクス名前空間の設計
  - ディメンション設計
  - メトリクスフィルターの設定

- **基本メトリクスの収集実装**
  - リクエスト数、レイテンシー、エラー率の計測
  - インフラメトリクス（CPU、メモリ、ディスクI/O）の収集
  - データベース関連メトリクスの設定
  - パーセンタイル計測の実装

- **ビジネスメトリクスの設計と実装**
  - ビジネスプロセスの計測ポイント特定
  - 商品閲覧、検索、カテゴリーナビゲーションの計測
  - ユーザーセッションの分析メトリクス
  - コンバージョンパス分析の基礎

- **メトリクスダッシュボードの作成**
  - CloudWatch Dashboardsの基本設定
  - REDダッシュボードの作成
  - システム健全性ダッシュボード
  - ビジネスダッシュボードの基本設計

**学習ユースケース:**

- **O-METRIC-01**: 基本メトリクス収集
- **O-METRIC-02**: インフラメトリクス収集
- **O-METRIC-03**: レスポンスタイム分布測定
- **O-METRIC-04**: ビジネスメトリクス収集
- **O-DASH-03**: REDダッシュボード
- **O-DASH-04**: カスタムダッシュボード

#### 1.4.2.3. 週8: 分散トレースの実装

- **X-Ray設定とセットアップ**
  - X-Rayリソースの設定
  - サンプリングルールの設計
  - アノテーションとメタデータの設計
  - グループの設定

- **バックエンドトレースの実装**
  - X-Ray SDK for Go v2の統合
  - Echoミドルウェアの設定
  - セグメントとサブセグメントの設計
  - エラーのトレース設定

- **データベースクエリのトレース**
  - sqlboilerとX-Rayの統合
  - クエリパフォーマンスの追跡
  - カスタムサブセグメントの追加
  - トランザクションのトレース

- **トレース可視化とフィルタリング**
  - X-Rayコンソールの設定
  - トレースマップの設定
  - フィルターの作成
  - トレース分析クエリの作成

**学習ユースケース:**

- **O-TRACE-01**: X-Ray基本統合
- **O-TRACE-02**: Echo/sqlboiler統合
- **O-TRACE-03**: トレースフィルタリング
- **O-DASH-01**: X-Rayダッシュボード
- **O-DASH-02**: サービスマップ強化

#### 1.4.2.4. 週9: 基本サーバーレス機能の実装

- **Lambda環境のセットアップ**
  - LocalStackでのLambda設定
  - Go Lambdaのテンプレート作成
  - コンテキスト管理の設計
  - ビルドとデプロイの自動化

- **画像処理Lambda実装**
  - 画像リサイズ機能の実装
  - S3トリガーの設定
  - エラーハンドリング
  - パフォーマンス最適化

- **バッチ処理Lambda実装**
  - 在庫レポート生成機能
  - CloudWatch Eventsトリガー設定
  - データエクスポート機能
  - 非同期処理の設計

- **イベント処理の設計**
  - イベント駆動型アーキテクチャの基礎設計
  - SNSトピックの設定
  - SQSキューの設定
  - イベントソーシングの基礎

**学習ユースケース:**

- **A-PROD-05**: 商品画像処理（サーバーレス）
- **A-BATCH-01**: 在庫レポート生成（サーバーレス）

#### 1.4.2.5. 週10: サーバーレスオブザーバビリティ

- **Lambda実行ログの構造化**
  - Lambda用ログハンドラーの実装
  - コンテキスト情報のログへの付与
  - リクエスト/レスポンスのログ記録
  - エラーログの強化

- **Lambda固有メトリクスの収集**
  - 実行時間、メモリ使用量の計測
  - コールドスタート検出と計測
  - エラー率の計測
  - カスタムメトリクスの実装

- **Lambda Insightsの設定**
  - Lambda Insightsの有効化
  - パフォーマンスプロファイリングの設定
  - メモリプロファイリング
  - 異常検出の基本設定

- **サーバーレストレースの実装**
  - X-RayでのLambdaトレース設定
  - イベント処理フローのトレース
  - 非同期処理のトレース連鎖
  - サービス間トレースの連携

**学習ユースケース:**

- **O-LAMBDA-01**: Lambda実行ログ構造化
- **O-LAMBDA-02**: Lambda固有メトリクス
- **O-CORR-01**: 観測データの相関付け（基本）

### 1.4.3. フェーズ3: OpenTelemetryと高度なモニタリング

#### 1.4.3.1. 週11: OpenTelemetry基盤の構築

- **ADOT Collectorのセットアップ**
  - LocalStackでのADOT Collector設定
  - コレクターの基本構成
  - パイプラインの設定
  - エクスポーターの設定

- **OpenTelemetry Go SDKの導入**
  - OTELライブラリの導入
  - 基本設定の作成
  - 環境変数による制御
  - サンプリング設定

- **X-Ray Exporterの設定**
  - X-Ray形式への変換設定
  - トレースマッピングの設定
  - アノテーションとメタデータのマッピング
  - サービス名とリソース属性の設定

- **クロスプラットフォームコンテキスト伝播**
  - W3C Trace Contextの実装
  - バックエンド間のコンテキスト伝播
  - フロントエンド→バックエンド伝播
  - カスタムコンテキスト属性の設計

**学習ユースケース:**

- **O-COMP-01**: オブザーバビリティアプローチ比較（基礎）
- AWS SDK v2とOpenTelemetryの基本比較

#### 1.4.3.2. 週12: バックエンドのOpenTelemetry移行

- **トレース実装の移行**
  - X-Ray SDK実装からOTELへの移行
  - Echoミドルウェアの変更
  - データベース操作のトレース更新
  - エラー処理の更新

- **メトリクス実装の移行**
  - CloudWatch SDKからOTELへの移行
  - メトリクスプロバイダーの変更
  - ディメンションとラベルのマッピング
  - ビジネスメトリクスの移行

- **ログ実装の連携**
  - slogとOTELログの統合
  - コンテキスト情報の引き継ぎ
  - ログ相関IDの管理
  - 構造化フォーマットの統一

- **サーバーレス関数のOTEL対応**
  - Lambda関数のOTEL統合
  - コンテキスト伝播の実装
  - カスタムメトリクスの移行
  - トレース連携の設定

**学習ユースケース:**

- **O-COMP-01**: オブザーバビリティアプローチ比較（詳細）
- AWS SDK v2からOpenTelemetryへの移行経験

#### 1.4.3.3. 週13: RUMと合成モニタリングの実装

- **CloudWatch RUMの設定**
  - RUMクライアントの設定
  - Next.jsへの統合
  - パフォーマンスデータの収集
  - エラー収集の設定

- **実ユーザー体験のモニタリング**
  - ページロード計測
  - ユーザーインタラクション追跡
  - Web Vitalsの計測
  - カスタムイベントの実装

- **CloudWatch Syntheticsの設定**
  - 合成モニタリングの設計
  - 重要ユーザーフローのスクリプト作成
  - スケジュール実行の設定
  - アラート設定

- **UI/UXパフォーマンスの最適化**
  - レンダリング最適化
  - 画像最適化
  - リソース読み込みの最適化
  - アニメーション最適化

**学習ユースケース:**

- **O-RUM-01**: CloudWatch RUM設定
- **O-SYNTH-01**: CloudWatch Synthetics設定
- **O-METRIC-08**: フロントエンドユーザー体験
- **O-METRIC-09**: フロントエンドパフォーマンス

#### 1.4.3.4. 週14: アラートと異常検出

- **CloudWatch Alertの基本設定**
  - アラートしきい値の設定
  - アラートアクションの設定
  - 複合アラートの作成
  - アラートグループ化の設定

- **SNS通知の設定**
  - SNSトピックの作成
  - サブスクリプションの設定
  - 通知テンプレートの作成
  - エスカレーションの設定

- **異常検出の実装**
  - CloudWatch Anomaly Detectionの設定
  - 動的ベースラインの設定
  - 学習期間の設定
  - 特殊イベントのフラグ設定

- **アラートのテストと検証**
  - アラート動作の検証
  - 異常検出精度の検証
  - エスカレーションフローのテスト
  - 誤検出の最小化

**学習ユースケース:**

- **O-ALERT-01**: ヘルスチェックエンドポイント拡張
- **O-ALERT-02**: 基本アラート設定
- **O-ALERT-03**: アラートとSNS通知
- **O-ALERT-04**: 障害検出とアラート検証

### 1.4.4. フェーズ4: 注文機能とオブザーバビリティ拡張

#### 1.4.4.1. 週15: カート機能の実装

- **カートデータモデルの設計と実装**
  - カートとカートアイテムテーブルの設計
  - マイグレーションスクリプトの作成
  - sqlboilerモデルの生成
  - カートセッション管理の設計

- **カートAPIの実装**
  - OpenAPI仕様にカート管理APIを追加
  - カート作成/更新/削除APIの実装
  - カートアイテム操作APIの実装
  - カート計算ロジックの実装

- **カート画面の実装**
  - カートページの実装
  - カートアイテムコンポーネントの作成
  - 数量変更UI実装
  - カート小計計算

- **カート機能のオブザーバビリティ実装**
  - カート操作のOTELトレース設定
  - カート関連メトリクスの設計と実装
  - カートイベントの記録
  - カート操作の監査ログ

**学習ユースケース:**

- **CUS-05**: カートへの商品追加
- **CUS-06**: カート管理
- カート機能のオブザーバビリティ

#### 1.4.4.2. 週16: 注文処理の実装

- **注文データモデルの設計と実装**
  - 注文と注文アイテムテーブルの設計
  - マイグレーションスクリプトの作成
  - sqlboilerモデルの生成
  - 注文状態管理の設計

- **注文処理APIの実装**
  - OpenAPI仕様に注文処理APIを追加
  - 注文作成APIの実装
  - 注文確認APIの実装
  - 注文履歴APIの実装

- **注文画面の実装**
  - 注文フォームの実装
  - 配送先入力の実装
  - 注文確認画面の実装
  - 注文完了画面の実装

- **注文処理のオブザーバビリティ実装**
  - 注文フローのOTELトレース設定
  - 注文関連メトリクスの設計と実装
  - 注文プロセスの監査ログ
  - トランザクションの監視

**学習ユースケース:**

- **CUS-07**: 注文手続き
- **CUS-08**: 注文完了
- 注文処理のオブザーバビリティ

#### 1.4.4.3. 週17: 注文関連イベント処理の実装

- **イベント駆動型アーキテクチャの拡張**
  - 注文イベントの定義
  - EventBridgeの設定
  - SNSトピックの設定
  - SQSキューの設定

- **非同期処理の実装**
  - 注文確認メール送信機能
  - 在庫更新処理
  - 注文履歴更新処理
  - レポート生成処理

- **イベント処理のオブザーバビリティ**
  - イベント処理のOTELトレース設定
  - イベント処理メトリクスの設計と実装
  - イベント処理ログの強化
  - 非同期処理の監視

- **エラー処理とリトライメカニズム**
  - デッドレターキューの設定
  - リトライ戦略の実装
  - エラーハンドリングの強化
  - 障害通知の設定

**学習ユースケース:**

- イベント駆動アーキテクチャの実装
- 非同期処理のオブザーバビリティ
- エラー処理と回復メカニズム

#### 1.4.4.4. 週18: 注文機能のオブザーバビリティ強化

- **エンドツーエンドトレースの強化**
  - カート→注文→イベント処理のトレース連携
  - クロスサービストレースの最適化
  - UI操作からバックエンドまでのトレース
  - 時系列イベント分析

- **ビジネスダッシュボードの強化**
  - 注文処理のダッシュボード
  - コンバージョン分析ダッシュボード
  - パフォーマンス最適化ダッシュボード
  - 異常検出の強化

- **注文分析のための高度なログ検索**
  - CloudWatch Logs Insightsクエリの作成
  - 注文処理分析クエリ
  - 障害分析クエリ
  - パフォーマンス分析クエリ

- **注文処理のメトリクス強化**
  - 注文完了率の計測
  - 注文処理時間の計測
  - ステップ別処理時間の計測
  - 障害率と回復時間の計測

**学習ユースケース:**

- **O-LOG-05**: CloudWatch Logs Insightsクエリ
- **O-CORR-01**: 観測データの相関付け（拡張）
- 注文プロセスのオブザーバビリティ最適化

### 1.4.5. フェーズ5: 管理機能と包括的モニタリング

#### 1.4.5.1. 週19: 商品管理機能の拡張

- **商品管理APIの拡張**
  - 商品一括操作APIの追加
  - 商品検索APIの強化
  - 商品データエクスポート/インポートAPI
  - バージョン管理APIの追加

- **商品管理画面の強化**
  - 高度な商品検索UI
  - 一括編集機能
  - ドラッグ&ドロップでの並べ替え
  - 商品属性の管理

- **商品管理のオブザーバビリティ**
  - 管理操作のOTELトレース設定
  - 管理アクションのメトリクス実装
  - 管理操作の監査ログ
  - 変更履歴の追跡

- **商品データ品質モニタリング**
  - データ整合性チェック
  - 画像品質チェック
  - SEO最適化チェック
  - データ完全性スコアリング

**学習ユースケース:**

- **O-METRIC-10**: 管理アクションのメトリクス
- **A-PROD-01**: 商品情報管理（拡張）
- **A-PROD-02**: 商品登録機能（拡張）
- **A-PROD-03**: 商品一括管理

#### 1.4.5.2. 週20: 在庫管理システムの構築

- **在庫管理APIの実装**
  - 在庫更新APIの実装
  - 在庫履歴APIの実装
  - 在庫予測APIの実装
  - 在庫アラートAPIの実装

- **在庫管理画面の実装**
  - 在庫一覧表示
  - 在庫レベル可視化
  - 入荷登録フォーム
  - 在庫調整機能

- **在庫管理のオブザーバビリティ**
  - 在庫操作のOTELトレース設定
  - 在庫レベルのメトリクス実装
  - 在庫変動の監査ログ
  - 在庫予測と実績の比較

- **在庫アラートの強化**
  - 在庫不足アラートの設定
  - 在庫過剰アラートの設定
  - 在庫変動異常検出
  - アラート通知の最適化

**学習ユースケース:**

- **A-INV-01**: 在庫レベル監視
- **A-INV-02**: 在庫不足アラート
- **A-INV-03**: 在庫更新
- 在庫管理のオブザーバビリティ

#### 1.4.5.3. 週21: 管理機能の包括的オブザーバビリティ

- **管理ダッシュボードの統合**
  - ビジネスインテリジェンスダッシュボード
  - 運用ダッシュボード
  - 品質ダッシュボード
  - 予測ダッシュボード

- **管理操作の詳細分析**
  - ユーザー別アクション分析
  - 時間帯別操作パターン分析
  - 効率性分析
  - 影響範囲分析

- **包括的モニタリングの実装**
  - データフローの可視化
  - システム依存関係マップ
  - リソース使用量の予測
  - 異常検出の精度向上

- **オブザーバビリティデータの統合**
  - ログ、メトリクス、トレースの完全統合
  - コンテキスト間の相関分析
  - 根本原因分析の自動化
  - インシデント予測と防止

**学習ユースケース:**

- **O-METRIC-11**: リソース使用状況モニタリング
- **O-CORR-01**: 観測データの相関付け（完全版）
- **O-COST-01**: コスト最適化
- 包括的オブザーバビリティの実現

### 1.4.6. フェーズ6: 本番環境と耐障害性

#### 1.4.6.1. 週22: AWS環境への本番デプロイ準備

- **Terraformによる本番環境インフラ定義**
  - VPC、サブネット、セキュリティグループの設定
  - ECS/Fargate、RDS、Lambdaリソースの定義
  - IAMロールとポリシーの設定
  - CloudWatch、X-Ray、SNSリソースの設定

- **CI/CDパイプラインの構築**
  - GitHub Actionsワークフローの設定
  - ビルドプロセスの自動化
  - テスト自動化の設定
  - デプロイプロセスの自動化

- **本番環境のオブザーバビリティ設定**
  - 本番環境のログ設定の最適化
  - メトリクスフィルターとアラートの調整
  - トレースサンプリングの最適化
  - コスト効率の最適化

- **パフォーマンステストとベンチマーク**
  - 負荷テストの実施
  - パフォーマンスボトルネックの特定
  - スケーリング設定の最適化
  - リソース割り当ての最適化

**学習ユースケース:**

- **O-TRACE-06**: 本番環境X-Ray設定
- **O-LOG-06**: 本番環境ログ設定
- **O-INFRA-01**: オブザーバビリティインフラ構築

#### 1.4.6.2. 週23: 耐障害性とカオスエンジニアリング

- **AWS Fault Injection Serviceの設定**
  - 実験テンプレートの作成
  - 安全メカニズムの設定
  - モニタリング設定
  - ロールバック手順の設定

- **障害シナリオの設計と実行**
  - ネットワーク障害シナリオ
  - コンピューティングリソース障害シナリオ
  - データベース障害シナリオ
  - 依存サービス障害シナリオ

- **カオスエンジニアリング実験**
  - 制御された障害注入
  - システム応答の分析
  - 復旧メカニズムの検証
  - 改善点の特定

- **耐障害性の評価と強化**
  - 障害復旧時間の計測
  - 障害範囲の分析
  - 耐障害性スコアの設定
  - 設計改善の提案

**学習ユースケース:**

- **O-FAULT-01**: Fault Injection Service設定
- **O-FAULT-02**: 高度な障害シナリオ
- **O-CHAOS-01**: カオスエンジニアリング実験

## 1.5. AWS SDK v2とOpenTelemetryの比較学習

### 1.5.1. 段階的移行アプローチ

このプロジェクトでは、まずAWS SDK v2でオブザーバビリティを実装し、その後OpenTelemetryに移行することで、両者の比較学習が可能になります。この段階的アプローチにより、AWS固有のサービスから標準的なOpenTelemetryへの移行経験を得ることができます。

具体的な移行ステップ：

1. **フェーズ2**でAWS SDK v2による基本実装
   - CloudWatchとX-Rayの直接統合
   - AWSネイティブなオブザーバビリティを学習

2. **フェーズ3**でOpenTelemetryへの移行
   - ADOT Collectorの導入
   - SDK実装の変更
   - データ変換とエクスポート設定

3. **フェーズ3-6**でOpenTelemetryの活用
   - より高度な機能の実装
   - マルチクラウド対応の考慮
   - オープンソースツールとの連携

### 1.5.2. 比較ポイント

AWS SDK v2とOpenTelemetryを比較する際の主要なポイント：

| 比較項目           | AWS SDK v2アプローチ            | OpenTelemetryアプローチ                    |
| ------------------ | ------------------------------- | ------------------------------------------ |
| **セットアップ**   | AWSサービスとの直接統合で簡単   | 追加コンポーネント(Collector)が必要        |
| **柔軟性**         | AWS環境に最適化されるが制限あり | クラウド間、オープンソースツールと連携可能 |
| **標準化**         | AWS固有の実装                   | OpenTelemetry標準に準拠                    |
| **運用コスト**     | 低め（AWSサービスのみ）         | やや高め（追加コンポーネント運用）         |
| **機能の豊富さ**   | AWSサービスに最適化             | 汎用的で拡張性が高い                       |
| **学習曲線**       | AWSユーザーには馴染みやすい     | より広範な知識が必要                       |
| **ベンダーロック** | 高い（AWS依存）                 | 低い（標準規格）                           |
| **コミュニティ**   | AWSサポート中心                 | 大規模なオープンソースコミュニティ         |

### 1.5.3. 移行戦略

AWS SDK v2からOpenTelemetryへの効率的な移行戦略：

1. **並行実行期間の設定**
   - 一定期間、両方のシステムを並行稼働させる
   - データの整合性を確認
   - 機能の等価性を検証

2. **コンポーネント別の段階的移行**
   - トレース→メトリクス→ログの順で移行
   - 各段階で十分なテストと検証

3. **共通インターフェースの設計**
   - 抽象化レイヤーを設けて実装の切り替えを容易に
   - 設定ベースで動作を制御

4. **移行の自動検証**
   - 両システムのデータ比較の自動化
   - 差異の検出と分析
   - パフォーマンス影響の計測

## 1.6. オブザーバビリティの3本柱の統合学習

### 1.6.1. 統合アプローチの利点

オブザーバビリティの3本柱（ログ、メトリクス、トレース）を統合的に学習することで、以下の利点があります：

1. **包括的な視点の獲得**
   - システム全体の状態を多角的に理解できる
   - 問題の根本原因をより迅速に特定できる
   - データ間の相関関係を活用できる

2. **コンテキスト情報の共有**
   - リクエストIDなどの共通識別子で情報を関連付け
   - ユーザー体験からインフラ問題までを追跡可能
   - イベントの時間的順序を正確に把握

3. **効率的なデバッグと問題解決**
   - 複数のデータソースから証拠を収集
   - パターン認識によるトラブルシューティング
   - 再発防止のための根本原因分析

### 1.6.2. 実践的な統合ポイント

このプロジェクトでの3本柱統合のための実践ポイント：

1. **共通識別子の一貫した利用**
   - トレースID、スパンID、リクエストIDの伝播
   - ユーザーセッションIDの維持
   - サービス名とインスタンス識別子の標準化

2. **時間同期の確保**
   - 正確なタイムスタンプの記録
   - タイムゾーンの標準化
   - 時系列データの整合性維持

3. **データモデルの一貫性**
   - 一貫した命名規則
   - 共通のタグとラベル
   - 属性の標準化

4. **可視化ツールの統合**
   - 複数データソースを1つのダッシュボードに表示
   - クロスリンクによるコンテキスト切替
   - 相関ビューの作成

### 1.6.3. 相関分析の実装

異なるデータソース間の相関分析の実装方法：

1. **トレースからログへの橋渡し**
   - トレースIDをログに埋め込む
   - ログエントリにスパンIDを含める
   - トレースビューアからログへのディープリンク

2. **メトリクスからトレースへの関連付け**
   - 異常なメトリクスからのトレース検索
   - メトリクスからのトレースサンプリング
   - トレースに基づくメトリクス生成

3. **ログからメトリクスへの変換**
   - ログパターンに基づくメトリクス生成
   - エラーログからのアラート設定
   - ログベースのKPI監視

4. **統合クエリと分析**
   - CloudWatch Logs Insightsの高度なクエリ
   - X-Rayトレース分析
   - OpenTelemetryの相関分析

## 1.7. サーバーレスのオブザーバビリティ

### 1.7.1. サーバーレス固有の課題

サーバーレス環境でのオブザーバビリティには従来と異なる課題があります：

1. **コールドスタートの影響**
   - 初回起動時のレイテンシー増加
   - オブザーバビリティ設定のオーバーヘッド
   - コールドスタート頻度の計測と最適化

2. **短命なプロセス**
   - 実行時間が短いため情報収集の機会が限られる
   - 処理の完全な記録が重要
   - コンテキスト情報の効率的な収集

3. **分散処理の複雑さ**
   - 非同期イベントチェーンの追跡
   - マイクロサービス間の依存関係把握
   - エラー伝播の追跡

4. **リソース制約**
   - メモリとCPU制限内での動作
   - オブザーバビリティのオーバーヘッド最小化
   - コスト効率の最適化

### 1.7.2. モニタリング戦略

サーバーレスのための効果的なモニタリング戦略：

1. **モニタリングスコープの定義**
   - ビジネスクリティカルな関数の特定
   - SLIとSLOの設定
   - 重要なトランザクションパスの定義

2. **マルチレイヤーの観測**
   - 関数レベルのメトリクス
   - イベントチェーンのトレース
   - リソース使用状況の監視
   - ユーザー体験の計測

3. **バッチ処理の最適化**
   - テレメトリーデータのバッチ送信
   - 信頼性の高い配信保証
   - リソース使用の平準化

4. **エラーと例外の包括的追跡**
   - すべての例外のログ記録
   - エラータイプの分類
   - 障害パターンの検出
   - 自動リカバリーの監視

### 1.7.3. 実装手法

サーバーレスのオブザーバビリティ実装のベストプラクティス：

1. **Lambda固有の最適化**
   - 初期化コードと実行コードの分離
   - グローバル変数の効果的な利用
   - コンテキスト情報の効率的な抽出

2. **イベント駆動モニタリング**
   - EventBridgeによるイベントモニタリング
   - 非同期ワークフローの可視化
   - イベント相関IDの伝播

3. **効率的なトレース実装**
   - X-Ray Active Tracingの有効化
   - カスタムサブセグメントの限定的使用
   - サンプリングルールの最適化

4. **統合コンソールの活用**
   - AWS Lambda Consoleでの監視
   - CloudWatch Logs Insightsの活用
   - X-Rayトレースマップの活用
   - Lambda Insightsの有効活用

## 1.8. 学習環境でのコスト管理

### 1.8.1. フェーズ別コスト概算

学習環境での各フェーズのおおよそのコスト概算です。すべてのサービスを同時に使用するのではなく、限られた時間だけ稼働させることでコストを抑制できます。

| フェーズ                              | 主要コスト要素                 | 対策を講じない場合の月額コスト | 学習最適化後の月額コスト |
| ------------------------------------- | ------------------------------ | ------------------------------ | ------------------------ |
| **フェーズ1: 基盤構築と商品閲覧機能** | RDS, Fargate                   | $50-70                         | $10-15                   |
| **フェーズ2: 統合オブザーバビリティ** | CloudWatch, X-Ray, Lambda      | $80-100                        | $15-20                   |
| **フェーズ3: OpenTelemetry**          | ADOT Collector, CloudWatch RUM | $100-120                       | $20-25                   |
| **フェーズ4: 注文機能**               | RDS, Fargate, SNS/SQS          | $90-110                        | $18-23                   |
| **フェーズ5: 管理機能**               | RDS, Fargate, CloudWatch       | $70-90                         | $15-18                   |
| **フェーズ6: 本番環境**               | すべてのサービス + FIS         | $120-150                       | $25-30                   |

### 1.8.2. コスト最適化戦略

学習環境でのコストを効率的に管理するための戦略：

1. **時間制限による稼働**
   - 学習セッション時のみリソースを起動
   - 夜間・週末の自動停止
   - スケジュールベースの起動/停止

2. **リソースのサイズ最適化**
   - 最小サイズのインスタンス選択
   - メモリ割り当ての最適化
   - ストレージサイズの最小化

3. **サンプリングとフィルタリング**
   - トレースのサンプリング率調整
   - ログフィルタリングの実装
   - メトリクス収集の選択的実行

4. **LocalStackの活用**
   - 可能な限りLocalStackでのエミュレーション
   - 実AWSサービスは検証時のみ使用
   - ハイブリッドアプローチの採用

### 1.8.3. 週あたりの学習時間を考慮した配分

週あたり20時間の学習を想定した場合のコスト最適化例：

| 使用パターン                      | 週あたりの稼働時間 | 月間コストへの影響                   |
| --------------------------------- | ------------------ | ------------------------------------ |
| **平日限定（4時間×5日）**         | 20時間/週          | 約12%の稼働（月間730時間中の86時間） |
| **週末集中（10時間×2日）**        | 20時間/週          | 約11%の稼働（月間730時間中の80時間） |
| **分散学習（3時間×週6日+2時間）** | 20時間/週          | 約11%の稼働（月間730時間中の80時間） |

これにより、フルタイム稼働に比べて約85-90%のコスト削減が可能です。

## 1.9. 各段階での学習成果

### 1.9.1. フェーズ1の成果物

- **技術的成果**:
  - 完全な開発環境
  - 基本的なCRUD操作を備えたバックエンド
  - 商品表示機能を持つフロントエンド
  - 基本的な管理画面

- **学習成果**:
  - Go/Echoフレームワークの基礎
  - Next.jsアプリケーション開発
  - Docker/LocalStack環境構築
  - REST API設計と実装

### 1.9.2. フェーズ2の成果物

- **技術的成果**:
  - 統合オブザーバビリティシステム
  - 構造化ログシステム
  - メトリクス収集パイプライン
  - 分散トレースシステム
  - 基本的なサーバーレス機能

- **学習成果**:
  - AWS CloudWatchの詳細理解
  - AWS X-Rayによるトレース実装
  - Lambda関数の実装とモニタリング
  - オブザーバビリティの3本柱の統合的理解

### 1.9.3. フェーズ3の成果物

- **技術的成果**:
  - OpenTelemetry統合システム
  - 高度なモニタリングシステム
  - RUMと合成モニタリング設定
  - アラートと異常検出システム

- **学習成果**:
  - OpenTelemetryの深い理解
  - AWS SDK v2からOTELへの移行経験
  - 高度なモニタリング手法の習得
  - アラート設計のベストプラクティス

### 1.9.4. フェーズ4の成果物

- **技術的成果**:
  - 完全なカートシステム
  - 注文処理システム
  - イベント駆動型アーキテクチャ
  - エンドツーエンドのオブザーバビリティ

- **学習成果**:
  - 複雑なトランザクション処理の実装
  - イベント駆動設計の実践
  - 非同期処理のモニタリング
  - 分散システムの観測技術

### 1.9.5. フェーズ5の成果物

- **技術的成果**:
  - 高度な商品管理システム
  - 在庫管理システム
  - 包括的モニタリングダッシュボード
  - 統合オブザーバビリティデータ

- **学習成果**:
  - 複雑なビジネスロジックの実装
  - 高度なダッシュボード設計
  - データの相関分析手法
  - 管理機能のオブザーバビリティ

### 1.9.6. フェーズ6の成果物

- **技術的成果**:
  - AWS本番環境デプロイ設定
  - CI/CDパイプライン
  - 障害テスト環境
  - 最適化されたシステム

- **学習成果**:
  - Terraformによるインフラのコード化
  - CI/CDパイプラインの設計と実装
  - カオスエンジニアリングの実践
  - 本番環境でのオブザーバビリティ
