# 週2: データモデルとメトリクス

## 目標とするユースケース

| ユースケースID | ユースケース名     | 優先度 | 終了時達成目標 | 完了基準                                             |
| -------------- | ------------------ | ------ | -------------- | ---------------------------------------------------- |
| CUS-01         | 基本的な商品閲覧   | 高     | 70%            | 商品一覧ページで実際の商品データが表示される         |
| CUS-03         | カテゴリー別閲覧   | 中     | 40%            | カテゴリー選択による商品フィルタリングが基本動作する |
| OBS-04         | 基本メトリクス収集 | 高     | 80%            | CloudWatch Metricsで基本メトリクスが確認できる       |

## 実装する機能

| 機能ID      | 機能名                 | 説明                                            | 関連ユースケース | 終了時達成目標 |
| ----------- | ---------------------- | ----------------------------------------------- | ---------------- | -------------- |
| C-BROWSE-01 | 商品一覧表示           | ユーザーが閲覧可能な商品リストを表示            | CUS-01           | 70%            |
| C-BROWSE-03 | カテゴリー別表示       | カテゴリーに基づいた商品の分類と表示            | CUS-03           | 40%            |
| O-METRIC-01 | 基本メトリクス収集     | リクエスト数、レイテンシー、エラー率の測定      | OBS-04           | 80%            |
| O-METRIC-02 | インフラメトリクス収集 | CPU/メモリ使用率、ディスクI/O、ネットワーク計測 | OBS-04           | 80%            |

## 実装するAPI

| API ID         | API名                   | エンドポイント                  | メソッド | 関連機能                 | 終了時達成目標 |
| -------------- | ----------------------- | ------------------------------- | -------- | ------------------------ | -------------- |
| API-PRODUCT-01 | 商品一覧API             | `/api/products`                 | GET      | C-BROWSE-01              | 100%           |
| API-PRODUCT-03 | 商品カテゴリー一覧API   | `/api/products/categories`      | GET      | C-BROWSE-03              | 100%           |
| API-PRODUCT-04 | カテゴリー別商品一覧API | `/api/products/categories/{id}` | GET      | C-BROWSE-03              | 80%            |
| API-METRICS-01 | メトリクスAPI           | `/api/metrics`                  | GET      | O-METRIC-01, O-METRIC-02 | 90%            |

## 実装する画面

| 画面ID | 画面名       | 説明                                     | 関連機能                 | 終了時達成目標 |
| ------ | ------------ | ---------------------------------------- | ------------------------ | -------------- |
| C-01   | ホーム画面   | アプリケーションのホーム画面             | -                        | 80%            |
| C-02   | 商品一覧画面 | 全商品またはカテゴリー別の商品一覧を表示 | C-BROWSE-01, C-BROWSE-03 | 70%            |

## 詳細タスク

| タスクID | タスク名                                      | タスク種別         | 見積時間 | 依存タスク                   | 関連API                        | 関連画面 | 関連機能                 | 関連ユースケース |
| -------- | --------------------------------------------- | ------------------ | -------- | ---------------------------- | ------------------------------ | -------- | ------------------------ | ---------------- |
| TASK-016 | データベーススキーマ設計                      | 設計               | 4h       | -                            | -                              | -        | -                        | -                |
| TASK-017 | MySQL DB環境セットアップ                      | 環境構築           | 2h       | TASK-016                     | -                              | -        | -                        | -                |
| TASK-018 | golang-migrate セットアップとマイグレーション | 環境構築           | 2h       | TASK-017                     | -                              | -        | -                        | -                |
| TASK-019 | sqlboiler ORM セットアップ                    | 環境構築           | 2h       | TASK-018                     | -                              | -        | -                        | -                |
| TASK-020 | OpenAPI仕様の初期定義                         | 設計               | 3h       | -                            | -                              | -        | -                        | -                |
| TASK-021 | ogen APIコード生成                            | 実装               | 2h       | TASK-020                     | -                              | -        | -                        | -                |
| TASK-022 | 商品モデル実装                                | 実装               | 3h       | TASK-019                     | -                              | -        | C-BROWSE-01              | CUS-01           |
| TASK-023 | カテゴリーモデル実装                          | 実装               | 2h       | TASK-019                     | -                              | -        | C-BROWSE-03              | CUS-03           |
| TASK-024 | 商品一覧API実装（実データ）                   | 実装               | 3h       | TASK-022                     | API-PRODUCT-01                 | -        | C-BROWSE-01              | CUS-01           |
| TASK-025 | 商品カテゴリー一覧API実装                     | 実装               | 2h       | TASK-023                     | API-PRODUCT-03                 | -        | C-BROWSE-03              | CUS-03           |
| TASK-026 | カテゴリー別商品一覧API実装                   | 実装               | 3h       | TASK-024, TASK-025           | API-PRODUCT-04                 | -        | C-BROWSE-03              | CUS-03           |
| TASK-027 | 商品一覧画面の基本実装                        | 実装               | 4h       | TASK-024                     | API-PRODUCT-01                 | C-02     | C-BROWSE-01              | CUS-01           |
| TASK-028 | カテゴリーフィルター実装                      | 実装               | 3h       | TASK-025, TASK-026, TASK-027 | API-PRODUCT-04                 | C-02     | C-BROWSE-03              | CUS-03           |
| TASK-029 | メトリクス収集の基本実装                      | オブザーバビリティ | 3h       | -                            | -                              | -        | O-METRIC-01              | OBS-04           |
| TASK-030 | インフラメトリクス収集設定                    | オブザーバビリティ | 2h       | TASK-029                     | -                              | -        | O-METRIC-02              | OBS-04           |
| TASK-031 | メトリクスAPIエンドポイント実装               | オブザーバビリティ | 2h       | TASK-029                     | API-METRICS-01                 | -        | O-METRIC-01, O-METRIC-02 | OBS-04           |
| TASK-032 | LocalStack CloudWatch Metrics設定             | インフラ           | 3h       | TASK-029                     | -                              | -        | O-METRIC-01, O-METRIC-02 | OBS-04           |
| TASK-033 | テストデータ投入スクリプト                    | 実装               | 2h       | TASK-018                     | -                              | -        | -                        | -                |
| TASK-034 | 単体テスト（商品API）                         | テスト             | 2h       | TASK-024                     | API-PRODUCT-01                 | -        | C-BROWSE-01              | CUS-01           |
| TASK-035 | 単体テスト（カテゴリーAPI）                   | テスト             | 2h       | TASK-025, TASK-026           | API-PRODUCT-03, API-PRODUCT-04 | -        | C-BROWSE-03              | CUS-03           |
| TASK-036 | メトリクス収集結果の検証                      | テスト             | 2h       | TASK-031, TASK-032           | API-METRICS-01                 | -        | O-METRIC-01, O-METRIC-02 | OBS-04           |

## 週2の進捗追跡ダッシュボード

```
AWS オブザーバビリティ学習プロジェクト - 週2進捗ダッシュボード
----------------------------------------------------------
全体進捗: 30% [███████···················]

【タスク完了率】
週1のタスク: 100% [████████████████████████] (15/15 完了)
週2のタスク: 100% [████████████████████████] (21/21 完了)

【API完成率】
API-PRODUCT-01 (商品一覧API): 100% [████████████████████████]
API-PRODUCT-03 (商品カテゴリー一覧API): 100% [████████████████████████]
API-PRODUCT-04 (カテゴリー別商品一覧API): 80% [████████████████████····]
API-METRICS-01 (メトリクスAPI): 90% [██████████████████████··]

【画面完成率】
C-01 (ホーム画面): 80% [████████████████████····]
C-02 (商品一覧画面): 70% [█████████████████·······]

【機能完成率】
C-BROWSE-01 (商品一覧表示): 70% [█████████████████·······]
C-BROWSE-03 (カテゴリー別表示): 40% [██████████··············]
O-METRIC-01 (基本メトリクス収集): 80% [████████████████████····]
O-METRIC-02 (インフラメトリクス収集): 80% [████████████████████····]

【ユースケース実現率】
CUS-01 (基本的な商品閲覧): 70% [█████████████████·······]
CUS-03 (カテゴリー別閲覧): 40% [██████████··············]
OBS-04 (基本メトリクス収集): 80% [████████████████████····]

【前週からの改善ユースケース】
CUS-01 (基本的な商品閲覧): 10% → 70% [+60%]
OBS-01 (構造化ログ収集): 85% → 90% [+5%]

【カテゴリー別進捗】
顧客向け機能: 55% [█████████████·········]
管理者向け機能: 0% [························]
オブザーバビリティ機能: 80% [████████████████████····]

【次のステップ】
1. 在庫管理サービスの実装（週3）
2. 商品詳細画面の実装（週3）
3. X-Ray SDKの基本統合（週3）
```

## Notionでの管理ポイント

1. **週をまたぐ依存関係**:
   - 週1から週2への依存関係を明示的に管理
   - 各タスクの状態変化を自動通知

2. **進捗の自動計算**:
   - 週2に追加されたAPIと画面の完成率を反映
   - ユースケース実現率の更新（CUS-01が大幅に向上）
   - 前週比での改善を可視化

3. **リソース管理**:
   - データベース関連タスクのグループ化
   - API・画面・機能間の依存関係のビジュアル化
   - 進行中の作業の優先順位付け

4. **テスト管理**:
   - 単体テストの実行結果の記録
   - メトリクス検証のエビデンス保存

## 週2の終了時点での成果物

1. **データ層の基盤**:
   - 完全に機能するデータベーススキーマ
   - マイグレーション管理の仕組み
   - sqlboilerによる型安全なORM

2. **実データを使用したAPI**:
   - 商品一覧API（実データ）
   - 商品カテゴリー一覧API
   - カテゴリー別商品一覧API

3. **基本的なフロントエンド画面**:
   - 商品一覧画面
   - カテゴリーフィルター機能

4. **メトリクス基盤**:
   - 基本メトリクス収集の仕組み
   - インフラメトリクス収集の設定
   - LocalStackでのCloudWatch Metrics連携
