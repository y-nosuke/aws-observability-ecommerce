# 週3: 基本機能拡張とトレース導入

## 目標とするユースケース

| ユースケースID | ユースケース名         | 優先度 | 終了時達成目標 | 完了基準                                         |
| -------------- | ---------------------- | ------ | -------------- | ------------------------------------------------ |
| CUS-02         | 商品詳細確認           | 高     | 85%            | 商品詳細ページで画像、説明、価格などが表示される |
| CUS-04         | 在庫確認               | 中     | 75%            | 商品詳細ページで在庫状況が表示される             |
| OBS-03         | リクエストコンテキスト | 中     | 80%            | ログにリクエストID、ユーザーIDなどが含まれる     |
| OBS-05         | 分散トレース           | 高     | 75%            | X-Rayでリクエストの処理フローが可視化される      |

## 実装する機能

| 機能ID      | 機能名               | 説明                                           | 関連ユースケース | 終了時達成目標 |
| ----------- | -------------------- | ---------------------------------------------- | ---------------- | -------------- |
| C-BROWSE-02 | 商品詳細表示         | 個別商品の詳細情報と画像の表示                 | CUS-02           | 85%            |
| C-BROWSE-07 | 在庫状況表示         | 商品の在庫状況と在庫不足の表示                 | CUS-04           | 75%            |
| O-LOG-04    | コンテキスト情報付与 | リクエストID、ユーザーIDなどの情報をログに追加 | OBS-03           | 80%            |
| O-TRACE-01  | X-Ray基本統合        | AWS X-Rayによる基本的な分散トレース実装        | OBS-05           | 75%            |

## 実装するAPI

| API ID           | API名           | エンドポイント               | メソッド | 関連機能    | 終了時達成目標 |
| ---------------- | --------------- | ---------------------------- | -------- | ----------- | -------------- |
| API-PRODUCT-02   | 商品詳細API     | `/api/products/{id}`         | GET      | C-BROWSE-02 | 100%           |
| API-INVENTORY-01 | 商品在庫状況API | `/api/inventory/{productId}` | GET      | C-BROWSE-07 | 100%           |

## 実装する画面

| 画面ID | 画面名       | 説明                           | 関連機能                 | 終了時達成目標 |
| ------ | ------------ | ------------------------------ | ------------------------ | -------------- |
| C-03   | 商品詳細画面 | 選択された商品の詳細情報を表示 | C-BROWSE-02, C-BROWSE-07 | 80%            |

## 詳細タスク

| タスクID | タスク名                                  | タスク種別         | 見積時間 | 依存タスク         | 関連API          | 関連画面 | 関連機能             | 関連ユースケース |
| -------- | ----------------------------------------- | ------------------ | -------- | ------------------ | ---------------- | -------- | -------------------- | ---------------- |
| TASK-037 | 在庫管理サービス(SVC-02)の基本設計        | 設計               | 3h       | -                  | -                | -        | -                    | -                |
| TASK-038 | 在庫データモデル実装                      | 実装               | 3h       | TASK-037           | -                | -        | C-BROWSE-07          | CUS-04           |
| TASK-039 | 商品詳細API実装                           | 実装               | 3h       | TASK-022           | API-PRODUCT-02   | -        | C-BROWSE-02          | CUS-02           |
| TASK-040 | 商品在庫状況API実装                       | 実装               | 3h       | TASK-038           | API-INVENTORY-01 | -        | C-BROWSE-07          | CUS-04           |
| TASK-041 | OpenAPI仕様に在庫管理APIを追加            | 設計               | 2h       | TASK-037           | -                | -        | -                    | -                |
| TASK-042 | ogen在庫管理コード生成                    | 実装               | 1h       | TASK-041           | -                | -        | -                    | -                |
| TASK-043 | 商品詳細画面の実装                        | 実装               | 4h       | TASK-039           | API-PRODUCT-02   | C-03     | C-BROWSE-02          | CUS-02           |
| TASK-044 | 在庫状況表示コンポーネント実装            | 実装               | 3h       | TASK-040           | API-INVENTORY-01 | C-03     | C-BROWSE-07          | CUS-04           |
| TASK-045 | コンテキスト情報付与の実装                | オブザーバビリティ | 3h       | -                  | -                | -        | O-LOG-04             | OBS-03           |
| TASK-046 | リクエストIDの生成と伝播                  | オブザーバビリティ | 2h       | TASK-045           | -                | -        | O-LOG-04             | OBS-03           |
| TASK-047 | X-Ray SDKのインストールと基本設定         | オブザーバビリティ | 2h       | -                  | -                | -        | O-TRACE-01           | OBS-05           |
| TASK-048 | X-Rayミドルウェア実装                     | オブザーバビリティ | 2h       | TASK-047           | -                | -        | O-TRACE-01           | OBS-05           |
| TASK-049 | HTTPクライアントのX-Ray対応               | オブザーバビリティ | 2h       | TASK-048           | -                | -        | O-TRACE-01           | OBS-05           |
| TASK-050 | クライアント-サーバーコンテキスト伝播実装 | オブザーバビリティ | 3h       | TASK-045, TASK-047 | -                | -        | O-LOG-04, O-TRACE-01 | OBS-03, OBS-05   |
| TASK-051 | LocalStack用X-Ray設定                     | インフラ           | 3h       | TASK-047           | -                | -        | O-TRACE-01           | OBS-05           |
| TASK-052 | データベース操作のトレース設定            | オブザーバビリティ | 3h       | TASK-048           | -                | -        | O-TRACE-01           | OBS-05           |
| TASK-053 | Terraformモジュール拡張（X-Ray設定）      | インフラ           | 3h       | TASK-051           | -                | -        | O-TRACE-01           | OBS-05           |
| TASK-054 | カテゴリー別の商品一覧画面の改善          | 実装               | 3h       | TASK-028           | API-PRODUCT-04   | C-02     | C-BROWSE-03          | CUS-03           |
| TASK-055 | 単体テスト（商品詳細API）                 | テスト             | 2h       | TASK-039           | API-PRODUCT-02   | -        | C-BROWSE-02          | CUS-02           |
| TASK-056 | 単体テスト（在庫状況API）                 | テスト             | 2h       | TASK-040           | API-INVENTORY-01 | -        | C-BROWSE-07          | CUS-04           |
| TASK-057 | トレース情報検証                          | テスト             | 2h       | TASK-048, TASK-051 | -                | -        | O-TRACE-01           | OBS-05           |

## 週3の進捗追跡ダッシュボード

```
AWS オブザーバビリティ学習プロジェクト - 週3進捗ダッシュボード
----------------------------------------------------------
全体進捗: 45% [███████████···············]

【タスク完了率】
週1のタスク: 100% [████████████████████████] (15/15 完了)
週2のタスク: 100% [████████████████████████] (21/21 完了)
週3のタスク: 100% [████████████████████████] (21/21 完了)

【API完成率】
API-PRODUCT-02 (商品詳細API): 100% [████████████████████████]
API-INVENTORY-01 (商品在庫状況API): 100% [████████████████████████]

【画面完成率】
C-03 (商品詳細画面): 80% [████████████████████····]

【機能完成率】
C-BROWSE-02 (商品詳細表示): 85% [█████████████████████···]
C-BROWSE-07 (在庫状況表示): 75% [███████████████████·····]
O-LOG-04 (コンテキスト情報付与): 80% [████████████████████····]
O-TRACE-01 (X-Ray基本統合): 75% [███████████████████·····]

【ユースケース実現率】
CUS-02 (商品詳細確認): 85% [█████████████████████···]
CUS-04 (在庫確認): 75% [███████████████████·····]
OBS-03 (リクエストコンテキスト): 80% [████████████████████····]
OBS-05 (分散トレース): 75% [███████████████████·····]

【前週からの改善ユースケース】
CUS-03 (カテゴリー別閲覧): 40% → 60% [+20%]

【カテゴリー別進捗】
顧客向け機能: 70% [█████████████████·······]
管理者向け機能: 0% [························]
オブザーバビリティ機能: 80% [████████████████████····]

【次のステップ】
1. Echo/sqlboiler統合とカスタムサブセグメント追加（週4）
2. レスポンスタイム分布測定の設定（週4）
3. CloudWatch Logs Insightsのクエリ作成（週4）
```

## Notionでの管理ポイント

1. **複合機能の進捗管理**:
   - 商品詳細画面は2つの機能に関連（商品詳細表示と在庫状況表示）
   - 各機能の進捗を個別に追跡しつつ、画面全体の完成度も管理

2. **オブザーバビリティの統合管理**:
   - ログとトレースの連携度合いを追跡
   - X-Rayの導入状況の視覚化（セグメントの数やカバレッジ）

3. **テストとデモの記録**:
   - X-Rayトレースのスクリーンショットを保存
   - トレース情報の解析結果をドキュメント化

4. **デバッグ情報の整理**:
   - コンテキスト伝播に関する問題のトラブルシューティング記録
   - X-Ray設定の注意点をドキュメント化

## 週3の終了時点での成果物

1. **機能拡張**:
   - 商品詳細の表示（画像、説明、仕様）
   - 在庫状況の表示（在庫あり/なし、残数）
   - カテゴリー別商品表示の改善

2. **在庫管理**:
   - 在庫データモデル
   - 在庫状況取得API
   - 基本的な在庫表示コンポーネント

3. **分散トレース基盤**:
   - X-Ray SDKによる基本的なトレース収集
   - リクエスト間のコンテキスト伝播
   - データベース操作のトレース

4. **高度なログ機能**:
   - リクエストIDの自動生成と伝播
   - ユーザーコンテキスト情報の付与
   - 構造化ログとトレースIDの連携
