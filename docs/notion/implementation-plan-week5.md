# 週5: カート機能の基礎実装

## 目標とするユースケース

| ユースケースID | ユースケース名       | 優先度 | 終了時達成目標 | 完了基準                                                |
| -------------- | -------------------- | ------ | -------------- | ------------------------------------------------------- |
| CUS-05         | カートへの商品追加   | 高     | 85%            | カートに商品を追加でき、カート内に表示される            |
| CUS-06         | カート管理           | 高     | 70%            | カート内の商品の基本的な管理（追加・削除）ができる      |
| OBS-05         | 分散トレース         | 高     | 95%            | 複雑なトランザクションフローのトレースが可能になる      |
| OBS-06         | サービスマップ可視化 | 中     | 80%            | X-Rayサービスマップでサービス間の関係が詳細に表示される |

## 実装する機能

| 機能ID     | 機能名                 | 説明                                         | 関連ユースケース | 終了時達成目標 |
| ---------- | ---------------------- | -------------------------------------------- | ---------------- | -------------- |
| C-SHOP-01  | カート機能             | 商品の追加/削除とカート内容表示              | CUS-05, CUS-06   | 80%            |
| O-TRACE-03 | トレースフィルタリング | 特定のリクエストやエラーケースを効率的に検索 | OBS-05           | 85%            |
| O-DASH-01  | X-Rayダッシュボード    | X-Rayの分析データを活用したダッシュボード    | OBS-06           | 80%            |

## 実装するAPI

| API ID      | API名                 | エンドポイント         | メソッド | 関連機能  | 終了時達成目標 |
| ----------- | --------------------- | ---------------------- | -------- | --------- | -------------- |
| API-CART-01 | カート取得API         | `/api/cart`            | GET      | C-SHOP-01 | 100%           |
| API-CART-02 | カートアイテム追加API | `/api/cart/items`      | POST     | C-SHOP-01 | 100%           |
| API-CART-03 | カートアイテム削除API | `/api/cart/items/{id}` | DELETE   | C-SHOP-01 | 100%           |
| API-CART-04 | カートアイテム更新API | `/api/cart/items/{id}` | PUT      | C-SHOP-01 | 80%            |

## 実装する画面

| 画面ID | 画面名     | 説明                                         | 関連機能  | 終了時達成目標 |
| ------ | ---------- | -------------------------------------------- | --------- | -------------- |
| C-04   | カート画面 | カートに追加された商品の一覧と基本操作を提供 | C-SHOP-01 | 80%            |

## 詳細タスク

| タスクID | タスク名                                    | タスク種別         | 見積時間 | 依存タスク                             | 関連API                                            | 関連画面 | 関連機能   | 関連ユースケース |
| -------- | ------------------------------------------- | ------------------ | -------- | -------------------------------------- | -------------------------------------------------- | -------- | ---------- | ---------------- |
| TASK-077 | カートサービス(SVC-03)の基本設計            | 設計               | 3h       | -                                      | -                                                  | -        | C-SHOP-01  | CUS-05, CUS-06   |
| TASK-078 | カートデータモデル設計                      | 設計               | 2h       | TASK-077                               | -                                                  | -        | C-SHOP-01  | CUS-05, CUS-06   |
| TASK-079 | データベースモデル拡張（carts, cart_items） | 実装               | 3h       | TASK-078                               | -                                                  | -        | C-SHOP-01  | CUS-05, CUS-06   |
| TASK-080 | マイグレーション実装（カートテーブル）      | 実装               | 2h       | TASK-079                               | -                                                  | -        | C-SHOP-01  | CUS-05, CUS-06   |
| TASK-081 | カートモデルのsqlboiler生成                 | 実装               | 1h       | TASK-080                               | -                                                  | -        | C-SHOP-01  | CUS-05, CUS-06   |
| TASK-082 | カートリポジトリ実装                        | 実装               | 3h       | TASK-081                               | -                                                  | -        | C-SHOP-01  | CUS-05, CUS-06   |
| TASK-083 | OpenAPI仕様にカート管理APIを追加            | 設計               | 2h       | TASK-077                               | -                                                  | -        | C-SHOP-01  | CUS-05, CUS-06   |
| TASK-084 | ogenカートAPIコード生成                     | 実装               | 1h       | TASK-083                               | -                                                  | -        | C-SHOP-01  | CUS-05, CUS-06   |
| TASK-085 | カート取得API実装                           | 実装               | 3h       | TASK-082, TASK-084                     | API-CART-01                                        | -        | C-SHOP-01  | CUS-05, CUS-06   |
| TASK-086 | カートアイテム追加API実装                   | 実装               | 3h       | TASK-082, TASK-084                     | API-CART-02                                        | -        | C-SHOP-01  | CUS-05           |
| TASK-087 | カートアイテム削除API実装                   | 実装               | 2h       | TASK-082, TASK-084                     | API-CART-03                                        | -        | C-SHOP-01  | CUS-06           |
| TASK-088 | カートアイテム更新API実装                   | 実装               | 3h       | TASK-082, TASK-084                     | API-CART-04                                        | -        | C-SHOP-01  | CUS-06           |
| TASK-089 | カート画面の基本レイアウト設計              | 設計               | 2h       | -                                      | -                                                  | C-04     | C-SHOP-01  | CUS-05, CUS-06   |
| TASK-090 | カート画面の基本実装                        | 実装               | 4h       | TASK-089                               | API-CART-01                                        | C-04     | C-SHOP-01  | CUS-05, CUS-06   |
| TASK-091 | 商品追加機能の実装                          | 実装               | 3h       | TASK-090                               | API-CART-02                                        | C-04     | C-SHOP-01  | CUS-05           |
| TASK-092 | 商品削除機能の実装                          | 実装               | 3h       | TASK-090                               | API-CART-03                                        | C-04     | C-SHOP-01  | CUS-06           |
| TASK-093 | トレースフィルタリング設定                  | オブザーバビリティ | 3h       | -                                      | -                                                  | -        | O-TRACE-03 | OBS-05           |
| TASK-094 | トレースアノテーション追加                  | オブザーバビリティ | 2h       | TASK-093                               | -                                                  | -        | O-TRACE-03 | OBS-05           |
| TASK-095 | エラートレースの特定機能                    | オブザーバビリティ | 3h       | TASK-093                               | -                                                  | -        | O-TRACE-03 | OBS-05           |
| TASK-096 | X-Rayダッシュボードの設計                   | オブザーバビリティ | 3h       | -                                      | -                                                  | -        | O-DASH-01  | OBS-06           |
| TASK-097 | X-Rayダッシュボードのカスタマイズ           | オブザーバビリティ | 4h       | TASK-096                               | -                                                  | -        | O-DASH-01  | OBS-06           |
| TASK-098 | カートプロセスのトレース強化                | オブザーバビリティ | 3h       | TASK-085, TASK-086, TASK-087, TASK-095 | -                                                  | -        | O-TRACE-03 | OBS-05           |
| TASK-099 | カート関連APIの単体テスト                   | テスト             | 3h       | TASK-085, TASK-086, TASK-087, TASK-088 | API-CART-01, API-CART-02, API-CART-03, API-CART-04 | -        | C-SHOP-01  | CUS-05, CUS-06   |
| TASK-100 | フロントエンドのカート統合テスト            | テスト             | 3h       | TASK-090, TASK-091, TASK-092           | -                                                  | C-04     | C-SHOP-01  | CUS-05, CUS-06   |
| TASK-101 | トレースフィルタリングの検証                | テスト             | 2h       | TASK-093, TASK-094, TASK-095           | -                                                  | -        | O-TRACE-03 | OBS-05           |

## 週5の進捗追跡ダッシュボード

```
AWS オブザーバビリティ学習プロジェクト - 週5進捗ダッシュボード
----------------------------------------------------------
全体進捗: 62% [████████████████··········]

【タスク完了率】
週1〜4のタスク: 100% [████████████████████████] (76/76 完了)
週5のタスク: 100% [████████████████████████] (25/25 完了)

【API完成率】
API-CART-01 (カート取得API): 100% [████████████████████████]
API-CART-02 (カートアイテム追加API): 100% [████████████████████████]
API-CART-03 (カートアイテム削除API): 100% [████████████████████████]
API-CART-04 (カートアイテム更新API): 80% [████████████████████····]

【画面完成率】
C-04 (カート画面): 80% [████████████████████····]

【機能完成率】
C-SHOP-01 (カート機能): 80% [████████████████████····]
O-TRACE-03 (トレースフィルタリング): 85% [█████████████████████···]
O-DASH-01 (X-Rayダッシュボード): 80% [████████████████████····]

【ユースケース実現率】
CUS-05 (カートへの商品追加): 85% [█████████████████████···]
CUS-06 (カート管理): 70% [█████████████████·······]
OBS-05 (分散トレース): 95% [███████████████████████·]
OBS-06 (サービスマップ可視化): 80% [████████████████████····]

【前週からの改善ユースケース】
OBS-05 (分散トレース): 90% → 95% [+5%]
OBS-06 (サービスマップ可視化): 70% → 80% [+10%]

【カテゴリー別進捗】
顧客向け機能: 77% [███████████████████·····] (+7%)
管理者向け機能: 0% [························] (変化なし)
オブザーバビリティ機能: 90% [██████████████████████··] (+2%)

【注目ポイント】
- カート機能の基本部分が実装され、ショッピング体験の基盤が確立
- 複雑なトランザクションフローのトレーシングが可能に
- カスタマイズされたX-Rayダッシュボードによる可視性向上

【次のステップ】
1. カート機能の拡張（複数商品管理、数量変更）（週6）
2. ヘルスチェックエンドポイントの実装（週6）
3. ビジネスメトリクスの拡張（週6）
```

## Notionでの管理ポイント

1. **カート機能の設計図**:
   - ERD図（carts、cart_itemsテーブル）
   - カートフローの図解（追加・削除・更新）
   - APIエンドポイントの一覧と説明

2. **複雑なトレース情報の整理**:
   - 重要なトレースのスクリーンショット
   - トレースアノテーションのリファレンス
   - フィルタリングパターンのレシピ集

3. **インタラクティブな要素の記録**:
   - カート操作のGIF録画
   - トレース検索のデモ
   - ユーザーフロー全体の可視化

4. **コンポーネント間の依存関係**:
   - カートサービスと他サービスの関係図
   - フロントエンド・バックエンド間の通信フロー
   - データアクセスパターンの分析

## 週5の終了時点での成果物

1. **カート基本機能**:
   - カートデータモデルとデータベース構造
   - カートAPI（取得、追加、削除、更新）
   - カート表示画面と基本操作（追加・削除）

2. **高度なトレース機能**:
   - トレースフィルタリング設定
   - カスタムアノテーションによる文脈情報の付与
   - エラートレース特定機能

3. **可視化ツール**:
   - カスタマイズされたX-Rayダッシュボード
   - サービスマップの詳細表示
   - 複雑なトランザクションフローの視覚化

4. **ショッピング体験の基盤**:
   - 商品閲覧から追加までの一貫したフロー
   - カート内容の永続化（データベース保存）
   - シンプルなカート管理機能
