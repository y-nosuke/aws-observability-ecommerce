# 週6: カート機能の拡張

## 目標とするユースケース

| ユースケースID | ユースケース名     | 優先度 | 終了時達成目標 | 完了基準                                               |
| -------------- | ------------------ | ------ | -------------- | ------------------------------------------------------ |
| CUS-06         | カート管理         | 高     | 90%            | カート内の商品数量変更・削除が機能する                 |
| OBS-07         | ヘルスチェック     | 高     | 85%            | ヘルスチェックエンドポイントが機能し、状態が報告される |
| OBS-04         | 基本メトリクス収集 | 高     | 95%            | 拡張されたビジネスメトリクスが収集・可視化される       |
| OBS-08         | アラート通知       | 中     | 70%            | 設定した閾値を超えるとアラートが発生する               |

## 実装する機能

| 機能ID      | 機能名                       | 説明                                     | 関連ユースケース | 終了時達成目標 |
| ----------- | ---------------------------- | ---------------------------------------- | ---------------- | -------------- |
| C-SHOP-01   | カート機能（拡張）           | 複数商品管理、数量変更機能               | CUS-06           | 90%            |
| O-ALERT-01  | ヘルスチェックエンドポイント | サービス稼働状況確認用APIエンドポイント  | OBS-07           | 85%            |
| O-METRIC-06 | ビジネスメトリクスの拡張     | 高度なビジネス指標の追加と可視化         | OBS-04           | 95%            |
| O-ALERT-02  | 基本アラート設定             | エラー率や異常なレイテンシーの検出と通知 | OBS-08           | 70%            |

## 実装するAPI

| API ID         | API名                         | エンドポイント           | メソッド | 関連機能    | 終了時達成目標 |
| -------------- | ----------------------------- | ------------------------ | -------- | ----------- | -------------- |
| API-CART-04    | カートアイテム更新API（拡張） | `/api/cart/items/{id}`   | PUT      | C-SHOP-01   | 100%           |
| API-HEALTH-01  | 拡張ヘルスチェックAPI         | `/api/health`            | GET      | O-ALERT-01  | 100%           |
| API-HEALTH-02  | サブシステムヘルスAPI         | `/api/health/subsystems` | GET      | O-ALERT-01  | 90%            |
| API-METRICS-02 | 拡張ビジネスメトリクスAPI     | `/api/metrics/business`  | GET      | O-METRIC-06 | 100%           |

## 実装する画面

| 画面ID | 画面名             | 説明                                           | 関連機能  | 終了時達成目標 |
| ------ | ------------------ | ---------------------------------------------- | --------- | -------------- |
| C-04   | カート画面（拡張） | 商品数量変更、合計金額表示などの拡張機能を追加 | C-SHOP-01 | 90%            |

## 詳細タスク

| タスクID | タスク名                               | タスク種別         | 見積時間 | 依存タスク                             | 関連API                      | 関連画面 | 関連機能    | 関連ユースケース |
| -------- | -------------------------------------- | ------------------ | -------- | -------------------------------------- | ---------------------------- | -------- | ----------- | ---------------- |
| TASK-102 | カート数量変更機能の実装               | 実装               | 4h       | TASK-088                               | API-CART-04                  | C-04     | C-SHOP-01   | CUS-06           |
| TASK-103 | カート合計金額計算の実装               | 実装               | 2h       | TASK-102                               | API-CART-04                  | C-04     | C-SHOP-01   | CUS-06           |
| TASK-104 | カート画面の数量変更UI実装             | 実装               | 3h       | TASK-090                               | API-CART-04                  | C-04     | C-SHOP-01   | CUS-06           |
| TASK-105 | カート画面の合計金額表示実装           | 実装               | 2h       | TASK-103, TASK-104                     | -                            | C-04     | C-SHOP-01   | CUS-06           |
| TASK-106 | カートバリデーション強化               | 実装               | 3h       | TASK-102                               | API-CART-04                  | -        | C-SHOP-01   | CUS-06           |
| TASK-107 | ヘルスチェックサービス(SVC-06)設計     | 設計               | 2h       | -                                      | -                            | -        | O-ALERT-01  | OBS-07           |
| TASK-108 | 基本ヘルスチェックエンドポイント実装   | 実装               | 3h       | TASK-107                               | API-HEALTH-01                | -        | O-ALERT-01  | OBS-07           |
| TASK-109 | サブシステムヘルスチェック実装         | 実装               | 4h       | TASK-108                               | API-HEALTH-02                | -        | O-ALERT-01  | OBS-07           |
| TASK-110 | データベース接続ヘルスチェック実装     | 実装               | 3h       | TASK-108                               | API-HEALTH-01                | -        | O-ALERT-01  | OBS-07           |
| TASK-111 | 拡張ビジネスメトリクス設計             | 設計               | 3h       | -                                      | -                            | -        | O-METRIC-06 | OBS-04           |
| TASK-112 | カート関連ビジネスメトリクス実装       | 実装               | 4h       | TASK-111, TASK-102                     | API-METRICS-02               | -        | O-METRIC-06 | OBS-04           |
| TASK-113 | ユーザーセッションメトリクス実装       | 実装               | 3h       | TASK-111                               | API-METRICS-02               | -        | O-METRIC-06 | OBS-04           |
| TASK-114 | メトリクス可視化の拡張                 | オブザーバビリティ | 3h       | TASK-112, TASK-113                     | -                            | -        | O-METRIC-06 | OBS-04           |
| TASK-115 | CloudWatch アラーム設計                | 設計               | 2h       | -                                      | -                            | -        | O-ALERT-02  | OBS-08           |
| TASK-116 | エラー率アラート設定                   | オブザーバビリティ | 3h       | TASK-115                               | -                            | -        | O-ALERT-02  | OBS-08           |
| TASK-117 | レイテンシーアラート設定               | オブザーバビリティ | 3h       | TASK-115                               | -                            | -        | O-ALERT-02  | OBS-08           |
| TASK-118 | 在庫状況アラート設定                   | オブザーバビリティ | 3h       | TASK-115                               | -                            | -        | O-ALERT-02  | OBS-08           |
| TASK-119 | アラートダッシュボード作成             | オブザーバビリティ | 4h       | TASK-116, TASK-117, TASK-118           | -                            | -        | O-ALERT-02  | OBS-08           |
| TASK-120 | LocalStack用アラート設定Terraform拡張  | インフラ           | 3h       | TASK-119                               | -                            | -        | O-ALERT-02  | OBS-08           |
| TASK-121 | カート数量変更のエラーハンドリング強化 | 実装               | 3h       | TASK-106                               | API-CART-04                  | C-04     | C-SHOP-01   | CUS-06           |
| TASK-122 | ヘルスチェックAPI単体テスト            | テスト             | 2h       | TASK-108, TASK-109, TASK-110           | API-HEALTH-01, API-HEALTH-02 | -        | O-ALERT-01  | OBS-07           |
| TASK-123 | カート機能統合テスト                   | テスト             | 3h       | TASK-102, TASK-103, TASK-104, TASK-105 | API-CART-04                  | C-04     | C-SHOP-01   | CUS-06           |
| TASK-124 | ビジネスメトリクス検証                 | テスト             | 2h       | TASK-112, TASK-113, TASK-114           | API-METRICS-02               | -        | O-METRIC-06 | OBS-04           |
| TASK-125 | アラート機能の検証                     | テスト             | 3h       | TASK-116, TASK-117, TASK-118, TASK-119 | -                            | -        | O-ALERT-02  | OBS-08           |

## 週6の進捗追跡ダッシュボード

```
AWS オブザーバビリティ学習プロジェクト - 週6進捗ダッシュボード
----------------------------------------------------------
全体進捗: 70% [█████████████████·········]

【タスク完了率】
週1〜5のタスク: 100% [████████████████████████] (101/101 完了)
週6のタスク: 100% [████████████████████████] (24/24 完了)

【API完成率】
API-CART-04 (カートアイテム更新API): 100% [████████████████████████]
API-HEALTH-01 (拡張ヘルスチェックAPI): 100% [████████████████████████]
API-HEALTH-02 (サブシステムヘルスAPI): 90% [██████████████████████··]
API-METRICS-02 (拡張ビジネスメトリクスAPI): 100% [████████████████████████]

【画面完成率】
C-04 (カート画面): 90% [██████████████████████··]

【機能完成率】
C-SHOP-01 (カート機能): 90% [██████████████████████··]
O-ALERT-01 (ヘルスチェックエンドポイント): 85% [█████████████████████···]
O-METRIC-06 (ビジネスメトリクスの拡張): 95% [███████████████████████·]
O-ALERT-02 (基本アラート設定): 70% [█████████████████·······]

【ユースケース実現率】
CUS-06 (カート管理): 90% [██████████████████████··]
OBS-07 (ヘルスチェック): 85% [█████████████████████···]
OBS-04 (基本メトリクス収集): 95% [███████████████████████·]
OBS-08 (アラート通知): 70% [█████████████████·······]

【前週からの改善ユースケース】
CUS-06 (カート管理): 70% → 90% [+20%]
OBS-04 (基本メトリクス収集): 90% → 95% [+5%]

【カテゴリー別進捗】
顧客向け機能: 82% [████████████████████··] (+5%)
管理者向け機能: 0% [························] (変化なし)
オブザーバビリティ機能: 85% [█████████████████████···] (+2%)

【注目ポイント】
- カート機能が完成に近づき、複数商品の管理が可能に
- ヘルスチェックによるシステム状態監視の基盤が確立
- ビジネスメトリクスとアラートの連携により異常検知が可能に

【次のステップ】
1. 注文処理システムの基本実装（週7）
2. サービスマップの強化（週7）
3. ログ、メトリクス、トレースの相関付け（週7）
```

## Notionでの管理ポイント

1. **機能の拡張追跡**:
   - カート機能の基本→拡張への進捗をビジュアル化
   - 機能ごとの完成度を示すプログレスバー
   - 残タスクの優先順位付け

2. **ヘルスチェックデータの管理**:
   - サブシステム別のヘルス状態を一覧表示
   - 時系列でのヘルス状態変化の記録
   - 問題発生時の自動記録の仕組み

3. **アラートの定義と管理**:
   - アラート設定の一覧と説明
   - 閾値の設定根拠とドキュメント
   - アラート発生時の対応フロー

4. **ビジネスメトリクスのカタログ化**:
   - カテゴリー別のメトリクス一覧
   - 各メトリクスの計算方法と意味の説明
   - ダッシュボードへのリンク

## 週6の終了時点での成果物

1. **拡張カート機能**:
   - 数量変更機能を備えたカート
   - 合計金額計算と表示
   - バリデーションと堅牢なエラーハンドリング

2. **ヘルスチェック機能**:
   - 基本ヘルスチェックエンドポイント
   - サブシステム別のヘルス状態確認
   - データベース接続状態のモニタリング

3. **ビジネスメトリクス**:
   - カート関連指標（追加率、放棄率など）
   - ユーザーセッション指標
   - 拡張メトリクスダッシュボード

4. **アラートシステム**:
   - エラー率、レイテンシー、在庫状況のアラート
   - CloudWatchアラーム設定
   - アラートダッシュボード
