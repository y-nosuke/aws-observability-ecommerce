# 要求定義と管理のプロセスと考え方：eコマースアプリ開発事例

## 1. はじめに

### 1.1. この資料の目的

この資料は、「AWSオブザーバビリティ学習用eコマースアプリ」プロジェクトにおいて、要求を定義し管理するために行った一連のプロセスと考え方をまとめたものです。エピック、ペルソナ、ユーザーストーリー、ユースケースといった要素をどのように定義し、相互に関連付け、議論を通じて洗練させていったかを記録しています。

将来、同様のアプリケーション開発プロジェクトを開始する際に、要求定義・管理の進め方やドキュメント構成の参考となることを目的としています。

### 1.2. 対象読者

* プロダクトマネージャー、プロダクトオーナー
* ビジネスアナリスト
* ソフトウェア開発者、エンジニアリングマネージャー
* SRE、運用担当者
* セキュリティ担当者
* QAエンジニア
* その他、ソフトウェア開発の要求定義プロセスに関わる方

## 2. 要求定義・管理要素の概要

本プロジェクトでは、以下の要素を用いて要求を段階的に詳細化し、管理しました。

* **ペルソナ (Persona):** ユーザー像を具体的に定義し、要求の主体とニーズを明確化します。（→ `01_user-personas.md`）
* **エピック (Epic):** 大きなビジネス価値の塊や戦略目標を示します。（→ `02-1_epic.md`）
* **ユーザーストーリー (User Story):** 特定ペルソナにとって価値ある機能要求を、開発可能な単位で記述します。（→ `03-1_user-stories.md`）
* **ユースケース (Use Case):** システムがアクターとどのように相互作用するか、具体的な振る舞いを記述します。（→ `04_use-cases.md`）

これらの関係性については、`epic-user-story-usecase-relation.md` で詳細に解説しています。

## 3. ID命名規則

一貫性と追跡可能性を高めるため、以下の命名規則を導入しました。

* **基本形式:** `[種別]-[ペルソナ略称]-[機能エリア略称]-[連番]`
* **種別:** `EP`, `US`, `UC`
* **ペルソナ略称:** `CUST`, `MGR`, `DEV`, `SRE`, `SEC`, `BA`, `SYS`
* **機能エリア略称:** `SHOP`, `AUTH`, `OBS`, `PROD`, `IMPL` など多数定義
* **横断的エピック:** `EP-CROSSCUTTING-{機能エリア}` (例: `EP-CROSSCUTTING-AUTH`)

詳細は `00-1_id-convention.md` を参照してください。

## 4. 定義・整理のプロセスとポイント

以下に、各要素を定義・整理していく過程で議論となった点や、採用した考え方をまとめます。

### 4.1. ペルソナ (Persona)

* **初期定義:** 当初は「顧客」「管理者」「開発/運用担当者」の3つのシンプルなペルソナでした。
* **課題:** ユーザーストーリーやユースケースを具体化する中で、「管理者」や「開発/運用」の役割が多岐にわたり、1つのペルソナでは要求を正確に表現できないことが判明しました。特にオブザーバビリティやセキュリティに関する要求は、専門的な視点が必要でした。
* **改善:**
  * 「管理者」を「ECストアマネージャー (`MGR`)」とし、店舗運営業務にフォーカス。
  * 「開発/運用担当者」を「開発者 (`DEV`)」と「SRE/運用担当者 (`SRE`)」に分離。
  * 新たに「セキュリティ担当者 (`SEC`)」と「ビジネスアナリスト (`BA`)」を追加。
* **ポイント:** **詳細なペルソナ定義は、要求の解像度を高める上で非常に重要です。** 誰のための機能なのか、その人は何を課題とし、何を求めているのかを具体化することで、ユーザーストーリーやユースケースの質が向上します。

### 4.2. エピック (Epic)

* **役割:** 大きなビジネス価値や機能領域を示すものとして定義しました。
* **横断的関心事:** 認証 (`AUTH`)、通知 (`NOTIF`)、オブザーバビリティ (`OBS`) など、複数のビジネス機能から利用される、あるいはシステム全体の品質に関わる要素については、当初 `EP-AUTHENTICATION` のように定義していましたが、その横断的な性質を明確にするため、IDを `EP-CROSSCUTTING-AUTH` のように変更しました。
* **ポイント:** エピックレベルでビジネス機能と横断的基盤を区別することで、アーキテクチャ上の考慮点を早期に意識できます。

### 4.3. ユーザーストーリー (User Story)

* **分類軸:** **ペルソナ**を第一の分類軸としました。各ペルソナのセクション内に、関連する機能エリアごとのストーリーを配置する構成を採用しました。これにより、「誰が何をしたいのか」が明確になります。
* **ID体系:** `US-[ペルソナ略称]-[機能エリア略称]-[連番]` を採用し、IDから主体と内容を推測しやすくしました。
* **実装ストーリー vs 利用ストーリー:**
  * 特に技術基盤やオブザーバビリティ計装など、**それ自体の導入・設定が将来の効率性や品質向上に繋がる**ものについては、「実装ストーリー (`US-DEV-...-IMPL-01`)」として独立させました。価値の主体は主に開発者やSRE自身です。
  * 実装ストーリーは、関連する「利用ストーリー」の目的 (`Why`) を明記し、利用ニーズから乖離しないよう注意が必要です（過剰/過少実装リスクへの対策）。
  * 機能を利用するストーリーは「利用ストーリー」として定義し、その機能がもたらす直接的な価値を記述します。
* **横断的機能（通知など）の配置:**
  * 当初、通知関連のユーザーストーリー (`US-CUST-NOTIF-*`) を `EP-NOTIFICATION` に配置する案もありましたが、**顧客が通知を受け取る文脈（注文完了時、在庫入荷時など）**が重要であるため、関連するビジネスエピック (`EP-SHOPPING`, `EP-CUSTOMER-ENGAGEMENT`) に属するストーリーとして、該当セクションに配置し直しました。IDも `US-CUST-CHECKOUT-NOTIF-01` のように文脈が分かるように変更しました。
  * 一方で、通知基盤の**実装**そのものは `EP-CROSSCUTTING-NOTIF` に属する `US-DEV-NOTIF-IMPL-01` として定義しました。
* **CI/CD:** 開発プロセス改善のためのCI/CDパイプライン構築も、開発者の価値として独立したユーザーストーリー (`US-DEV-CICD-IMPL-01`) として定義しました。
* **ポイント:** ユーザーストーリーはペルソナの価値を中心に記述しつつ、実装と利用を意識的に区別すること、横断的機能は利用文脈と実装基盤を分けて考えることが、要求の明確化に繋がります。

### 4.4. ユースケース (Use Case)

* **役割:** ユーザーストーリーで定義された要求に対し、**システムがどのように振る舞うか**を具体的に記述する目的で利用します。アクターとシステムの相互作用、正常系・代替・例外フローを記述します。
* **ID体系:** ユーザーストーリーに合わせて `UC-[ペルソナ略称]-[機能エリア略称]-[連番]` を採用しました。
* **関連付け:** 各ユースケース記述の中に、関連するユーザーストーリーIDを明記することで、トレーサビリティを確保します。
* **ポイント:** 全てのユーザーストーリーに詳細なユースケースが必要なわけではありません。インタラクションが複雑な場合や、仕様の誤解を防ぎたい場合に重点的に作成します。特に、ペルソナごとに異なる操作や目的を持つ機能（例: オブザーバビリティツールの利用）については、ペルソナ別のユースケースを定義することが有効です。

### 4.5. 継続的な見直し

* 本プロジェクトの要求定義プロセスは、**一方通行ではなく、対話とフィードバックによる反復的な改善**の連続でした。
  * ペルソナ定義 → ユーザーストーリー洗い出し → ユースケース検討 → ID体系見直し → ユーザーストーリー再分類 → エピックID見直し → 実装/利用ストーリーの議論 → ...
* **ポイント:** 最初から完璧な定義を目指すのではなく、各要素を作成・議論する中で出てきた疑問や矛盾点をもとに、**柔軟に定義や分類を見直していく**ことが、最終的により整合性の取れた要求定義に繋がります。

## 5. 成果物一覧

このプロセスを経て、以下のドキュメントが作成・更新されました。

* `00-0_requirements-process-summary.md`: このドキュメント
* `00-1_id-convention.md`: ID命名規則
* `01_user-personas.md`: ユーザーペルソナ定義 (修正版)
* `02-1_epic.md`: エピック一覧 (修正版)
* `03-1_user-stories.md`: ユーザーストーリー一覧 (修正版)
* `04_use-cases.md`: ユースケース一覧 (修正版)
* `epic-user-story-usecase-relation.md`: エピック・ユーザーストーリー・ユースケースの関係 (修正版)

## 6. まとめ

本プロジェクトでは、ペルソナを詳細化し、ペルソナ中心の視点でユーザーストーリーとユースケースを整理・分類することで、要求の解像度を高めました。特に、実装と利用、ビジネス機能と横断的関心事を意識的に区別し、ID体系にも反映させることで、各要素の目的と関連性を明確にすることを目指しました。

このアプローチは、初期の要求定義に時間はかかるものの、後の設計・開発・テストフェーズでの手戻りを減らし、関係者間の認識齟齬を防ぐ上で有効であると考えられます。また、対話を通じて継続的に定義を見直すプロセス自体が、プロジェクトの成功に不可欠な要素となります。
