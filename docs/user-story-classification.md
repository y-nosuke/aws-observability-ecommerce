# エピック・ユーザーストーリー・ユースケース：分類と関連性の考え方

## 1. はじめに

ソフトウェア開発、特にアジャイル開発において、要求を効果的に定義・管理することはプロジェクト成功の鍵です。エピック、ユーザーストーリー、ユースケースは、それぞれ異なる粒度で要求を捉え、ビジネス価値から具体的なシステム機能、そしてその振る舞いへと落とし込むための重要な手法です。

これらの要素を適切に分類し、関連付けることで、以下のメリットが得られます。

* **トレーサビリティの確保**: ビジネス目標（エピック）から具体的な機能（ユーザーストーリー）、システムの振る舞い（ユースケース）までの要求の流れを追跡可能にする。
* **全体像の把握**: プロダクトの全体像（エピック）から詳細（ユーザーストーリー、ユースケース）まで、異なるレベルでの理解を促進する。
* **コミュニケーションの促進**: 関係者間（ビジネス、開発、テスト）で要求に対する共通認識を醸成する。
* **効率的な開発**: 開発可能な単位（ユーザーストーリー）での計画・管理を可能にし、複雑な機能の仕様（ユースケース）を明確にする。

この資料では、エピック、ユーザーストーリー、ユースケースの定義、分類方法、そしてそれらの関連付けについての考え方を整理します。

## 2. 各要素の定義と役割

* **エピック (Epic)**
  * **定義**: 大きなビジネス価値のまとまり、あるいは長期的なプロダクト目標を表す、粗い粒度の要求。通常、1つの開発イテレーションでは完了できない規模。
  * **役割**:
    * プロダクトのロードマップや戦略的な方向性を示す。
    * 大きなビジネス価値や成果物を定義する。
    * 関連するユーザーストーリー群をグルーピングする。

* **ユーザーストーリー (User Story)**
  * **定義**: 特定のユーザー（役割）にとって価値のある、より小さな機能要求。通常、「〇〇（役割）として、△△（目的）のために、□□（機能）がしたい」 (As a [Role], I want to [Action/Goal], so that [Benefit/Value]) という形式で記述される。開発チームが1スプリントで完了できる程度の大きさを目指す。
  * **役割**:
    * 開発可能な単位でユーザー価値を定義する。
    * プロダクトバックログの基本アイテムとなる。
    * スプリント計画や受け入れテストの基礎となる。

* **ユースケース (Use Case)**
  * **定義**: システムが特定の目標を達成するために、アクター（ユーザーや外部システム）とどのように相互作用（インタラクション）するかを詳細に記述したもの。基本フロー（正常系）に加え、代替フローや例外フローを含むことが多い。
  * **役割**:
    * システムの振る舞いを具体的に定義する（「どのように」実現するか）。
    * 複雑なロジック、条件分岐、アクターとのインタラクションを明確にする。
    * ユーザーストーリーの受け入れ基準を補完する。
    * テストケース設計のインプットとなる。

## 3. 分類と階層構造

要求を整理し、管理しやすくするためには、適切な分類と階層構造が重要です。

* **エピックの分類**:
  * **主軸**: **ビジネス価値**や**大きな機能領域**（例: ショッピング体験、商品管理、受注管理）で分類します。
  * **補助**: **ユーザー体験のフェーズ**（例: 購入前、購入後）や**開発チームの担当範囲**も考慮に入れることがあります。
  * **横断的関心事**: 認証、通知、オブザーバビリティなど、多くの機能に関わる共通基盤は、**独立したエピック**として切り出すことを検討します（アスペクト指向的な考え方）。これにより、関心事を分離し、専門性を集約できます。
    * 例: `EP-AUTHENTICATION`, `EP-NOTIFICATION`, `EP-OBSERVABILITY`

* **ユーザーストーリーの分類**:
  * 基本的には、そのユーザーストーリーが貢献する**エピックに所属**させます。
  * エピック内で、さらにアクター（顧客向け、管理者向け）やサブ機能でグルーピングすると分かりやすくなります。

* **ユースケースの分類**:
  * ユーザーストーリーと同様に、関連する**エピック**や**主要な機能領域**で分類します。
  * 複数のユーザーストーリーを実現する共通のユースケースも存在します。

**階層構造のイメージ**:

```mermaid
graph TD
    subgraph ビジネス価値/目標
        E1(EPIC 1: 主要ビジネス機能A)
        E2(EPIC 2: 主要ビジネス機能B)
        E3(EPIC 3: 横断的関心事 X)
    end

    subgraph 具体的な機能要求 (開発単位)
        E1 --> US1_1(UserStory 1.1);
        E1 --> US1_2(UserStory 1.2);
        E2 --> US2_1(UserStory 2.1);
        E2 --> US2_2(UserStory 2.2);
        E3 --> US3_1(UserStory 3.1);
        E3 --> US3_2(UserStory 3.2);
    end

    subgraph システムの振る舞い (詳細仕様、オプション)
        US1_1 --> UC1(UseCase A);
        US1_2 --> UC1;
        US2_1 --> UC2(UseCase B);
        US3_1 --> UC3(UseCase C);
        US3_2 --> UC3;
        US2_2 -->|シンプルなら不要| UC4(UseCase D: 例外系);
    end

    style E1 fill:#f9f,stroke:#333,stroke-width:2px
    style E2 fill:#f9f,stroke:#333,stroke-width:2px
    style E3 fill:#f9f,stroke:#333,stroke-width:2px
    style US1_1 fill:#ccf,stroke:#333,stroke-width:1px
    style US1_2 fill:#ccf,stroke:#333,stroke-width:1px
    style US2_1 fill:#ccf,stroke:#333,stroke-width:1px
    style US2_2 fill:#ccf,stroke:#333,stroke-width:1px
    style US3_1 fill:#ccf,stroke:#333,stroke-width:1px
    style US3_2 fill:#ccf,stroke:#333,stroke-width:1px
    style UC1 fill:#cfc,stroke:#333,stroke-width:1px
    style UC2 fill:#cfc,stroke:#333,stroke-width:1px
    style UC3 fill:#cfc,stroke:#333,stroke-width:1px
    style UC4 fill:#cfc,stroke:#333,stroke-width:1px,stroke-dasharray: 5 5
```

## 4. 関連付けの考え方

* **エピック → ユーザーストーリー**:
  * 1つのエピックは、それを実現するための複数の具体的なユーザーストーリーに**分解**されます (1対多)。
  * すべてのユーザーストーリーは、原則としていずれか1つのエピックに属します。

* **ユーザーストーリー → ユースケース**:
  * この関係は多様です。
    * **1対多**: 1つのユーザーストーリーが複数のシナリオ（正常系、代替系、例外系）を持つ場合、複数のユースケース（または1つのユースケース内の複数フロー）に対応します。
    * **多対1**: 複数の関連するユーザーストーリーが、1つの主要なシステム機能（=ユースケース）によって実現される場合があります。（例: 商品詳細画面で情報確認、在庫確認、カート追加ができる場合、これらのストーリーが「商品詳細閲覧」ユースケースに関連）
    * **1対1**: シンプルな機能であれば、1つのユーザーストーリーが1つのユースケースに直接対応することもあります。
    * **不要**: 非常にシンプルなユーザーストーリーの場合、詳細なユースケース記述は不要で、ユーザーストーリーの「受け入れ基準 (Acceptance Criteria)」で十分な場合もあります。
  * **マッピング表の活用**: ユーザーストーリーとユースケースの対応関係を一覧化するマッピング表を作成すると、トレーサビリティが向上します。

* **横断的関心事エピックとの関連**:
  * 認証、通知、オブザーバビリティなどの横断的エピックに属するユーザーストーリー（例: `US-AUTH-LOGIN`）は、それ自体が機能要求です。
  * ビジネス機能エピック（例: `EP-SHOPPING`）に属するユーザーストーリー（例: `US-CUST-CHECKOUT-01`）は、内部的に横断的エピックの機能（認証状態の確認、注文確認通知の送信など）を利用（依存）することがあります。この依存関係は、ユーザーストーリーやユースケースの記述、あるいはインターフェース定義で明確にします。

## 5. ID命名規則の重要性

一貫性のあるID命名規則は、分類と関連付けを支える重要な基盤です。

* **プレフィックス**: `EP-`, `US-`, `UC-` のように、要素の種類を明確にします。
* **分類子**: エピック名、機能領域、アクター (`SHOPPING`, `AUTH`, `CUST`, `ADMIN`, `OBS` など) を含めることで、IDから内容を推測しやすくします。
* **一意性**: 各要素のIDはシステム全体で一意にします。
* **一貫性**: プロジェクト内でルールを統一し、遵守します。

適切なID体系により、ドキュメント間の参照やツールでの管理が容易になります。

## 6. まとめ

エピック、ユーザーストーリー、ユースケースは、それぞれ異なる視点と粒度で要求を捉えるための有効なツールです。

* **「ビジネス価値」**を主軸にエピックを定義し、必要に応じて横断的関心事を独立させます。
* エピックを達成するための**開発可能な単位**としてユーザーストーリーを作成します。
* ユーザーストーリーを実現するための**システムの振る舞い**を、必要に応じてユースケースで詳細化します。
* 一貫した**ID体系**と**マッピング**により、これらの関連性を明確にし、トレーサビリティを確保します。

これらの要素を適切に分類し、連携させることで、要求の理解を深め、開発プロセスを円滑に進めることができます。重要なのは、これらの手法を形式的に適用するだけでなく、プロジェクトの状況やチームのニーズに合わせて柔軟に見直し、コミュニケーションを促進するためのツールとして活用することです。
